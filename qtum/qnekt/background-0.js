LavaPack.loadBundle([[10,{"@metamask/obs-store":1608},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("@metamask/obs-store");r.default=class{constructor(e={}){const{accountTracker:t,getCurrentChainId:r}=e;this.accountTracker=t,this.getCurrentChainId=r;const i={cachedBalances:{},...e.initState};this.store=new n.ObservableStore(i),this._registerUpdates()}async updateCachedBalances({accounts:e}){const t=this.getCurrentChainId(),r=await this._generateBalancesToCache(e,t);this.store.updateState({cachedBalances:r})}_generateBalancesToCache(e,t){const{cachedBalances:r}=this.store.getState(),n={...r[t]};Object.keys(e).forEach((t=>{const r=e[t];r.balance&&(n[t]=r.balance)}));return{...r,[t]:n}}clearCachedBalances(){this.store.updateState({cachedBalances:{}})}_registerUpdates(){const e=this.updateCachedBalances.bind(this);this.accountTracker.store.subscribe(e)}}}}},{package:"$root$"}],[100,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:12,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=12;try{const e=function(e){const t=e;return t.NoticeController.noticesList.forEach((e=>{e.read&&(e.body="")})),t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #12${e.stack}`)}return Promise.resolve(t)}};r.default=i}}},{package:"$root$"}],[101,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:13,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=13;try{const e=function(e){const t=e,{config:r}=t;r&&r.provider&&"testnet"===r.provider.type&&(t.config.provider.type="ropsten");return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #13${e.stack}`)}return Promise.resolve(t)}};r.default=i}}},{package:"$root$"}],[102,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:14,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=14;try{const e=function(e){const t=e;return t.NetworkController={},t.NetworkController.provider=t.config.provider,delete t.config.provider,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #14${e.stack}`)}return Promise.resolve(t)}};r.default=i}}},{package:"$root$"}],[103,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var s={version:15,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=15;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=r;t.TransactionController.transactions=e.map((e=>e.err?("Gave up submitting tx."===e.err.message&&(e.status=i.TRANSACTION_STATUSES.FAILED),e):e))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #15${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[104,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var s={version:16,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=16;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>e.err?("transaction with the same hash was already imported."===e.err&&(e.status=i.TRANSACTION_STATUSES.SUBMITTED,delete e.err),e):e))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #16${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[105,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var s={version:17,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=17;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(!e.status===i.TRANSACTION_STATUSES.FAILED||e.retryCount>0&&e.retryCount<2&&(e.status=i.TRANSACTION_STATUSES.SUBMITTED,delete e.err),e)))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #17${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[106,{"../controllers/transactions/lib/tx-state-history-helpers":35,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../controllers/transactions/lib/tx-state-history-helpers");var s={version:18,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=18;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>{if(!e.history||0===e.history.length){const t=(0,i.snapshotFromTxMeta)(e);return e.history=[t],e}const t=(0,i.migrateFromSnapshotsToDiffs)(e.history).filter((e=>!Array.isArray(e)||e.length>0));return e.history=t,e}))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #18${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[107,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var s={version:19,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=19;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map(((e,t,r)=>{if(e.status!==i.TRANSACTION_STATUSES.SUBMITTED)return e;const n=function(e){const t=e.map((e=>{const{nonce:t}=e.txParams;return parseInt(t||"0x0",16)}));return Math.max.apply(null,t)}(r.filter((e=>e.status===i.TRANSACTION_STATUSES.CONFIRMED)).filter((t=>t.txParams.from===e.txParams.from)).filter((t=>t.metamaskNetworkId.from===e.metamaskNetworkId.from))),s=function(e,t){const r=e.map((e=>{const{nonce:t}=e.txParams;return parseInt(t,16)}));let n=t;for(;r.includes(n);)n+=1;return n}(r.filter((e=>e.status===i.TRANSACTION_STATUSES.SUBMITTED)).filter((t=>t.txParams.from===e.txParams.from)).filter((t=>t.metamaskNetworkId.from===e.metamaskNetworkId.from)),n),a=Math.max(s,n);return parseInt(e.txParams.nonce,16)>a+1&&(e.status=i.TRANSACTION_STATUSES.FAILED,e.err={message:"nonce too high",note:"migration 019 custom error"}),e}))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #19${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[108,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:20,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=20;try{const e=function(e){const t=e;"metamask"in t&&!("firstTimeInfo"in t.metamask)&&(t.metamask.firstTimeInfo={version:"3.12.0",date:Date.now()});return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #20${e.stack}`)}return Promise.resolve(t)}};r.default=i}}},{package:"$root$"}],[109,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:21,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=21;try{const e=function(e){const t=e;return delete t.BlacklistController,delete t.RecentBlocks,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #21${e.stack}`)}return Promise.resolve(t)}};r.default=i}}},{package:"$root$"}],[11,{"../../../shared/constants/metametrics":7321,"../../../shared/constants/network":7322,"../../../shared/constants/time":7327,"../../../shared/constants/tokens":7328,"../../../shared/constants/transaction":7329,"../../../shared/modules/network.utils":7338,"../../../shared/modules/string-utils":7343,loglevel:5597,web3:7238},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=(n=e("web3"))&&n.__esModule?n:{default:n},s=e("loglevel"),a=e("../../../shared/constants/time"),o=e("../../../shared/constants/network"),c=e("../../../shared/constants/tokens"),u=e("../../../shared/modules/network.utils"),l=e("../../../shared/modules/string-utils"),d=e("../../../shared/constants/transaction"),h=e("../../../shared/constants/metametrics");const f=3*a.MINUTE;r.default=class{constructor({interval:e=f,preferences:t,network:r,keyringMemStore:n,tokenList:i,tokensController:s,assetsContractController:a=null,trackMetaMetricsEvent:o}={}){var c,u,l,d,h;this.assetsContractController=a,this.tokensController=s,this.preferences=t,this.interval=e,this.network=r,this.keyringMemStore=n,this.tokenList=i,this.useTokenDetection=null===(c=this.preferences)||void 0===c?void 0:c.store.getState().useTokenDetection,this.selectedAddress=null===(u=this.preferences)||void 0===u?void 0:u.store.getState().selectedAddress,this.tokenAddresses=null===(l=this.tokensController)||void 0===l?void 0:l.state.tokens.map((e=>e.address)),this.hiddenTokens=null===(d=this.tokensController)||void 0===d?void 0:d.state.ignoredTokens,this.detectedTokens=null===(h=this.tokensController)||void 0===h?void 0:h.state.detectedTokens,this.chainId=this.getChainIdFromNetworkStore(r),this._trackMetaMetricsEvent=o,null==t||t.store.subscribe((({selectedAddress:e,useTokenDetection:t})=>{this.selectedAddress===e&&this.useTokenDetection===t||(this.selectedAddress=e,this.useTokenDetection=t,this.restartTokenDetection())})),null==s||s.subscribe((({tokens:e=[],ignoredTokens:t=[],detectedTokens:r=[]})=>{this.tokenAddresses=e.map((e=>e.address)),this.hiddenTokens=t,this.detectedTokens=r}))}async detectNewTokens(){if(!this.isActive)return;if(!(0,u.isTokenDetectionEnabledForNetwork)(this.getChainIdFromNetworkStore(this._network)))return;if(!this.useTokenDetection&&this.getChainIdFromNetworkStore(this._network)!==o.MAINNET_CHAIN_ID)return;const e=!this.useTokenDetection&&this.getChainIdFromNetworkStore(this._network)===o.MAINNET_CHAIN_ID,{tokenList:t}=this._tokenList.state,r=e?c.STATIC_MAINNET_TOKEN_LIST:t,n=[];this.web3.setProvider(this._network._provider);for(const e in r)this.tokenAddresses.find((({address:t})=>(0,l.isEqualCaseInsensitive)(t,e)))||this.hiddenTokens.find((t=>(0,l.isEqualCaseInsensitive)(t,e)))||this.detectedTokens.find((({address:t})=>(0,l.isEqualCaseInsensitive)(t,e)))||n.push(e);const i=[n.slice(0,1e3),n.slice(1e3,n.length-1)];for(const e of i){let t;try{t=await this.assetsContractController.getBalancesInSingleCall(this.selectedAddress,e)}catch(e){return void(0,s.warn)("MetaMask - DetectTokensController single call balance fetch failed",e)}const n=[],i=[];if(t){const e=Object.keys(t);for(const t of e){const{address:e,symbol:s,decimals:a,aggregators:o}=r[t];i.push(`${s} - ${e}`),n.push({address:e,symbol:s,decimals:a,aggregators:o})}n.length>0&&(this._trackMetaMetricsEvent({event:h.EVENT_NAMES.TOKEN_DETECTED,category:h.EVENT.CATEGORIES.WALLET,properties:{tokens:i,token_standard:d.TOKEN_STANDARDS.ERC20,asset_type:d.ASSET_TYPES.TOKEN}}),await this.tokensController.addDetectedTokens(n))}}}restartTokenDetection(){this.isActive&&this.selectedAddress&&(this.detectNewTokens(),this.interval=f)}getChainIdFromNetworkStore(e){return null==e?void 0:e.store.getState().provider.chainId}set interval(e){this._handle&&clearInterval(this._handle),e&&(this._handle=setInterval((()=>{this.detectNewTokens()}),e))}set network(e){e&&(this._network=e,this.web3=new i.default(e._provider),this._network.store.subscribe((()=>{this.chainId!==this.getChainIdFromNetworkStore(e)&&(this.restartTokenDetection(),this.chainId=this.getChainIdFromNetworkStore(e))})))}set keyringMemStore(e){e&&(this._keyringMemStore=e,this._keyringMemStore.subscribe((({isUnlocked:e})=>{this.isUnlocked!==e&&(this.isUnlocked=e,e&&this.restartTokenDetection())})))}set tokenList(e){e&&(this._tokenList=e)}get isActive(){return this.isOpen&&this.isUnlocked}}}}},{package:"$root$"}],[110,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var s={version:22,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=22;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(e.status!==i.TRANSACTION_STATUSES.SUBMITTED||e.submittedTime||(e.submittedTime=(new Date).getTime()),e)))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #22${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[111,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var s={version:23,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=23;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;if(e.length<=40)return t;const r=e.reverse();let n=!0;for(;r.length>40&&n;){const e=r.findIndex((e=>e.status===i.TRANSACTION_STATUSES.FAILED||e.status===i.TRANSACTION_STATUSES.REJECTED||e.status===i.TRANSACTION_STATUSES.CONFIRMED||e.status===i.TRANSACTION_STATUSES.DROPPED));e<0?n=!1:r.splice(e,1)}t.TransactionController.transactions=r.reverse()}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #23${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[112,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var s={version:24,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=24;const r=function(e){const t=e;if(!t.TransactionController)return t;const{transactions:r}=t.TransactionController;return t.TransactionController.transactions=r.map(((e,t)=>(e.status===i.TRANSACTION_STATUSES.UNAPPROVED&&e.txParams&&e.txParams.from&&(e.txParams.from=e.txParams.from.toLowerCase()),e))),t}(t.data);return t.data=r,t}};r.default=s}}},{package:"$root$"}],[113,{"../../../shared/constants/transaction":7329,"../lib/util":88,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../lib/util"),s=e("../../../shared/constants/transaction");var a={version:25,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=25;const r=function(e){const t=e;if(t.TransactionController&&t.TransactionController.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(e.status!==s.TRANSACTION_STATUSES.UNAPPROVED||(e.txParams=function(e){const t={from:e=>(0,i.addHexPrefix)(e).toLowerCase(),to:()=>(0,i.addHexPrefix)(e.to).toLowerCase(),nonce:e=>(0,i.addHexPrefix)(e),value:e=>(0,i.addHexPrefix)(e),data:e=>(0,i.addHexPrefix)(e),gas:e=>(0,i.addHexPrefix)(e),gasPrice:e=>(0,i.addHexPrefix)(e)},r={};return Object.keys(t).forEach((n=>{e[n]&&(r[n]=t[n](e[n]))})),r}(e.txParams)),e)))}return t}(t.data);return t.data=r,t}};r.default=a}}},{package:"$root$"}],[114,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:26,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=26;try{const e=t.data;t.data=function(e){if(!e.KeyringController||!e.PreferencesController)return e;if(!e.KeyringController.walletNicknames)return e;return e.PreferencesController.identities=Object.keys(e.KeyringController.walletNicknames).reduce(((t,r)=>(t[r]={name:e.KeyringController.walletNicknames[r],address:r},t)),{}),delete e.KeyringController.walletNicknames,e}(e)}catch(e){return console.warn(`MetaMask Migration #26${e.stack}`),Promise.reject(e)}return Promise.resolve(t)}};r.default=i}}},{package:"$root$"}],[115,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var s={version:27,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=27;const r=function(e){const t=e;if(t.TransactionController&&t.TransactionController.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.filter((e=>e.status!==i.TRANSACTION_STATUSES.REJECTED))}return t}(t.data);return t.data=r,t}};r.default=s}}},{package:"$root$"}],[116,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:28,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=28;const r=function(e){const t=e;if(t.PreferencesController&&t.PreferencesController.tokens&&t.PreferencesController.identities){const{identities:e,tokens:r}=t.PreferencesController;t.PreferencesController.accountTokens={},Object.keys(e).forEach((e=>{t.PreferencesController.accountTokens[e]={mainnet:r}})),t.PreferencesController.tokens=[]}return t}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[117,{"../../../shared/constants/transaction":7329,"./fail-tx":162},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=e("../../../shared/constants/transaction"),s=(n=e("./fail-tx"))&&n.__esModule?n:{default:n};var a={version:29,migrate:(0,s.default)(29,"Stuck in approved state for too long.",(e=>{const t=e.status===i.TRANSACTION_STATUSES.APPROVED,r=e.submittedTime,n=Date.now();return t&&n-r>432e5}))};r.default=a}}},{package:"$root$"}],[118,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:30,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=30;const r=function(e){const t=e;if(e.PreferencesController){const{frequentRpcListDetail:e}=t.PreferencesController;e&&(e.forEach(((t,r)=>{Boolean(t.chainId)&&Number.isNaN(parseInt(t.chainId))&&delete e[r].chainId})),t.PreferencesController.frequentRpcListDetail=e)}e.NetworkController&&(t.NetworkController.network&&Number.isNaN(parseInt(t.NetworkController.network))&&delete t.NetworkController.network,t.NetworkController.provider&&t.NetworkController.provider.chainId&&Number.isNaN(parseInt(t.NetworkController.provider.chainId))&&delete t.NetworkController.provider.chainId);return t}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[119,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:31,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=31;const r=function(e){const{KeyringController:t,PreferencesController:r}=e;if(t&&r){const{vault:e}=t;r.completedOnboarding=Boolean(e)}return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[12,{"../../../../shared/constants/network":7322,"ethereum-ens-network-map":2870,ethers:2916},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=e("ethers"),s=(n=e("ethereum-ens-network-map"))&&n.__esModule?n:{default:n},a=e("../../../../shared/constants/network");r.default=class{static getNetworkEnsSupport(e){return Boolean(s.default[e])}constructor({network:e,provider:t}={}){const r=a.NETWORK_ID_TO_ETHERS_NETWORK_NAME_MAP[e],n=s.default[e],o=new i.ethers.providers.Web3Provider(t,{chainId:parseInt(e,10),name:r,ensAddress:n});this._ethProvider=o}lookup(e){return this._ethProvider.resolveName(e)}reverse(e){return this._ethProvider.lookupAddress(e)}}}}},{package:"$root$"}],[120,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:32,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=32;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const{betaUI:e}=t.featureFlags||{};t.completedUiMigration=e}return e}(r),t}};r.default=i}}},{package:"$root$"}],[121,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:33,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=33;const r=function(e){const t=e;e.NoticeController&&delete t.NoticeController;return t}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[122,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:34,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=34;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.featureFlags||{};e.privacyMode||void 0!==t.migratedPrivacyMode||(t.migratedPrivacyMode=!0,e.privacyMode=!0)}return e}(r),t}};r.default=i}}},{package:"$root$"}],[123,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:35,async migrate(e){const t=(0,n.cloneDeep)(e);return t.meta.version=35,t.data=function(e){e.PreferencesController&&e.PreferencesController.seedWords!==undefined&&delete e.PreferencesController.seedWords;return e}(t.data),t}};r.default=i}}},{package:"$root$"}],[124,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:36,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=36;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.featureFlags||{};void 0!==e.privacyMode&&delete e.privacyMode}return e}(r),t}};r.default=i}}},{package:"$root$"}],[125,{"@metamask/controllers":1458,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("@metamask/controllers");var s={version:37,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=37;const r=t.data;return t.data=function(e){if(e.AddressBookController){const t=e.AddressBookController.addressBook,r=new Set,n={};Object.values(t).forEach((e=>{r.add(e.chainId)}));for(const e of r.values()){n[e]={};for(const r in t)t[r].chainId===e&&(t[r].isEns=!1,i.util.normalizeEnsName(t[r].name)&&(t[r].isEns=!0),n[e][r]=t[r])}e.AddressBookController.addressBook=n}return e}(r),t}};r.default=s}}},{package:"$root$"}],[126,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:38,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=38;const r=t.data;return t.data=function(e){const{ABTestController:t={}}=e,{abTests:r={}}=t;if(r.fullScreenVsPopup)return e;return{...e,ABTestController:{...t,abTests:{...r,fullScreenVsPopup:"control"}}}}(r),t}};r.default=i}}},{package:"$root$"}],[127,{"../../../shared/modules/hexstring-utils":7336,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/modules/hexstring-utils");const s="SAI";function a(e={}){return e&&"object"==typeof e&&"DAI"===e.symbol&&"0x89d24A6b4CcB1B6fAA2625fE562bDD9a23260359"===(0,i.toChecksumHexAddress)(e.address)}var o={version:39,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=39;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.tokens||[];if(Array.isArray(e))for(const t of e)a(t)&&(t.symbol=s);const r=t.accountTokens||{};if(r&&"object"==typeof r)for(const e of Object.keys(r)){const t=r[e];if(t&&"object"==typeof t)for(const e of Object.keys(t)){const r=t[e];if(Array.isArray(r))for(const e of r)a(e)&&(e.symbol=s)}}}return e}(r),t}};r.default=o}}},{package:"$root$"}],[128,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:40,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=40;const r=t.data;return t.data=function(e){return delete e.ProviderApprovalController,e}(r),t}};r.default=i}}},{package:"$root$"}],[129,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:41,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=41;const r=t.data;return t.data=function(e){e.PreferencesController&&e.PreferencesController.preferences&&(e.PreferencesController.preferences.autoLockTimeLimit=e.PreferencesController.preferences.autoLogoutTimeLimit,delete e.PreferencesController.preferences.autoLogoutTimeLimit);return e}(r),t}};r.default=i}}},{package:"$root$"}],[13,{"../../../../shared/constants/network":7322,"../../../../shared/modules/hexstring-utils":7336,"./ens":12,"@metamask/obs-store":1608,loglevel:5597,"punycode/punycode":5933},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=u(e("punycode/punycode")),i=e("@metamask/obs-store"),s=u(e("loglevel")),a=e("../../../../shared/constants/network"),o=e("../../../../shared/modules/hexstring-utils"),c=u(e("./ens"));function u(e){return e&&e.__esModule?e:{default:e}}r.default=class{constructor({ens:e,provider:t,onNetworkDidChange:r,getCurrentChainId:n}={}){const s={ensResolutionsByAddress:{}};if(this._ens=e,!this._ens){const e=n(),r=a.CHAIN_ID_TO_NETWORK_ID_MAP[e];c.default.getNetworkEnsSupport(r)&&(this._ens=new c.default({network:r,provider:t}))}this.store=new i.ObservableStore(s),r((()=>{this.store.putState(s);const e=n(),r=a.CHAIN_ID_TO_NETWORK_ID_MAP[e];c.default.getNetworkEnsSupport(r)?this._ens=new c.default({network:r,provider:t}):delete this._ens}))}reverseResolveAddress(e){return this._reverseResolveAddress((0,o.toChecksumHexAddress)(e))}async _reverseResolveAddress(e){if(!this._ens)return undefined;const t=this.store.getState();if(t.ensResolutionsByAddress[e])return t.ensResolutionsByAddress[e];let r,i;try{r=await this._ens.reverse(e)}catch(e){return s.default.debug(e),undefined}try{i=await this._ens.lookup(r)}catch(e){return s.default.debug(e),undefined}return"0x0000000000000000000000000000000000000000"===i||"0x"===i||(0,o.toChecksumHexAddress)(i)!==e?undefined:(this._updateResolutionsByAddress(e,n.default.toASCII(r)),r)}_updateResolutionsByAddress(e,t){const r=this.store.getState();this.store.putState({ensResolutionsByAddress:{...r.ensResolutionsByAddress,[e]:t}})}}}}},{package:"$root$"}],[130,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:42,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=42;const r=t.data;return t.data=function(e){e.AppStateController?e.AppStateController.connectedStatusPopoverHasBeenShown=!1:e.AppStateController={connectedStatusPopoverHasBeenShown:!1};return e}(r),t}};r.default=i}}},{package:"$root$"}],[131,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:43,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=43;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.PreferencesController)&&void 0!==t&&t.currentAccountTab&&delete e.PreferencesController.currentAccountTab;return e}(r),t}};r.default=i}}},{package:"$root$"}],[132,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:44,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=44;const r=t.data;return t.data=function(e){var t;void 0!==(null==e||null===(t=e.AppStateController)||void 0===t?void 0:t.mkrMigrationReminderTimestamp)&&delete e.AppStateController.mkrMigrationReminderTimestamp;return e}(r),t}};r.default=i}}},{package:"$root$"}],[133,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:45,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=45;const r=t.data;return t.data=function(e){var t;s.includes(null==e||null===(t=e.PreferencesController)||void 0===t?void 0:t.ipfsGateway)&&(e.PreferencesController.ipfsGateway="dweb.link");return e}(r),t}};r.default=i;const s=["ipfs.io","ipfs.dweb.link"]}}},{package:"$root$"}],[134,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:46,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=46;const r=t.data;return t.data=function(e){void 0!==(null==e?void 0:e.ABTestController)&&delete e.ABTestController;return e}(r),t}};r.default=i}}},{package:"$root$"}],[135,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:47,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=47;const r=t.data;return t.data=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;Array.isArray(r)&&r.forEach((e=>{"number"==typeof e.metamaskNetworkId&&(e.metamaskNetworkId=e.metamaskNetworkId.toString())}));return e}(r),t}};r.default=i}}},{package:"$root$"}],[136,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:48,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=48;const r=t.data;return t.data=function(e={}){var t,r,n,i,o,c,u,l,d;null===(t=e.NetworkController)||void 0===t||delete t.settings;const h=(null===(r=e.NetworkController)||void 0===r?void 0:r.provider)||{};if(("rpc"!==h.type||"string"==typeof h.chainId&&a.test(h.chainId))&&"localhost"!==h.type){if(null!==(n=e.NetworkController)&&void 0!==n&&n.provider){var f,p;if("rpcTarget"in e.NetworkController.provider){const t=e.NetworkController.provider.rpcTarget;e.NetworkController.provider.rpcUrl=t}null===(f=e.NetworkController)||void 0===f||(null===(p=f.provider)||void 0===p||delete p.rpcTarget)}}else e.NetworkController.provider={type:"rinkeby",rpcUrl:"",chainId:"0x4",nickname:"",rpcPrefs:{},ticker:"ETH"};e.PreferencesController||(e.PreferencesController={});e.PreferencesController.frequentRpcListDetail||(e.PreferencesController.frequentRpcListDetail=[]);e.PreferencesController.frequentRpcListDetail.unshift({rpcUrl:"http://localhost:8545",chainId:"0x539",ticker:"ETH",nickname:"Localhost 8545",rpcPrefs:{}}),null===(i=e.CachedBalancesController)||void 0===i||delete i.cachedBalances;const m=null===(o=e.TransactionController)||void 0===o?void 0:o.transactions;Array.isArray(m)&&m.forEach((e=>{const t=null==e?void 0:e.metamaskNetworkId;"string"==typeof t&&s.test(t)&&(e.metamaskNetworkId=parseInt(t,16).toString(10))}));const g=(null===(c=e.AddressBookController)||void 0===c?void 0:c.addressBook)||{};Object.keys(g).forEach((e=>{if(/^\d+$/iu.test(e)){const t=`0x${parseInt(e,10).toString(16)}`;!function(e,t){Object.values(e).forEach((e=>{e&&"object"==typeof e&&(e.chainId=t)}))}(g[e],t),g[t]?function(e,t,r){const n=e[t]||{},i={...e[r]};Object.keys(n).forEach((e=>{if(i[e]&&"object"==typeof i[e]){const t={};new Set([...Object.keys(i[e]),...Object.keys(n[e]||{})]).forEach((r=>{var s;t[r]=i[e][r]||(null===(s=n[e])||void 0===s?void 0:s[r])||""})),i[e]=t}else n[e]&&"object"==typeof n[e]&&(i[e]=n[e])})),e[r]=i}(g,e,t):g[t]=g[e],delete g[e]}})),null===(u=e.IncomingTransactionsController)||void 0===u||null===(l=u.incomingTxLastFetchedBlocksByNetwork)||void 0===l||delete l.localhost;const y=null===(d=e.PreferencesController)||void 0===d?void 0:d.accountTokens;y&&Object.keys(y).forEach((e=>{var t,r;const n=(null===(t=y[e])||void 0===t?void 0:t.localhost)||[];if(n.length>0){const t=y[e].rpc||[];t.length>0?y[e].rpc=function(e,t){const r=s(e),n=s(t),i=[];return new Set([...Object.keys(r),...Object.keys(n)]).forEach((e=>{i.push({...r[e],...n[e]})})),i;function s(e){return e.reduce(((e,t)=>(null!=t&&t.address&&"string"==typeof(null==t?void 0:t.address)&&(e[t.address]=t),e)),{})}}(n,t):y[e].rpc=n}null===(r=y[e])||void 0===r||delete r.localhost}));return e}(r),t}};r.default=i;const s=/^0x[0-9a-f]+$/iu,a=/^0x[1-9a-f]+[0-9a-f]*$/iu}}},{package:"$root$"}],[137,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:49,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=49;const r=t.data;return t.data=function(e={}){if(e.PreferencesController){var t;const{metaMetricsId:r,participateInMetaMetrics:n,metaMetricsSendCount:i}=e.PreferencesController;e.MetaMetricsController=null!==(t=e.MetaMetricsController)&&void 0!==t?t:{},r!==undefined&&(e.MetaMetricsController.metaMetricsId=r,delete e.PreferencesController.metaMetricsId),n!==undefined&&(e.MetaMetricsController.participateInMetaMetrics=n,delete e.PreferencesController.participateInMetaMetrics),i!==undefined&&(e.MetaMetricsController.metaMetricsSendCount=i,delete e.PreferencesController.metaMetricsSendCount)}return e}(r),t}};r.default=i}}},{package:"$root$"}],[138,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");const i=["METASWAP_GAS_PRICE_ESTIMATES_LAST_RETRIEVED","METASWAP_GAS_PRICE_ESTIMATES","cachedFetch","BASIC_PRICE_ESTIMATES_LAST_RETRIEVED","BASIC_PRICE_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES"];var s={version:50,async migrate(e){const t=(0,n.cloneDeep)(e);return t.meta.version=50,i.forEach((e=>{var t;return null===(t=window.localStorage)||void 0===t?void 0:t.removeItem(e)})),t}};r.default=s}}},{package:"$root$"}],[139,{"../../../shared/constants/network":7322,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/network");var s={version:51,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=51;const r=t.data;return t.data=function(e){var t,r;const{chainId:n,type:s}=(null==e||null===(t=e.NetworkController)||void 0===t?void 0:t.provider)||{},a=null===(r=i.NETWORK_TYPE_TO_ID_MAP[s])||void 0===r?void 0:r.chainId;a&&n!==a&&(e.NetworkController.provider.chainId=a);return e}(r),t}};r.default=s}}},{package:"$root$"}],[14,{"../../../shared/constants/network":7322,"../../../shared/constants/transaction":7329,"../../../shared/modules/fetch-with-timeout":7334,"../../../shared/modules/random-id":7340,"../lib/util":88,"@metamask/obs-store":1608,"bn.js":2390,loglevel:5597},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("@metamask/obs-store"),i=d(e("loglevel")),s=d(e("bn.js")),a=d(e("../../../shared/modules/random-id")),o=e("../lib/util"),c=d(e("../../../shared/modules/fetch-with-timeout")),u=e("../../../shared/constants/transaction"),l=e("../../../shared/constants/network");function d(e){return e&&e.__esModule?e:{default:e}}const h=(0,c.default)(),f=[l.GOERLI_CHAIN_ID,l.KOVAN_CHAIN_ID,l.MAINNET_CHAIN_ID,l.RINKEBY_CHAIN_ID,l.ROPSTEN_CHAIN_ID];function p(e,t){let r,n=!0;return i=>{try{return n?(n=!1,e(null!=t?t:i,i)):e(r,i)}finally{r=i}}}r.default=class{constructor(e={}){const{blockTracker:t,onNetworkDidChange:r,getCurrentChainId:i,preferencesController:s}=e;this.blockTracker=t,this.getCurrentChainId=i,this.preferencesController=s,this._onLatestBlock=async e=>{const t=this.preferencesController.getSelectedAddress(),r=parseInt(e,16);await this._update(t,r)};const a={incomingTransactions:{},incomingTxLastFetchedBlockByChainId:{[l.GOERLI_CHAIN_ID]:null,[l.KOVAN_CHAIN_ID]:null,[l.MAINNET_CHAIN_ID]:null,[l.RINKEBY_CHAIN_ID]:null,[l.ROPSTEN_CHAIN_ID]:null},...e.initState};this.store=new n.ObservableStore(a),this.preferencesController.store.subscribe(p(((e,t)=>{const{featureFlags:{showIncomingTransactions:r}={}}=e,{featureFlags:{showIncomingTransactions:n}={}}=t;n!==r&&(!r||n?this.start():this.stop())}),this.preferencesController.store.getState())),this.preferencesController.store.subscribe(p((async(e,t)=>{const{selectedAddress:r}=e,{selectedAddress:n}=t;n!==r&&await this._update(n)}),this.preferencesController.store.getState())),r((async()=>{const e=this.preferencesController.getSelectedAddress();await this._update(e)}))}start(){const{featureFlags:e={}}=this.preferencesController.store.getState(),{showIncomingTransactions:t}=e;t&&(this.blockTracker.removeListener("latest",this._onLatestBlock),this.blockTracker.addListener("latest",this._onLatestBlock))}stop(){this.blockTracker.removeListener("latest",this._onLatestBlock)}async _update(e,t){const r=this.getCurrentChainId();if(f.includes(r)&&e)try{var n;const i=this.store.getState(),s=parseInt(this.blockTracker.getCurrentBlock(),16),a=i.incomingTxLastFetchedBlockByChainId[r],o=null!==(n=null!=a?a:t)&&void 0!==n?n:s,c=await this._getNewIncomingTransactions(e,o,r);let u=o;c.forEach((e=>{e.blockNumber&&parseInt(u,10)<parseInt(e.blockNumber,10)&&(u=parseInt(e.blockNumber,10))})),this.store.updateState({incomingTxLastFetchedBlockByChainId:{...i.incomingTxLastFetchedBlockByChainId,[r]:u+1},incomingTransactions:c.reduce(((e,t)=>(e[t.hash]=t,e)),{...i.incomingTransactions})})}catch(e){i.default.error(e)}}async _getNewIncomingTransactions(e,t,r){let n=`${`https://${r===l.MAINNET_CHAIN_ID?"api":`api-${l.CHAIN_ID_TO_TYPE_MAP[r]}`}.etherscan.io`}/api?module=account&action=txlist&address=${e}&tag=latest&page=1`;t&&(n+=`&startBlock=${parseInt(t,10)}`);const i=await h(n),{status:s,result:a}=await i.json();let o=[];if("1"===s&&Array.isArray(a)&&a.length>0){const t={},n=[];a.forEach((e=>{t[e.hash]||(n.push(this._normalizeTxFromEtherscan(e,r)),t[e.hash]=1)})),o=n.filter((t=>{var r,n;return(null===(r=t.txParams)||void 0===r||null===(n=r.to)||void 0===n?void 0:n.toLowerCase())===e.toLowerCase()})),o.sort(((e,t)=>e.time<t.time?-1:1))}return o}_normalizeTxFromEtherscan(e,t){const r=1e3*parseInt(e.timeStamp,10),n="0"===e.isError?u.TRANSACTION_STATUSES.CONFIRMED:u.TRANSACTION_STATUSES.FAILED,i={from:e.from,gas:(0,o.bnToHex)(new s.default(e.gas)),nonce:(0,o.bnToHex)(new s.default(e.nonce)),to:e.to,value:(0,o.bnToHex)(new s.default(e.value))};return e.gasPrice?i.gasPrice=(0,o.bnToHex)(new s.default(e.gasPrice)):e.maxFeePerGas&&(i.maxFeePerGas=(0,o.bnToHex)(new s.default(e.maxFeePerGas)),i.maxPriorityFeePerGas=(0,o.bnToHex)(new s.default(e.maxPriorityFeePerGas))),{blockNumber:e.blockNumber,id:(0,a.default)(),chainId:t,metamaskNetworkId:l.CHAIN_ID_TO_NETWORK_ID_MAP[t],status:n,time:r,txParams:i,hash:e.hash,type:u.TRANSACTION_TYPES.INCOMING}}}}}},{package:"$root$"}],[140,{"../../../shared/constants/network":7322,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/network");var s={version:52,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=52;const r=t.data;return t.data=function(e={}){if(e.PreferencesController){const{accountTokens:t,accountHiddenTokens:r,frequentRpcListDetail:n}=e.PreferencesController,s={},a={};if(t&&Object.keys(t).length>0){for(const e of Object.keys(t)){s[e]={},t[e][i.NETWORK_TYPE_RPC]&&n.forEach((r=>{s[e][r.chainId]=t[e][i.NETWORK_TYPE_RPC]}));for(const r of Object.keys(t[e]))switch(r){case i.MAINNET:s[e][i.MAINNET_CHAIN_ID]=t[e][i.MAINNET];break;case i.ROPSTEN:s[e][i.ROPSTEN_CHAIN_ID]=t[e][i.ROPSTEN];break;case i.RINKEBY:s[e][i.RINKEBY_CHAIN_ID]=t[e][i.RINKEBY];break;case i.GOERLI:s[e][i.GOERLI_CHAIN_ID]=t[e][i.GOERLI];break;case i.KOVAN:s[e][i.KOVAN_CHAIN_ID]=t[e][i.KOVAN]}}e.PreferencesController.accountTokens=s}if(r&&Object.keys(r).length>0){for(const e of Object.keys(r)){a[e]={},r[e][i.NETWORK_TYPE_RPC]&&n.forEach((t=>{a[e][t.chainId]=r[e][i.NETWORK_TYPE_RPC]}));for(const t of Object.keys(r[e]))switch(t){case i.MAINNET:a[e][i.MAINNET_CHAIN_ID]=r[e][i.MAINNET];break;case i.ROPSTEN:a[e][i.ROPSTEN_CHAIN_ID]=r[e][i.ROPSTEN];break;case i.RINKEBY:a[e][i.RINKEBY_CHAIN_ID]=r[e][i.RINKEBY];break;case i.GOERLI:a[e][i.GOERLI_CHAIN_ID]=r[e][i.GOERLI];break;case i.KOVAN:a[e][i.KOVAN_CHAIN_ID]=r[e][i.KOVAN]}}e.PreferencesController.accountHiddenTokens=a}}return e}(r),t}};r.default=s}}},{package:"$root$"}],[141,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var s={version:53,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=53;const r=t.data;return t.data=function(e){var t,r;const n=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions,s=null==e||null===(r=e.IncomingTransactionsController)||void 0===r?void 0:r.incomingTransactions;Array.isArray(n)&&n.forEach((e=>{e&&(e.type!==i.TRANSACTION_TYPES.RETRY&&e.type!==i.TRANSACTION_TYPES.CANCEL&&(e.type=e.transactionCategory),delete e.transactionCategory)}));if(s){Object.entries(s).forEach((([t,r])=>{r&&(delete r.transactionCategory,e.IncomingTransactionsController.incomingTransactions[t]={...r,type:i.TRANSACTION_TYPES.INCOMING})}))}return e}(r),t}};r.default=s}}},{package:"$root$"}],[142,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");function i(e){return"number"==typeof e||"string"==typeof e&&e.match(/^(0x)?\d+$/u)}var s={version:54,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=54;const r=function(e){const t=e;if(!t.PreferencesController)return t;const r=(t.PreferencesController.tokens||[]).filter((({decimals:e})=>i(e)));for(const e of r)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t.PreferencesController.tokens=r;const{accountTokens:n}=t.PreferencesController;if(n&&"object"==typeof n)for(const e of Object.keys(n)){const t=n[e];if(t&&"object"==typeof t)for(const e of Object.keys(t)){const r=(t[e]||[]).filter((({decimals:e})=>i(e)));for(const e of r)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t[e]=r}}return t.PreferencesController.accountTokens=n,t}(t.data);return t.data=r,t}};r.default=s}}},{package:"$root$"}],[1424,{buffer:2434},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){function r(t,r){const n=JSON.stringify(r),i=e.from(n,"utf-8"),s=global.crypto.getRandomValues(new Uint8Array(16));return global.crypto.subtle.encrypt({name:"AES-GCM",iv:s},t,i).then((function(t){const r=new Uint8Array(t),n=e.from(s).toString("base64");return{data:e.from(r).toString("base64"),iv:n}}))}function n(t,r){const n=e.from(r.data,"base64"),i=e.from(r.iv,"base64");return crypto.subtle.decrypt({name:"AES-GCM",iv:i},t,n).then((function(t){const r=new Uint8Array(t),n=e.from(r).toString("utf-8");return JSON.parse(n)})).catch((function(e){throw new Error("Incorrect password")}))}function i(t,r){const n=e.from(t,"utf-8"),i=e.from(r,"base64");return global.crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then((function(e){return global.crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:1e4,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}))}function s(e){let t=e.toString(16);for(;t.length<2;)t=`0${t}`;return t}function a(e=32){const t=new Uint8Array(e);global.crypto.getRandomValues(t);return btoa(String.fromCharCode.apply(null,t))}t.exports={encrypt:function(e,t){const n=a();return i(e,n).then((function(e){return r(e,t)})).then((function(e){return e.salt=n,JSON.stringify(e)}))},decrypt:function(e,t){const r=JSON.parse(t),{salt:s}=r;return i(e,s).then((function(e){return n(e,r)}))},keyFromPassword:i,encryptWithKey:r,decryptWithKey:n,serializeBufferForStorage:function(e){let t="0x";const r=e.length||e.byteLength;for(let n=0;n<r;n++)t+=s(e[n]);return t},serializeBufferFromStorage:function(e){const t="0x"===e.slice(0,2)?e.slice(2):e,r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t.substr(e,2);r[e/2]=parseInt(n,16)}return r},generateSalt:a}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snap-controllers>@metamask/browser-passworder"}],[143,{"../../../shared/constants/network":7322,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/network");var s={version:55,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=55;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.IncomingTransactionsController)&&void 0!==t&&t.incomingTxLastFetchedBlocksByNetwork&&(e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId=(0,n.mapKeys)(e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork,((e,t)=>{var r,n;return null!==(r=null===(n=i.NETWORK_TYPE_TO_ID_MAP[t])||void 0===n?void 0:n.chainId)&&void 0!==r?r:a})),delete e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId.UNKNOWN,delete e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork);return e}(r),t}};r.default=s;const a="UNKNOWN"}}},{package:"$root$"}],[144,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:56,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=56;const{PreferencesController:r}=t.data;return Array.isArray(null==r?void 0:r.tokens)&&(r.tokens=r.tokens.filter((({address:e})=>e))),null!=r&&r.accountTokens&&"object"==typeof r.accountTokens&&Object.keys(r.accountTokens).forEach((e=>{Object.keys(r.accountTokens[e]).forEach((t=>{r.accountTokens[e][t]=r.accountTokens[e][t].filter((({address:e})=>e))}))})),null!=r&&r.assetImages&&"undefined"in r.assetImages&&delete r.assetImages.undefined,t}};r.default=i}}},{package:"$root$"}],[145,{"../../../shared/modules/random-id":7340,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=e("lodash"),s=(n=e("../../../shared/modules/random-id"))&&n.__esModule?n:{default:n};var a={version:57,async migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=57;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.TransactionController)&&void 0!==t&&t.transactions&&Array.isArray(e.TransactionController.transactions)&&!e.TransactionController.transactions.some((e=>"object"!=typeof e||void 0===e.txParams))&&(e.TransactionController.transactions=(0,i.keyBy)(e.TransactionController.transactions,(e=>(void 0!==e.id&&null!==e.id||(e.id=(0,s.default)()),e.id))));return e}(r),t}};r.default=a}}},{package:"$root$"}],[146,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:58,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=58;const r=t.data;return t.data=function(e){var t;return null===(t=e.AppStateController)||void 0===t||delete t.swapsWelcomeMessageHasBeenShown,e}(r),t}};r.default=i}}},{package:"$root$"}],[147,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var s={version:59,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=59;const r=t.data;return t.data=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,n.isPlainObject)(r)){const t=(0,n.groupBy)(Object.values(r),(e=>{var t,r;return`${null===(t=e.txParams)||void 0===t?void 0:t.nonce}-${null!==(r=e.chainId)&&void 0!==r?r:e.metamaskNetworkId}`})),s=(0,n.pickBy)(t,(e=>e.some((e=>e.type!==i.TRANSACTION_TYPES.CANCEL&&e.type!==i.TRANSACTION_TYPES.RETRY))));e.TransactionController.transactions=(0,n.keyBy)((0,n.concat)(...Object.values(s)),(e=>e.id))}return e}(r),t}};r.default=s}}},{package:"$root$"}],[148,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");const i="2020-08-31";var s={version:60,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=60;const r=function(e){var t;const r=null==e||null===(t=e.NotificationController)||void 0===t?void 0:t.notifications;var s;(0,n.isPlainObject)(r)&&(null===(s=r[2])||void 0===s?void 0:s.date)===i&&delete e.NotificationController.notifications[2];return e}(t.data);return t.data=r,t}};r.default=s}}},{package:"$root$"}],[149,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:61,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=61;const r=function(e){const t=(new Date).getTime();e.AppStateController?(e.AppStateController.recoveryPhraseReminderHasBeenShown=!1,e.AppStateController.recoveryPhraseReminderLastShown=t):e.AppStateController={recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:t};return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[15,{"../../../shared/constants/app":7316,"../../../shared/constants/metametrics":7321,"../../../shared/constants/time":7327,"@metamask/obs-store":1608,buffer:2434,"ethereumjs-util":2891,lodash:5584,pubnub:5861},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("@metamask/obs-store"),s=e("ethereumjs-util"),a=e("pubnub"),o=e("../../../shared/constants/app"),c=e("../../../shared/constants/metametrics"),u=e("../../../shared/constants/time");function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const d=e=>{setTimeout((()=>{throw e}))},h={'You must pass either an "anonymousId" or a "userId".':!0};r.default=class{constructor({segment:e,preferencesStore:t,onNetworkDidChange:r,getCurrentChainId:s,getNetworkIdentifier:a,version:o,environment:c,initState:f,extension:p,captureException:m=d}){l(this,"_getAllNFTsFlattened",(0,n.memoize)(((e={})=>Object.values(e).reduce(((e,t)=>e.concat(...Object.values(t))),[])))),l(this,"_isValidTraitArray",(e=>Array.isArray(e)&&(e.every((e=>"string"==typeof e))||e.every((e=>"boolean"==typeof e))||e.every((e=>"number"==typeof e))))),l(this,"_isValidTraitDate",(e=>"[object Date]"===Object.prototype.toString.call(e))),this._captureException=e=>{h[e.message]||m(e)};const g=t.getState();this.chainId=s(),this.network=a(),this.locale=g.currentLocale.replace("_","-"),this.version="production"===c?o:`${o}-${c}`,this.extension=p,this.environment=c;const y=(0,n.omitBy)(null==f?void 0:f.fragments,"persist");this.store=new i.ObservableStore({participateInMetaMetrics:null,metaMetricsId:null,eventsBeforeMetricsOptIn:[],traits:{},...f,fragments:{...null==f?void 0:f.fragments}}),t.subscribe((({currentLocale:e})=>{this.locale=e.replace("_","-")})),r((()=>{this.chainId=s(),this.network=a()})),this.segment=e,Object.values(y).forEach((e=>{this.finalizeEventFragment(e.id,{abandoned:!0})})),setInterval((()=>{Object.values(this.store.getState().fragments).forEach((e=>{e.timeout&&Date.now()-e.lastUpdated/1e3>e.timeout&&this.finalizeEventFragment(e.id,{abandoned:!0})}))}),30*u.SECOND)}generateMetaMetricsId(){return(0,s.bufferToHex)((0,s.keccak)(t.from(String(Date.now())+String(Math.round(Math.random()*Number.MAX_SAFE_INTEGER)))))}createEventFragment(e){var t;if(!e.successEvent||!e.category)throw new Error(`Must specify success event and category. Success event was: ${e.event}. Category was: ${e.category}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`);const{fragments:r}=this.store.getState(),n=null!==(t=e.uniqueIdentifier)&&void 0!==t?t:(0,a.generateUUID)(),i={id:n,...e,lastUpdated:Date.now()};return this.store.updateState({fragments:{...r,[n]:i}}),e.initialEvent&&this.trackEvent({event:i.initialEvent,category:i.category,properties:i.properties,sensitiveProperties:i.sensitiveProperties,page:i.page,referrer:i.referrer,revenue:i.revenue,value:i.value,currency:i.currency,environmentType:i.environmentType}),i}getEventFragmentById(e){const{fragments:t}=this.store.getState();return t[e]}updateEventFragment(e,t){const{fragments:r}=this.store.getState();if(!r[e])throw new Error(`Event fragment with id ${e} does not exist.`);this.store.updateState({fragments:{...r,[e]:(0,n.merge)(r[e],{...t,lastUpdated:Date.now()})}})}finalizeEventFragment(e,{abandoned:t=!1,page:r,referrer:n}={}){var i;const s=this.store.getState().fragments[e];if(!s)throw new Error(`Funnel with id ${e} does not exist.`);const a=t?s.failureEvent:s.successEvent;this.trackEvent({event:a,category:s.category,properties:s.properties,sensitiveProperties:s.sensitiveProperties,page:null!=r?r:s.page,referrer:null!==(i=s.referrer)&&void 0!==i?i:n,revenue:s.revenue,value:s.value,currency:s.currency,environmentType:s.environmentType});const{fragments:o}=this.store.getState();delete o[e],this.store.updateState({fragments:o})}identify(e){const{metaMetricsId:t,participateInMetaMetrics:r}=this.state;if(!r||!t||!e)return;if("object"!=typeof e)return void console.warn("MetaMetricsController#identify: userTraits parameter must be an object. Received type: "+typeof e);const n=this._buildValidTraits(e);this._identify(n)}updateExtensionUninstallUrl(e,r){const n={};e&&(n.mmi=t.from(r).toString("base64"),n.env=this.environment,n.av=this.version);new URLSearchParams(n);this.extension&&this.extension.runtime}setParticipateInMetaMetrics(e){let{metaMetricsId:t}=this.state;return e&&!t?t=this.generateMetaMetricsId():!1===e&&(t=null),this.store.updateState({participateInMetaMetrics:e,metaMetricsId:t}),e&&(this.trackEventsAfterMetricsOptIn(),this.clearEventsAfterMetricsOptIn()),this.updateExtensionUninstallUrl(e,t),t}get state(){return this.store.getState()}trackPage({name:e,params:t,environmentType:r,page:n,referrer:i},s){try{if(!1===this.state.participateInMetaMetrics)return;if(null===this.state.participateInMetaMetrics&&(null==s||!s.isOptInPath))return;const{metaMetricsId:a}=this.state,o=a?"userId":"anonymousId",u=null!=a?a:c.METAMETRICS_ANONYMOUS_ID;this.segment.page({[o]:u,name:e,properties:{params:t,locale:this.locale,network:this.network,chain_id:this.chainId,environment_type:r},context:this._buildContext(i,n)})}catch(e){this._captureException(e)}}trackEvent(e,t){this.validatePayload(e),this.submitEvent(e,t).catch((e=>this._captureException(e)))}async submitEvent(e,t){if(this.validatePayload(e),!(this.state.participateInMetaMetrics||null!=t&&t.isOptIn))return;const r=[];if(e.sensitiveProperties){if(!0===(null==t?void 0:t.excludeMetaMetricsId))throw new Error("sensitiveProperties was specified in an event payload that also set the excludeMetaMetricsId flag");const i=(0,n.merge)(e.sensitiveProperties,e.properties);r.push(this._track(this._buildEventPayload({...e,properties:i}),{...t,excludeMetaMetricsId:!0}))}r.push(this._track(this._buildEventPayload(e),t)),await Promise.all(r)}validatePayload(e){if(!e.event||!e.category)throw new Error(`Must specify event and category. Event was: ${e.event}. Category was: ${e.category}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`)}handleMetaMaskStateUpdate(e){const t=this._buildUserTraitsObject(e);t&&this.identify(t)}trackEventsAfterMetricsOptIn(){const{eventsBeforeMetricsOptIn:e}=this.store.getState();e.forEach((e=>{this.trackEvent(e)}))}clearEventsAfterMetricsOptIn(){this.store.updateState({eventsBeforeMetricsOptIn:[]})}addEventBeforeMetricsOptIn(e){const t=this.store.getState().eventsBeforeMetricsOptIn;this.store.updateState({eventsBeforeMetricsOptIn:[...t,e]})}updateTraits(e){const{traits:t}=this.store.getState();this.store.updateState({traits:{...t,...e}})}_buildContext(e,t=c.METAMETRICS_BACKGROUND_PAGE_OBJECT){return{app:{name:"MetaMask Extension",version:this.version},userAgent:window.navigator.userAgent,page:t,referrer:e}}_buildEventPayload(e){var t,r;const{event:i,properties:s,revenue:a,value:c,currency:u,category:l,page:d,referrer:h,environmentType:f=o.ENVIRONMENT_TYPE_BACKGROUND}=e;return{event:i,properties:{...(0,n.omit)(s,["revenue","locale","currency","value"]),revenue:a,value:c,currency:u,category:l,network:null!==(t=null==s?void 0:s.network)&&void 0!==t?t:this.network,locale:this.locale,chain_id:null!==(r=null==s?void 0:s.chain_id)&&void 0!==r?r:this.chainId,environment_type:f},context:this._buildContext(h,d)}}_buildUserTraitsObject(e){const{traits:t}=this.store.getState(),r={[c.TRAITS.ADDRESS_BOOK_ENTRIES]:(0,n.sum)(Object.values(e.addressBook).map(n.size)),[c.TRAITS.INSTALL_DATE_EXT]:t[c.TRAITS.INSTALL_DATE_EXT]||"",[c.TRAITS.LEDGER_CONNECTION_TYPE]:e.ledgerTransportType,[c.TRAITS.NETWORKS_ADDED]:e.frequentRpcListDetail.map((e=>e.chainId)),[c.TRAITS.NETWORKS_WITHOUT_TICKER]:e.frequentRpcListDetail.reduce(((e,t)=>(t.ticker||e.push(t.chainId),e)),[]),[c.TRAITS.NFT_AUTODETECTION_ENABLED]:e.useCollectibleDetection,[c.TRAITS.NUMBER_OF_ACCOUNTS]:Object.values(e.identities).length,[c.TRAITS.NUMBER_OF_NFT_COLLECTIONS]:this._getAllUniqueNFTAddressesLength(e.allCollectibles),[c.TRAITS.NUMBER_OF_NFTS]:this._getAllNFTsFlattened(e.allCollectibles).length,[c.TRAITS.NUMBER_OF_TOKENS]:this._getNumberOfTokens(e),[c.TRAITS.OPENSEA_API_ENABLED]:e.openSeaEnabled,[c.TRAITS.THREE_BOX_ENABLED]:e.threeBoxSyncingAllowed,[c.TRAITS.THEME]:e.theme||"default",[c.TRAITS.TOKEN_DETECTION_ENABLED]:e.useTokenDetection};if(!this.previousTraits)return this.previousTraits=r,r;if(this.previousTraits&&!(0,n.isEqual)(this.previousTraits,r)){const e=(0,n.pickBy)(r,((e,t)=>!(0,n.isEqual)(this.previousTraits[t],e)));return this.previousTraits=r,e}return null}_buildValidTraits(e){return Object.entries(e).reduce(((e,[t,r])=>(this._isValidTraitDate(r)?e[t]=r.toISOString():this._isValidTrait(r)?e[t]=r:console.warn(`MetaMetricsController: "${t}" value is not a valid trait type`),e)),{})}_getAllUniqueNFTAddressesLength(e={}){const t=this._getAllNFTsFlattened(e).map((e=>e.address));return new Set(t).size}_getNumberOfTokens(e){return Object.values(e.allTokens).reduce(((e,t)=>e+(0,n.sum)(Object.values(t).map(n.size))),0)}_identify(e){const{metaMetricsId:t}=this.state;if(e&&0!==Object.keys(e).length)try{this.segment.identify({userId:t,traits:e})}catch(e){this._captureException(e)}else console.warn("MetaMetricsController#_identify: No userTraits found")}_isValidTrait(e){const t=typeof e;return"string"===t||"boolean"===t||"number"===t||this._isValidTraitArray(e)||this._isValidTraitDate(e)}_track(e,t){var r;const{isOptIn:n,metaMetricsId:i,matomoEvent:s,flushImmediately:a}=t||{};let o="userId",u=this.state.metaMetricsId,l=null!==(r=null==t?void 0:t.excludeMetaMetricsId)&&void 0!==r&&r;return Boolean(e.event.match(/^send|^confirm/iu))&&(l=!0),l||n&&!i?(o="anonymousId",u=c.METAMETRICS_ANONYMOUS_ID):n&&i&&(u=i),e[o]=u,!0===s&&(e.properties.legacy_event=!0),new Promise(((t,r)=>{this.segment.track(e,(e=>{if(e){const t=new Error(e.message);return t.stack=e.stack,r(t)}return t()})),a&&this.segment.flush()}))}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$"}],[150,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:62,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=62;const r=function(e){if(e.MetaMetricsController){const{metaMetricsSendCount:t}=e.MetaMetricsController;t!==undefined&&delete e.MetaMetricsController.metaMetricsSendCount}return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[151,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:63,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=63;const r=function(e){var t,r,n,i,s,a,o,c;const u=null==e||null===(t=e.PreferencesController)||void 0===t?void 0:t.accountTokens,l=null==e||null===(r=e.PreferencesController)||void 0===r?void 0:r.accountHiddenTokens,d={};u&&Object.keys(u).forEach((e=>{Object.keys(u[e]).forEach((t=>{const r=u[e][t];d[t]===undefined?d[t]={[e]:r}:d[t]={...d[t],[e]:r}}))}));const h={};l&&Object.keys(l).forEach((e=>{Object.keys(l[e]).forEach((t=>{const r=l[e][t];h[t]===undefined?h[t]={[e]:r}:h[t]={...h[t],[e]:r}}))}));e.TokensController?(e.TokensController.allTokens=d,e.TokensController.allIgnoredTokens=h):e.TokensController={allTokens:d,allIgnoredTokens:h};return null==e||(null===(n=e.PreferencesController)||void 0===n||delete n.accountHiddenTokens),null==e||null===(i=e.PreferencesController)||void 0===i||delete i.accountTokens,null==e||null===(s=e.PreferencesController)||void 0===s||delete s.assetImages,null==e||null===(a=e.PreferencesController)||void 0===a||delete a.hiddenTokens,null==e||null===(o=e.PreferencesController)||void 0===o||delete o.tokens,null==e||null===(c=e.PreferencesController)||void 0===c||delete c.suggestedTokens,e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[1516,{"@ethereumjs/tx":600,buffer:2434,"eth-sig-util":1517,"ethereumjs-util":2891,events:2435,hdkey:1523},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const{EventEmitter:n}=e("events"),i=e("hdkey"),s=e("ethereumjs-util"),a=e("eth-sig-util"),{TransactionFactory:o}=e("@ethereumjs/tx"),c="m",u="Ledger Hardware",l={ropsten:"http://api-ropsten.etherscan.io",kovan:"http://api-kovan.etherscan.io",rinkeby:"https://api-rinkeby.etherscan.io",mainnet:"https://api.etherscan.io"};class d extends n{constructor(e={}){super(),this.accountDetails={},this.bridgeUrl=null,this.type=u,this.page=0,this.perPage=5,this.unlockedAccount=0,this.hdk=new i,this.paths={},this.iframe=null,this.network="mainnet",this.implementFullBIP44=!1,this.deserialize(e),this.iframeLoaded=!1,this._setupIframe(),this.currentMessageId=0,this.messageCallbacks={},this._setupListener()}serialize(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts,accountDetails:this.accountDetails,bridgeUrl:this.bridgeUrl,implementFullBIP44:!1})}deserialize(e={}){return this.hdPath=e.hdPath||"m/44'/60'/0'",this.bridgeUrl=e.bridgeUrl||"https://metamask.github.io/eth-ledger-bridge-keyring",this.accounts=e.accounts||[],this.accountDetails=e.accountDetails||{},e.accountDetails||this._migrateAccountDetails(e),this.implementFullBIP44=e.implementFullBIP44||!1,this.accounts=this.accounts.filter((e=>Object.keys(this.accountDetails).includes(s.toChecksumAddress(e)))),Promise.resolve()}_migrateAccountDetails(e){if(this._isLedgerLiveHdPath()&&e.accountIndexes)for(const t of Object.keys(e.accountIndexes))this.accountDetails[t]={bip44:!0,hdPath:this._getPathForIndex(e.accountIndexes[t])};this._isLedgerLiveHdPath()||this.accounts.filter((e=>!Object.keys(this.accountDetails).includes(s.toChecksumAddress(e)))).forEach((e=>{try{this.accountDetails[s.toChecksumAddress(e)]={bip44:!1,hdPath:this._pathFromAddress(e)}}catch(t){console.log(`failed to migrate account ${e}`)}}))}isUnlocked(){return Boolean(this.hdk&&this.hdk.publicKey)}isConnected(){return this.isDeviceConnected}setAccountToUnlock(e){this.unlockedAccount=parseInt(e,10)}setHdPath(e){this.hdPath!==e&&(this.hdk=new i),this.hdPath=e}unlock(e,t=!0){if(this.isUnlocked()&&!e)return Promise.resolve("already unlocked");const n=e?this._toLedgerPath(e):this.hdPath;return new Promise(((e,i)=>{this._sendMessage({action:"ledger-unlock",params:{hdPath:n}},(({success:n,payload:s})=>{n?(t&&(this.hdk.publicKey=r.from(s.publicKey,"hex"),this.hdk.chainCode=r.from(s.chainCode,"hex")),e(s.address)):i(s.error||new Error("Unknown error"))}))}))}addAccounts(e=1){return new Promise(((t,r)=>{this.unlock().then((async r=>{const n=this.unlockedAccount,i=n+e;for(let e=n;e<i;e++){const t=this._getPathForIndex(e);let r;r=this._isLedgerLiveHdPath()?await this.unlock(t):this._addressFromIndex(c,e),this.accountDetails[s.toChecksumAddress(r)]={bip44:this._isLedgerLiveHdPath(),hdPath:t},this.accounts.includes(r)||this.accounts.push(r),this.page=0}t(this.accounts)})).catch(r)}))}getFirstPage(){return this.page=0,this.__getPage(1)}getNextPage(){return this.__getPage(1)}getPreviousPage(){return this.__getPage(-1)}getAccounts(){return Promise.resolve(this.accounts.slice())}removeAccount(e){if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase())),delete this.accountDetails[s.toChecksumAddress(e)]}attemptMakeApp(){return new Promise(((e,t)=>{this._sendMessage({action:"ledger-make-app"},(({success:r,error:n})=>{r?e(!0):t(n)}))}))}updateTransportMethod(e){return new Promise(((t,r)=>{this.iframeLoaded?this._sendMessage({action:"ledger-update-transport",params:{transportType:e}},(({success:e})=>{e?t(!0):r(new Error("Ledger transport could not be updated"))})):this.delayedPromise={resolve:t,reject:r,transportType:e}}))}signTransaction(e,t){let n;if("function"==typeof t.getChainId)return t.v=s.bufferToHex(t.getChainId()),t.r="0x00",t.s="0x00",n=t.serialize().toString("hex"),this._signTransaction(e,n,(e=>(t.v=r.from(e.v,"hex"),t.r=r.from(e.r,"hex"),t.s=r.from(e.s,"hex"),t)));const i=t.getMessageToSign(!1);return n=r.isBuffer(i)?i.toString("hex"):s.rlp.encode(i).toString("hex"),this._signTransaction(e,n,(e=>{const r=t.toJSON();return r.type=t.type,r.v=s.addHexPrefix(e.v),r.r=s.addHexPrefix(e.r),r.s=s.addHexPrefix(e.s),o.fromTxData(r,{common:t.common,freeze:Object.isFrozen(t)})}))}_signTransaction(e,t,r){return new Promise(((n,i)=>{this.unlockAccountByAddress(e).then((e=>{this._sendMessage({action:"ledger-sign-transaction",params:{tx:t,hdPath:e}},(({success:e,payload:t})=>{if(e){const e=r(t);e.verifySignature()?n(e):i(new Error("Ledger: The transaction signature is not valid"))}else i(t.error||new Error("Ledger: Unknown error while signing transaction"))}))})).catch(i)}))}signMessage(e,t){return this.signPersonalMessage(e,t)}signPersonalMessage(e,t){return new Promise(((r,n)=>{this.unlockAccountByAddress(e).then((i=>{this._sendMessage({action:"ledger-sign-personal-message",params:{hdPath:i,message:s.stripHexPrefix(t)}},(({success:i,payload:o})=>{if(i){let i=o.v-27;i=i.toString(16),i.length<2&&(i=`0${i}`);const c=`0x${o.r}${o.s}${i}`,u=a.recoverPersonalSignature({data:t,sig:c});s.toChecksumAddress(u)!==s.toChecksumAddress(e)&&n(new Error("Ledger: The signature doesnt match the right address")),r(c)}else n(o.error||new Error("Ledger: Unknown error while signing message"))}))})).catch(n)}))}async unlockAccountByAddress(e){const t=s.toChecksumAddress(e);if(!Object.keys(this.accountDetails).includes(t))throw new Error(`Ledger: Account for address '${t}' not found`);const{hdPath:r}=this.accountDetails[t];if((await this.unlock(r,!1)).toLowerCase()!==e.toLowerCase())throw new Error(`Ledger: Account ${e} does not belong to the connected device`);return r}async signTypedData(e,t,r={}){const n="V4"===r.version;if(!n)throw new Error("Ledger: Only version 4 of typed data signing is supported");const{domain:i,types:o,primaryType:c,message:u}=a.TypedDataUtils.sanitizeData(t),l=a.TypedDataUtils.hashStruct("EIP712Domain",i,o,n).toString("hex"),d=a.TypedDataUtils.hashStruct(c,u,o,n).toString("hex"),h=await this.unlockAccountByAddress(e),{success:f,payload:p}=await new Promise((e=>{this._sendMessage({action:"ledger-sign-typed-data",params:{hdPath:h,domainSeparatorHex:l,hashStructMessageHex:d}},(t=>e(t)))}));if(f){let r=p.v-27;r=r.toString(16),r.length<2&&(r=`0${r}`);const n=`0x${p.r}${p.s}${r}`,i=a.recoverTypedSignature_v4({data:t,sig:n});if(s.toChecksumAddress(i)!==s.toChecksumAddress(e))throw new Error("Ledger: The signature doesnt match the right address");return n}throw p.error||new Error("Ledger: Unknown error while signing message")}exportAccount(){throw new Error("Not supported on this device")}forgetDevice(){this.accounts=[],this.page=0,this.unlockedAccount=0,this.paths={},this.accountDetails={},this.hdk=new i}_setupIframe(){this.iframe=document.createElement("iframe"),this.iframe.src=this.bridgeUrl,this.iframe.allow="hid 'src'",this.iframe.onload=async()=>{if(this.iframeLoaded=!0,this.delayedPromise)try{const e=await this.updateTransportMethod(this.delayedPromise.transportType);this.delayedPromise.resolve(e)}catch(e){this.delayedPromise.reject(e)}finally{delete this.delayedPromise}},document.head.appendChild(this.iframe)}_getOrigin(){const e=this.bridgeUrl.split("/");return e.splice(-1,1),e.join("/")}_sendMessage(e,t){e.target="LEDGER-IFRAME",this.currentMessageId+=1,e.messageId=this.currentMessageId,this.messageCallbacks[this.currentMessageId]=t,this.iframe.contentWindow.postMessage(e,"*")}_setupListener(){this._eventListener=({origin:e,data:t})=>e===this._getOrigin()&&(t&&(this.messageCallbacks[t.messageId]?this.messageCallbacks[t.messageId](t):"ledger-connection-change"===t.action&&(this.isDeviceConnected=t.payload.connected)),undefined),window.addEventListener("message",this._eventListener)}destroy(){window.removeEventListener("message",this._eventListener)}async __getPage(e){this.page+=e,this.page<=0&&(this.page=1);const t=(this.page-1)*this.perPage,r=t+this.perPage;let n;return await this.unlock(),n=this._isLedgerLiveHdPath()?await this._getAccountsBIP44(t,r):this._getAccountsLegacy(t,r),n}async _getAccountsBIP44(e,t){const r=[];for(let n=e;n<t;n++){const e=this._getPathForIndex(n),t=await this.unlock(e),i=!this.implementFullBIP44||await this._hasPreviousTransactions(t);if(r.push({address:t,balance:null,index:n}),!i)break}return r}_getAccountsLegacy(e,t){const r=[];for(let n=e;n<t;n++){const e=this._addressFromIndex(c,n);r.push({address:e,balance:null,index:n}),this.paths[s.toChecksumAddress(e)]=n}return r}_padLeftEven(e){return e.length%2==0?e:`0${e}`}_normalize(e){return this._padLeftEven(s.bufferToHex(e).toLowerCase())}_addressFromIndex(e,t){const r=this.hdk.derive(`${e}/${t}`),n=s.publicToAddress(r.publicKey,!0).toString("hex");return s.toChecksumAddress(`0x${n}`)}_pathFromAddress(e){const t=s.toChecksumAddress(e);let r=this.paths[t];if(void 0===r)for(let e=0;e<1e3;e++)if(t===this._addressFromIndex(c,e)){r=e;break}if(void 0===r)throw new Error("Unknown address");return this._getPathForIndex(r)}_toAscii(e){let t="",r=0;const n=e.length;for("0x"===e.substring(0,2)&&(r=2);r<n;r+=2){const n=parseInt(e.substr(r,2),16);t+=String.fromCharCode(n)}return t}_getPathForIndex(e){return this._isLedgerLiveHdPath()?`m/44'/60'/${e}'/0/0`:`${this.hdPath}/${e}`}_isLedgerLiveHdPath(){return"m/44'/60'/0'/0/0"===this.hdPath}_toLedgerPath(e){return e.toString().replace("m/","")}async _hasPreviousTransactions(e){const t=this._getApiUrl(),r=await window.fetch(`${t}/api?module=account&action=txlist&address=${e}&tag=latest&page=1&offset=1`),n=await r.json();return"0"!==n.status&&n.result.length>0}_getApiUrl(){return l[this.network]||l.mainnet}}d.type=u,t.exports=d}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring"}],[1517,{buffer:2434,"ethereumjs-abi":2871,"ethereumjs-util":1518,tweetnacl:7128,"tweetnacl-util":7127},function(){with(this)return function(){"use strict";return function(e,t,r){const{Buffer:n}=e("buffer"),i=e("ethereumjs-util"),s=e("ethereumjs-abi"),a=e("tweetnacl");a.util=e("tweetnacl-util");const o={type:"object",properties:{types:{type:"object",additionalProperties:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"}},required:["name","type"]}}},primaryType:{type:"string"},domain:{type:"object"},message:{type:"object"}},required:["types","primaryType","domain","message"]},c={encodeData(e,t,r,a=!0){const o=["bytes32"],c=[this.hashType(e,r)];if(a){const u=(e,t,o)=>{if(r[t]!==undefined)return["bytes32",null===o||o===undefined?"0x0000000000000000000000000000000000000000000000000000000000000000":i.keccak(this.encodeData(t,o,r,a))];if(o===undefined)throw new Error(`missing value for field ${e} of type ${t}`);if("bytes"===t)return["bytes32",i.keccak(o)];if("string"===t)return"string"==typeof o&&(o=n.from(o,"utf8")),["bytes32",i.keccak(o)];if(t.lastIndexOf("]")===t.length-1){const r=t.slice(0,t.lastIndexOf("[")),n=o.map((t=>u(e,r,t)));return["bytes32",i.keccak(s.rawEncode(n.map((([e])=>e)),n.map((([,e])=>e))))]}return[t,o]};for(const n of r[e]){const[e,r]=u(n.name,n.type,t[n.name]);o.push(e),c.push(r)}}else for(const s of r[e]){let e=t[s.name];if(e!==undefined)if("bytes"===s.type)o.push("bytes32"),e=i.keccak(e),c.push(e);else if("string"===s.type)o.push("bytes32"),"string"==typeof e&&(e=n.from(e,"utf8")),e=i.keccak(e),c.push(e);else if(r[s.type]!==undefined)o.push("bytes32"),e=i.keccak(this.encodeData(s.type,e,r,a)),c.push(e);else{if(s.type.lastIndexOf("]")===s.type.length-1)throw new Error("Arrays currently unimplemented in encodeData");o.push(s.type),c.push(e)}}return s.rawEncode(o,c)},encodeType(e,t){let r="",n=this.findTypeDependencies(e,t).filter((t=>t!==e));n=[e].concat(n.sort());for(const e of n){if(!t[e])throw new Error(`No type definition specified: ${e}`);r+=`${e}(${t[e].map((({name:e,type:t})=>`${t} ${e}`)).join(",")})`}return r},findTypeDependencies(e,t,r=[]){const[n]=e.match(/^\w*/u);if(e=n,r.includes(e)||t[e]===undefined)return r;r.push(e);for(const n of t[e])for(const e of this.findTypeDependencies(n.type,t,r))!r.includes(e)&&r.push(e);return r},hashStruct(e,t,r,n=!0){return i.keccak(this.encodeData(e,t,r,n))},hashType(e,t){return i.keccak(this.encodeType(e,t))},sanitizeData(e){const t={};for(const r of Object.keys(o.properties))e[r]&&(t[r]=e[r]);return t.types&&(t.types={EIP712Domain:[],...t.types}),t},sign(e,t=!0){const r=this.sanitizeData(e),s=[n.from("1901","hex")];return s.push(this.hashStruct("EIP712Domain",r.domain,r.types,t)),"EIP712Domain"!==r.primaryType&&s.push(this.hashStruct(r.primaryType,r.message,r.types,t)),i.keccak(n.concat(s))}};function u(e){const t=new Error("Expect argument to be non-empty array");if("object"!=typeof e||!e.length)throw t;const r=e.map((function(e){return"bytes"===e.type?i.toBuffer(e.value):e.value})),n=e.map((function(e){return e.type})),a=e.map((function(e){if(!e.name)throw t;return`${e.type} ${e.name}`}));return s.soliditySHA3(["bytes32","bytes32"],[s.soliditySHA3(new Array(e.length).fill("string"),a),s.soliditySHA3(n,r)])}function l(e,t){const r=i.toBuffer(t),n=i.fromRpcSig(r);return i.ecrecover(e,n.v,n.r,n.s)}function d(e){const t=i.toBuffer(e.data);return l(i.hashPersonalMessage(t),e.sig)}function h(e,t){let r=`${e}`;for(;r.length<t;)r=`0${r}`;return r}function f(e){const t=n.from(e,"hex").toString("base64");return a.util.decodeBase64(t)}t.exports={TYPED_MESSAGE_SCHEMA:o,TypedDataUtils:c,concatSig(e,t,r){const n=i.fromSigned(t),s=i.fromSigned(r),a=i.bufferToInt(e),o=h(i.toUnsigned(n).toString("hex"),64),c=h(i.toUnsigned(s).toString("hex"),64),u=i.stripHexPrefix(i.intToHex(a));return i.addHexPrefix(o.concat(c,u)).toString("hex")},normalize(e){if(!e)return undefined;if("number"==typeof e){const t=i.toBuffer(e);e=i.bufferToHex(t)}if("string"!=typeof e){let t="eth-sig-util.normalize() requires hex string or integer input.";throw t+=` received ${typeof e}: ${e}`,new Error(t)}return i.addHexPrefix(e.toLowerCase())},personalSign(e,t){const r=i.toBuffer(t.data),n=i.hashPersonalMessage(r),s=i.ecsign(n,e);return i.bufferToHex(this.concatSig(s.v,s.r,s.s))},recoverPersonalSignature(e){const t=d(e),r=i.publicToAddress(t);return i.bufferToHex(r)},extractPublicKey:e=>`0x${d(e).toString("hex")}`,typedSignatureHash(e){const t=u(e);return i.bufferToHex(t)},signTypedDataLegacy(e,t){const r=u(t.data),n=i.ecsign(r,e);return i.bufferToHex(this.concatSig(n.v,n.r,n.s))},recoverTypedSignatureLegacy(e){const t=l(u(e.data),e.sig),r=i.publicToAddress(t);return i.bufferToHex(r)},encrypt(e,t,r){if("x25519-xsalsa20-poly1305"===r){if(void 0===t.data)throw new Error('Cannot detect secret message, message params should be of the form {data: "secret message"} ');const r=a.box.keyPair();let n;try{n=a.util.decodeBase64(e)}catch(e){throw new Error("Bad public key")}const i=a.util.decodeUTF8(t.data),s=a.randomBytes(a.box.nonceLength),o=a.box(i,s,n,r.secretKey);return{version:"x25519-xsalsa20-poly1305",nonce:a.util.encodeBase64(s),ephemPublicKey:a.util.encodeBase64(r.publicKey),ciphertext:a.util.encodeBase64(o)}}throw new Error("Encryption type/version not supported")},encryptSafely(e,t,r){const{data:i}=t;if(!i)throw new Error("Cannot encrypt empty msg.data");if("object"==typeof i&&i.toJSON)throw new Error("Cannot encrypt with toJSON property.  Please remove toJSON property");const s={data:i,padding:""},a=n.byteLength(JSON.stringify(s),"utf-8")%2048;let o=0;a>0&&(o=2048-a-16),s.padding="0".repeat(o);const c={data:JSON.stringify(s)};return this.encrypt(e,c,r)},decrypt(e,t){if("x25519-xsalsa20-poly1305"===e.version){const r=f(t),n=a.box.keyPair.fromSecretKey(r).secretKey,i=a.util.decodeBase64(e.nonce),s=a.util.decodeBase64(e.ciphertext),o=a.util.decodeBase64(e.ephemPublicKey),c=a.box.open(s,i,o,n);let u;try{u=a.util.encodeUTF8(c)}catch(e){throw new Error("Decryption failed.")}if(u)return u;throw new Error("Decryption failed.")}throw new Error("Encryption type/version not supported.")},decryptSafely(e,t){return JSON.parse(this.decrypt(e,t)).data},getEncryptionPublicKey(e){const t=f(e),r=a.box.keyPair.fromSecretKey(t).publicKey;return a.util.encodeBase64(r)},signTypedMessage(e,t,r="V4"){switch(r){case"V1":return this.signTypedDataLegacy(e,t);case"V3":return this.signTypedData(e,t);default:return this.signTypedData_v4(e,t)}},recoverTypedMessage(e,t="V4"){switch(t){case"V1":return this.recoverTypedSignatureLegacy(e);case"V3":return this.recoverTypedSignature(e);default:return this.recoverTypedSignature_v4(e)}},signTypedData(e,t){const r=c.sign(t.data,!1),n=i.ecsign(r,e);return i.bufferToHex(this.concatSig(n.v,n.r,n.s))},signTypedData_v4(e,t){const r=c.sign(t.data),n=i.ecsign(r,e);return i.bufferToHex(this.concatSig(n.v,n.r,n.s))},recoverTypedSignature(e){const t=l(c.sign(e.data,!1),e.sig),r=i.publicToAddress(t);return i.bufferToHex(r)},recoverTypedSignature_v4(e){const t=l(c.sign(e.data),e.sig),r=i.publicToAddress(t);return i.bufferToHex(r)}}}}},{package:"@metamask/eth-ledger-bridge-keyring>eth-sig-util"}],[1518,{"./secp256k1-adapter":1519,assert:2019,"bn.js":2390,"create-hash":2549,"ethereum-cryptography/keccak":2836,"ethjs-util":1522,rlp:6868,"safe-buffer":6870},function(){with(this)return function(){"use strict";return function(e,t,r){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("ethereum-cryptography/keccak"),s=i.keccak224,a=i.keccak384,o=i.keccak256,c=i.keccak512,u=e("./secp256k1-adapter"),l=e("assert"),d=e("rlp"),h=e("bn.js"),f=e("create-hash"),p=e("safe-buffer").Buffer;Object.assign(r,e("ethjs-util")),r.MAX_INTEGER=new h("ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",16),r.TWO_POW256=new h("10000000000000000000000000000000000000000000000000000000000000000",16),r.KECCAK256_NULL_S="c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",r.SHA3_NULL_S=r.KECCAK256_NULL_S,r.KECCAK256_NULL=p.from(r.KECCAK256_NULL_S,"hex"),r.SHA3_NULL=r.KECCAK256_NULL,r.KECCAK256_RLP_ARRAY_S="1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",r.SHA3_RLP_ARRAY_S=r.KECCAK256_RLP_ARRAY_S,r.KECCAK256_RLP_ARRAY=p.from(r.KECCAK256_RLP_ARRAY_S,"hex"),r.SHA3_RLP_ARRAY=r.KECCAK256_RLP_ARRAY,r.KECCAK256_RLP_S="56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",r.SHA3_RLP_S=r.KECCAK256_RLP_S,r.KECCAK256_RLP=p.from(r.KECCAK256_RLP_S,"hex"),r.SHA3_RLP=r.KECCAK256_RLP,r.BN=h,r.rlp=d,r.secp256k1=u,r.zeros=function(e){return p.allocUnsafe(e).fill(0)},r.zeroAddress=function(){var e=r.zeros(20);return r.bufferToHex(e)},r.setLengthLeft=r.setLength=function(e,t,n){var i=r.zeros(t);return e=r.toBuffer(e),n?e.length<t?(e.copy(i),i):e.slice(0,t):e.length<t?(e.copy(i,t-e.length),i):e.slice(-t)},r.setLengthRight=function(e,t){return r.setLength(e,t,!0)},r.unpad=r.stripZeros=function(e){for(var t=(e=r.stripHexPrefix(e))[0];e.length>0&&"0"===t.toString();)t=(e=e.slice(1))[0];return e},r.toBuffer=function(e){if(!p.isBuffer(e))if(Array.isArray(e))e=p.from(e);else if("string"==typeof e)e=r.isHexString(e)?p.from(r.padToEven(r.stripHexPrefix(e)),"hex"):p.from(e);else if("number"==typeof e)e=r.intToBuffer(e);else if(null===e||e===undefined)e=p.allocUnsafe(0);else if(h.isBN(e))e=e.toArrayLike(p);else{if(!e.toArray)throw new Error("invalid type");e=p.from(e.toArray())}return e},r.bufferToInt=function(e){return new h(r.toBuffer(e)).toNumber()},r.bufferToHex=function(e){return"0x"+(e=r.toBuffer(e)).toString("hex")},r.fromSigned=function(e){return new h(e).fromTwos(256)},r.toUnsigned=function(e){return p.from(e.toTwos(256).toArray())},r.keccak=function(e,t){switch(e=r.toBuffer(e),t||(t=256),t){case 224:return s(e);case 256:return o(e);case 384:return a(e);case 512:return c(e);default:throw new Error("Invald algorithm: keccak"+t)}},r.keccak256=function(e){return r.keccak(e)},r.sha3=r.keccak,r.sha256=function(e){return e=r.toBuffer(e),f("sha256").update(e).digest()},r.ripemd160=function(e,t){e=r.toBuffer(e);var n=f("rmd160").update(e).digest();return!0===t?r.setLength(n,32):n},r.rlphash=function(e){return r.keccak(d.encode(e))},r.isValidPrivate=function(e){return u.privateKeyVerify(e)},r.isValidPublic=function(e,t){return 64===e.length?u.publicKeyVerify(p.concat([p.from([4]),e])):!!t&&u.publicKeyVerify(e)},r.pubToAddress=r.publicToAddress=function(e,t){return e=r.toBuffer(e),t&&64!==e.length&&(e=u.publicKeyConvert(e,!1).slice(1)),l(64===e.length),r.keccak(e).slice(-20)};var m=r.privateToPublic=function(e){return e=r.toBuffer(e),u.publicKeyCreate(e,!1).slice(1)};r.importPublic=function(e){return 64!==(e=r.toBuffer(e)).length&&(e=u.publicKeyConvert(e,!1).slice(1)),e},r.ecsign=function(e,t){var r=u.sign(e,t),n={};return n.r=r.signature.slice(0,32),n.s=r.signature.slice(32,64),n.v=r.recovery+27,n},r.hashPersonalMessage=function(e){var t=r.toBuffer("Ethereum Signed Message:\n"+e.length.toString());return r.keccak(p.concat([t,e]))},r.ecrecover=function(e,t,n,i){var s=p.concat([r.setLength(n,32),r.setLength(i,32)],64),a=t-27;if(0!==a&&1!==a)throw new Error("Invalid signature v value");var o=u.recover(e,s,a);return u.publicKeyConvert(o,!1).slice(1)},r.toRpcSig=function(e,t,n){if(27!==e&&28!==e)throw new Error("Invalid recovery id");return r.bufferToHex(p.concat([r.setLengthLeft(t,32),r.setLengthLeft(n,32),r.toBuffer(e-27)]))},r.fromRpcSig=function(e){if(65!==(e=r.toBuffer(e)).length)throw new Error("Invalid signature length");var t=e[64];return t<27&&(t+=27),{v:t,r:e.slice(0,32),s:e.slice(32,64)}},r.privateToAddress=function(e){return r.publicToAddress(m(e))},r.isValidAddress=function(e){return/^0x[0-9a-fA-F]{40}$/.test(e)},r.isZeroAddress=function(e){return r.zeroAddress()===r.addHexPrefix(e)},r.toChecksumAddress=function(e){e=r.stripHexPrefix(e).toLowerCase();for(var t=r.keccak(e).toString("hex"),n="0x",i=0;i<e.length;i++)parseInt(t[i],16)>=8?n+=e[i].toUpperCase():n+=e[i];return n},r.isValidChecksumAddress=function(e){return r.isValidAddress(e)&&r.toChecksumAddress(e)===e},r.generateAddress=function(e,t){return e=r.toBuffer(e),t=(t=new h(t)).isZero()?null:p.from(t.toArray()),r.rlphash([e,t]).slice(-20)},r.isPrecompiled=function(e){var t=r.unpad(e);return 1===t.length&&t[0]>=1&&t[0]<=8},r.addHexPrefix=function(e){return"string"!=typeof e||r.isHexPrefixed(e)?e:"0x"+e},r.isValidSignature=function(e,t,r,n){var i=new h("7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0",16),s=new h("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141",16);return 32===t.length&&32===r.length&&((27===e||28===e)&&(t=new h(t),r=new h(r),!(t.isZero()||t.gt(s)||r.isZero()||r.gt(s))&&(!1!==n||1!==new h(r).cmp(i))))},r.baToJSON=function(e){if(p.isBuffer(e))return"0x"+e.toString("hex");if(e instanceof Array){for(var t=[],n=0;n<e.length;n++)t.push(r.baToJSON(e[n]));return t}},r.defineProperties=function(e,t,i){if(e.raw=[],e._fields=[],e.toJSON=function(t){if(t){var n={};return e._fields.forEach((function(t){n[t]="0x"+e[t].toString("hex")})),n}return r.baToJSON(this.raw)},e.serialize=function(){return d.encode(e.raw)},t.forEach((function(t,n){function i(){return e.raw[n]}function s(i){"00"!==(i=r.toBuffer(i)).toString("hex")||t.allowZero||(i=p.allocUnsafe(0)),t.allowLess&&t.length?(i=r.stripZeros(i),l(t.length>=i.length,"The field "+t.name+" must not have more "+t.length+" bytes")):t.allowZero&&0===i.length||!t.length||l(t.length===i.length,"The field "+t.name+" must have byte length of "+t.length),e.raw[n]=i}e._fields.push(t.name),Object.defineProperty(e,t.name,{enumerable:!0,configurable:!0,get:i,set:s}),t.default&&(e[t.name]=t.default),t.alias&&Object.defineProperty(e,t.alias,{enumerable:!1,configurable:!0,set:s,get:i})})),i)if("string"==typeof i&&(i=p.from(r.stripHexPrefix(i),"hex")),p.isBuffer(i)&&(i=d.decode(i)),Array.isArray(i)){if(i.length>e._fields.length)throw new Error("wrong number of fields in data");i.forEach((function(t,n){e[e._fields[n]]=r.toBuffer(t)}))}else{if("object"!==(void 0===i?"undefined":n(i)))throw new Error("invalid data");var s=Object.keys(i);t.forEach((function(t){-1!==s.indexOf(t.name)&&(e[t.name]=i[t.name]),-1!==s.indexOf(t.alias)&&(e[t.alias]=i[t.alias])}))}}}}},{package:"@metamask/eth-ledger-bridge-keyring>eth-sig-util>ethereumjs-util"}],[1519,{"./secp256k1-lib/der":1520,"./secp256k1-lib/index":1521,buffer:2434,"ethereum-cryptography/secp256k1":2868},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("ethereum-cryptography/secp256k1"),i=e("./secp256k1-lib/index"),s=e("./secp256k1-lib/der"),a=function(e){return 32===e.length&&n.privateKeyVerify(Uint8Array.from(e))};t.exports={privateKeyVerify:a,privateKeyExport:function(e,t){if(32!==e.length)throw new RangeError("private key length is invalid");var r=i.privateKeyExport(e,t);return s.privateKeyExport(e,r,t)},privateKeyImport:function(e){if(null!==(e=s.privateKeyImport(e))&&32===e.length&&a(e))return e;throw new Error("couldn't import from DER format")},privateKeyNegate:function(e){return r.from(n.privateKeyNegate(Uint8Array.from(e)))},privateKeyModInverse:function(e){if(32!==e.length)throw new Error("private key length is invalid");return r.from(i.privateKeyModInverse(Uint8Array.from(e)))},privateKeyTweakAdd:function(e,t){return r.from(n.privateKeyTweakAdd(Uint8Array.from(e),t))},privateKeyTweakMul:function(e,t){return r.from(n.privateKeyTweakMul(Uint8Array.from(e),Uint8Array.from(t)))},publicKeyCreate:function(e,t){return r.from(n.publicKeyCreate(Uint8Array.from(e),t))},publicKeyConvert:function(e,t){return r.from(n.publicKeyConvert(Uint8Array.from(e),t))},publicKeyVerify:function(e){return(33===e.length||65===e.length)&&n.publicKeyVerify(Uint8Array.from(e))},publicKeyTweakAdd:function(e,t,i){return r.from(n.publicKeyTweakAdd(Uint8Array.from(e),Uint8Array.from(t),i))},publicKeyTweakMul:function(e,t,i){return r.from(n.publicKeyTweakMul(Uint8Array.from(e),Uint8Array.from(t),i))},publicKeyCombine:function(e,t){var i=[];return e.forEach((function(e){i.push(Uint8Array.from(e))})),r.from(n.publicKeyCombine(i,t))},signatureNormalize:function(e){return r.from(n.signatureNormalize(Uint8Array.from(e)))},signatureExport:function(e){return r.from(n.signatureExport(Uint8Array.from(e)))},signatureImport:function(e){return r.from(n.signatureImport(Uint8Array.from(e)))},signatureImportLax:function(e){if(0===e.length)throw new RangeError("signature length is invalid");var t=s.signatureImportLax(e);if(null===t)throw new Error("couldn't parse DER signature");return i.signatureImport(t)},sign:function(e,t,i){if(null===i)throw new TypeError("options should be an Object");var s=void 0;if(i){if(s={},null===i.data)throw new TypeError("options.data should be a Buffer");if(i.data){if(32!==i.data.length)throw new RangeError("options.data length is invalid");s.data=new Uint8Array(i.data)}if(null===i.noncefn)throw new TypeError("options.noncefn should be a Function");i.noncefn&&(s.noncefn=function(e,t,n,s,a){var o=null!=n?r.from(n):null,c=null!=s?r.from(s):null,u=r.from("");return i.noncefn&&(u=i.noncefn(r.from(e),r.from(t),o,c,a)),Uint8Array.from(u)})}var a=n.ecdsaSign(Uint8Array.from(e),Uint8Array.from(t),s);return{signature:r.from(a.signature),recovery:a.recid}},verify:function(e,t,r){return n.ecdsaVerify(Uint8Array.from(t),Uint8Array.from(e),r)},recover:function(e,t,i,s){return r.from(n.ecdsaRecover(Uint8Array.from(t),i,Uint8Array.from(e),s))},ecdh:function(e,t){return r.from(n.ecdh(Uint8Array.from(e),Uint8Array.from(t),{}))},ecdhUnsafe:function(e,t,n){if(33!==e.length&&65!==e.length)throw new RangeError("public key length is invalid");if(32!==t.length)throw new RangeError("private key length is invalid");return r.from(i.ecdhUnsafe(Uint8Array.from(e),Uint8Array.from(t),n))}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>eth-sig-util>ethereumjs-util"}],[152,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");const s="sentEther";var a={version:64,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=64;const r=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,n.isPlainObject)(r))for(const e of Object.values(r))e.type===s&&(e.type=i.TRANSACTION_TYPES.SIMPLE_SEND),e.history&&e.history.map((e=>(e.type&&e.type===s&&(e.type=i.TRANSACTION_TYPES.SIMPLE_SEND),e)));return e}(t.data);return t.data=r,t}};r.default=a}}},{package:"$root$"}],[1520,{buffer:2434},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){var t=e.from([48,129,211,2,1,1,4,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,160,129,133,48,129,130,2,1,1,48,44,6,7,42,134,72,206,61,1,1,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,252,47,48,6,4,1,0,4,1,7,4,33,2,121,190,102,126,249,220,187,172,85,160,98,149,206,135,11,7,2,155,252,219,45,206,40,217,89,242,129,91,22,248,23,152,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230,175,72,160,59,191,210,94,140,208,54,65,65,2,1,1,161,36,3,34,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),n=e.from([48,130,1,19,2,1,1,4,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,160,129,165,48,129,162,2,1,1,48,44,6,7,42,134,72,206,61,1,1,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,252,47,48,6,4,1,0,4,1,7,4,65,4,121,190,102,126,249,220,187,172,85,160,98,149,206,135,11,7,2,155,252,219,45,206,40,217,89,242,129,91,22,248,23,152,72,58,218,119,38,163,196,101,93,164,251,252,14,17,8,168,253,23,180,72,166,133,84,25,156,71,208,143,251,16,212,184,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230,175,72,160,59,191,210,94,140,208,54,65,65,2,1,1,161,68,3,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);r.privateKeyExport=function(r,i,s){var a=e.from(s?t:n);return r.copy(a,s?8:9),i.copy(a,s?181:214),a},r.privateKeyImport=function(e){var t=e.length,r=0;if(t<r+1||48!==e[r])return null;if(t<(r+=1)+1||!(128&e[r]))return null;var n=127&e[r];if(n<1||n>2)return null;if(t<(r+=1)+n)return null;var i=e[r+n-1]|(n>1?e[r+n-2]<<8:0);return t<(r+=n)+i||t<r+3||2!==e[r]||1!==e[r+1]||1!==e[r+2]||t<(r+=3)+2||4!==e[r]||e[r+1]>32||t<r+2+e[r+1]?null:e.slice(r+2,r+2+e[r+1])},r.signatureImportLax=function(t){var r=e.alloc(32,0),n=e.alloc(32,0),i=t.length,s=0;if(48!==t[s++])return null;var a=t[s++];if(128&a&&(s+=a-128)>i)return null;if(2!==t[s++])return null;var o=t[s++];if(128&o){if(s+(a=o-128)>i)return null;for(;a>0&&0===t[s];s+=1,a-=1);for(o=0;a>0;s+=1,a-=1)o=(o<<8)+t[s]}if(o>i-s)return null;var c=s;if(s+=o,2!==t[s++])return null;var u=t[s++];if(128&u){if(s+(a=u-128)>i)return null;for(;a>0&&0===t[s];s+=1,a-=1);for(u=0;a>0;s+=1,a-=1)u=(u<<8)+t[s]}if(u>i-s)return null;var l=s;for(s+=u;o>0&&0===t[c];o-=1,c+=1);if(o>32)return null;var d=t.slice(c,c+o);for(d.copy(r,32-d.length);u>0&&0===t[l];u-=1,l+=1);if(u>32)return null;var h=t.slice(l,l+u);return h.copy(n,32-h.length),{r:r,s:n}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>eth-sig-util>ethereumjs-util"}],[1521,{"bn.js":2390,buffer:2434,elliptic:2686},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=e("bn.js"),i=new(0,e("elliptic").ec)("secp256k1"),s=i.curve;r.privateKeyExport=function(e,t){var r=new n(e);if(r.ucmp(s.n)>=0)throw new Error("couldn't export to DER format");var o=i.g.mul(r);return a(o.getX(),o.getY(),t)},r.privateKeyModInverse=function(e){var r=new n(e);if(r.ucmp(s.n)>=0||r.isZero())throw new Error("private key range is invalid");return r.invm(s.n).toArrayLike(t,"be",32)},r.signatureImport=function(e){var r=new n(e.r);r.ucmp(s.n)>=0&&(r=new n(0));var i=new n(e.s);return i.ucmp(s.n)>=0&&(i=new n(0)),t.concat([r.toArrayLike(t,"be",32),i.toArrayLike(t,"be",32)])},r.ecdhUnsafe=function(e,t,r){var o=i.keyFromPublic(e),c=new n(t);if(c.ucmp(s.n)>=0||c.isZero())throw new Error("scalar was invalid (zero or overflow)");var u=o.pub.mul(c);return a(u.getX(),u.getY(),r)};var a=function(e,r,n){var i=void 0;return n?((i=t.alloc(33))[0]=r.isOdd()?3:2,e.toArrayLike(t,"be",32).copy(i,1)):((i=t.alloc(65))[0]=4,e.toArrayLike(t,"be",32).copy(i,1),r.toArrayLike(t,"be",32).copy(i,33)),i}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>eth-sig-util>ethereumjs-util"}],[1522,{buffer:2434,"is-hex-prefixed":5132,"strip-hex-prefix":7040},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("is-hex-prefixed"),i=e("strip-hex-prefix");function s(e){var t=e;if("string"!=typeof t)throw new Error("[ethjs-util] while padding to even, value must be string, is currently "+typeof t+", while padToEven.");return t.length%2&&(t="0"+t),t}function a(e){return"0x"+e.toString(16)}t.exports={arrayContainsArray:function(e,t,r){if(!0!==Array.isArray(e))throw new Error("[ethjs-util] method arrayContainsArray requires input 'superset' to be an array got type '"+typeof e+"'");if(!0!==Array.isArray(t))throw new Error("[ethjs-util] method arrayContainsArray requires input 'subset' to be an array got type '"+typeof t+"'");return t[Boolean(r)?"some":"every"]((function(t){return e.indexOf(t)>=0}))},intToBuffer:function(e){var t=a(e);return new r(s(t.slice(2)),"hex")},getBinarySize:function(e){if("string"!=typeof e)throw new Error("[ethjs-util] while getting binary size, method getBinarySize requires input 'str' to be type String, got '"+typeof e+"'.");return r.byteLength(e,"utf8")},isHexPrefixed:n,stripHexPrefix:i,padToEven:s,intToHex:a,fromAscii:function(e){for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r).toString(16);t+=n.length<2?"0"+n:n}return"0x"+t},fromUtf8:function(e){return"0x"+s(new r(e,"utf8").toString("hex")).replace(/^0+|0+$/g,"")},toAscii:function(e){var t="",r=0,n=e.length;for("0x"===e.substring(0,2)&&(r=2);r<n;r+=2){var i=parseInt(e.substr(r,2),16);t+=String.fromCharCode(i)}return t},toUtf8:function(e){return new r(s(i(e).replace(/^0+|0+$/g,"")),"hex").toString("utf8")},getKeys:function(e,t,r){if(!Array.isArray(e))throw new Error("[ethjs-util] method getKeys expecting type Array as 'params' input, got '"+typeof e+"'");if("string"!=typeof t)throw new Error("[ethjs-util] method getKeys expecting type String for input 'key' got '"+typeof t+"'.");for(var n=[],i=0;i<e.length;i++){var s=e[i][t];if(r&&!s)s="";else if("string"!=typeof s)throw new Error("invalid abi");n.push(s)}return n},isHexString:function(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>eth-sig-util>ethereumjs-util>ethjs-util"}],[1523,{assert:2019,coinstring:2487,crypto:2556,"safe-buffer":6870,secp256k1:6881},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("assert"),i=e("safe-buffer").Buffer,s=e("crypto"),a=e("coinstring"),o=e("secp256k1"),c=i.from("Bitcoin seed","utf8"),u=2147483648,l={private:76066276,public:76067358};function d(e){this.versions=e||l,this.depth=0,this.index=0,this._privateKey=null,this._publicKey=null,this.chainCode=null,this._fingerprint=0,this.parentFingerprint=0}function h(e,t,r){var n=i.allocUnsafe(78);n.writeUInt32BE(t,0),n.writeUInt8(e.depth,4);var s=e.depth?e.parentFingerprint:0;return n.writeUInt32BE(s,5),n.writeUInt32BE(e.index,9),e.chainCode.copy(n,13),r.copy(n,45),n}function f(e){var t=s.createHash("sha256").update(e).digest();return s.createHash("rmd160").update(t).digest()}Object.defineProperty(d.prototype,"fingerprint",{get:function(){return this._fingerprint}}),Object.defineProperty(d.prototype,"identifier",{get:function(){return this._identifier}}),Object.defineProperty(d.prototype,"pubKeyHash",{get:function(){return this.identifier}}),Object.defineProperty(d.prototype,"privateKey",{get:function(){return this._privateKey},set:function(e){n.equal(e.length,32,"Private key must be 32 bytes."),n(!0===o.privateKeyVerify(e),"Invalid private key"),this._privateKey=e,this._publicKey=o.publicKeyCreate(e,!0),this._identifier=f(this.publicKey),this._fingerprint=this._identifier.slice(0,4).readUInt32BE(0)}}),Object.defineProperty(d.prototype,"publicKey",{get:function(){return this._publicKey},set:function(e){n(33===e.length||65===e.length,"Public key must be 33 or 65 bytes."),n(!0===o.publicKeyVerify(e),"Invalid public key"),this._publicKey=o.publicKeyConvert(e,!0),this._identifier=f(this.publicKey),this._fingerprint=this._identifier.slice(0,4).readUInt32BE(0),this._privateKey=null}}),Object.defineProperty(d.prototype,"privateExtendedKey",{get:function(){return this._privateKey?a.encode(h(this,this.versions.private,i.concat([i.alloc(1,0),this.privateKey]))):null}}),Object.defineProperty(d.prototype,"publicExtendedKey",{get:function(){return a.encode(h(this,this.versions.public,this.publicKey))}}),d.prototype.derive=function(e){if("m"===e||"M"===e||"m'"===e||"M'"===e)return this;var t=e.split("/"),r=this;return t.forEach((function(e,t){if(0!==t){var i=e.length>1&&"'"===e[e.length-1],s=parseInt(e,10);n(s<u,"Invalid index"),i&&(s+=u),r=r.deriveChild(s)}else n(e,"m","Invalid path")})),r},d.prototype.deriveChild=function(e){var t,r=e>=u,a=i.allocUnsafe(4);if(a.writeUInt32BE(e,0),r){n(this.privateKey,"Could not derive hardened child key");var c=this.privateKey,l=i.alloc(1,0);c=i.concat([l,c]),t=i.concat([c,a])}else t=i.concat([this.publicKey,a]);var h=s.createHmac("sha512",this.chainCode).update(t).digest(),f=h.slice(0,32),p=h.slice(32),m=new d(this.versions);if(this.privateKey)try{m.privateKey=o.privateKeyTweakAdd(this.privateKey,f)}catch(t){return this.derive(e+1)}else try{m.publicKey=o.publicKeyTweakAdd(this.publicKey,f,!0)}catch(t){return this.derive(e+1,r)}return m.chainCode=p,m.depth=this.depth+1,m.parentFingerprint=this.fingerprint,m.index=e,m},d.prototype.sign=function(e){return o.sign(e,this.privateKey).signature},d.prototype.verify=function(e,t){return o.verify(e,t,this.publicKey)},d.prototype.toJSON=function(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}},d.fromMasterSeed=function(e,t){var r=s.createHmac("sha512",c).update(e).digest(),n=r.slice(0,32),i=r.slice(32),a=new d(t);return a.chainCode=i,a.privateKey=n,a},d.fromExtendedKey=function(e,t){var r=new d(t=t||l),i=a.decode(e),s=i.readUInt32BE(0);n(s===t.private||s===t.public,"Version mismatch: does not match private or public"),r.depth=i.readUInt8(4),r.parentFingerprint=i.readUInt32BE(5),r.index=i.readUInt32BE(9),r.chainCode=i.slice(13,45);var o=i.slice(45);return 0===o.readUInt8(0)?(n(s===t.private,"Version mismatch: version does not match private"),r.privateKey=o.slice(1)):(n(s===t.public,"Version mismatch: version does not match public"),r.publicKey=o),r},d.fromJSON=function(e){return d.fromExtendedKey(e.xpriv)},d.HARDENED_OFFSET=u,t.exports=d}}},{package:"@metamask/eth-ledger-bridge-keyring>hdkey"}],[153,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:65,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=65;const r=function(e){if(e.PreferencesController){var t;const{completedOnboarding:r,firstTimeFlowType:n}=e.PreferencesController;e.OnboardingController=null!==(t=e.OnboardingController)&&void 0!==t?t:{},r!==undefined&&(e.OnboardingController.completedOnboarding=r,delete e.PreferencesController.completedOnboarding),n!==undefined&&(e.OnboardingController.firstTimeFlowType=n,delete e.PreferencesController.firstTimeFlowType)}return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[154,{"../../../shared/constants/hardware-wallets":7319,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/hardware-wallets");var s={version:66,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=66;const r=function(e){var t;const r=window.navigator.hid?i.LEDGER_TRANSPORT_TYPES.WEBHID:i.LEDGER_TRANSPORT_TYPES.U2F,n=Boolean(null===(t=e.PreferencesController)||void 0===t?void 0:t.useLedgerLive),s={...e,PreferencesController:{...null==e?void 0:e.PreferencesController,ledgerTransportType:n?i.LEDGER_TRANSPORT_TYPES.LIVE:r}};return delete s.PreferencesController.useLedgerLive,s}(t.data);return t.data=r,t}};r.default=s}}},{package:"$root$"}],[155,{"../../../shared/constants/network":7322,"bignumber.js":2283,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=e("lodash"),s=(n=e("bignumber.js"))&&n.__esModule?n:{default:n},a=e("../../../shared/constants/network");const o=e=>new s.default(e||"0x0",16).gt(0);var c={version:67,async migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=67;const r=function(e){var t,r,n;const i=(null==e?void 0:e.PreferencesController)||{},s=i.preferences||{};if(s.showTestNetworks)return e;const c=(null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions)||{},u=(null===(r=e.NetworkController)||void 0===r?void 0:r.provider)||{},l=(null===(n=e.CachedBalancesController)||void 0===n?void 0:n.cachedBalances)||{},d=a.TEST_CHAINS.includes(null==u?void 0:u.chainId),h=Object.values(c).some((({chainId:e})=>a.TEST_CHAINS.includes(e))),f=a.TEST_CHAINS.some((e=>Object.values(l[e]||{}).some(o))),p=d||h||f;return{...e,PreferencesController:{...i,preferences:{...s,showTestNetworks:p}}}}(t.data);return t.data=r,t}};r.default=c}}},{package:"$root$"}],[156,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:68,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=68;const r=function(e){const{PermissionsController:t={},PermissionsMetadata:r={},...n}=e,{domainMetadata:i={},permissionsHistory:o={},permissionsLog:c=[]}=r;return{...n,PermissionController:s(t),PermissionLogController:{permissionActivityLog:c,permissionHistory:o},SubjectMetadataController:a(i)}}(t.data);return t.data=r,t}};function s(e){const{domains:t={}}=e;return{subjects:Object.entries(t).reduce(((e,[t,r])=>{const{permissions:[n]}=r,i=n.caveats.find((e=>"exposedAccounts"===e.name)),s={...n,caveats:[{type:"restrictReturnedAccounts",value:i.value}]};return delete s["@context"],e[t]={origin:t,permissions:{eth_accounts:s}},e}),{})}}function a(e){return{subjectMetadata:Object.entries(e).reduce(((e,[t,r])=>{const{name:n=null,icon:i=null,extensionId:s=null,...a}=r;return delete a.lastUpdated,delete a.host,t&&(e[t]={name:n,iconUrl:i,extensionId:s,...a,origin:t}),e}),{})}}r.default=i}}},{package:"$root$"}],[1569,{"./BIP44Node":1570,"./SLIP10Node":1571,"./constants":1572,"./utils":1583},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i=this&&this.__classPrivateFieldSet||function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},s=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(r,"__esModule",{value:!0}),r.getBIP44AddressKeyDeriver=r.deriveBIP44AddressKey=r.BIP44CoinTypeNode=r.BIP_44_COIN_TYPE_DEPTH=void 0;const a=e("./constants"),o=e("./BIP44Node"),c=e("./utils"),u=e("./SLIP10Node");r.BIP_44_COIN_TYPE_DEPTH=2;class l{constructor(e,t){n.set(this,void 0),i(this,n,e,"f"),this.coin_type=t,this.path=c.getBIP44CoinTypePathString(t),Object.freeze(this)}static async fromJSON(e,t){h(t),d(e.depth);const r=await o.BIP44Node.fromExtendedKey({depth:e.depth,index:e.index,parentFingerprint:e.parentFingerprint,chainCode:c.hexStringToBuffer(e.chainCode),privateKey:c.nullableHexStringToBuffer(e.privateKey),publicKey:c.hexStringToBuffer(e.publicKey)});return new l(r,t)}static async fromDerivationPath(e){d(e.length-1);const t=await o.BIP44Node.fromDerivationPath({derivationPath:e}),n=Number.parseInt(e[r.BIP_44_COIN_TYPE_DEPTH].split(":")[1].replace("'",""),10);return new l(t,n)}static async fromNode(e,t){if(!(e instanceof o.BIP44Node))throw new Error("Invalid node: Expected an instance of BIP44Node.");return h(t),d(e.depth),new l(e,t)}get depth(){return s(this,n,"f").depth}get privateKeyBuffer(){return s(this,n,"f").privateKeyBuffer}get publicKeyBuffer(){return s(this,n,"f").publicKeyBuffer}get chainCodeBuffer(){return s(this,n,"f").chainCodeBuffer}get privateKey(){return s(this,n,"f").privateKey}get publicKey(){return s(this,n,"f").publicKey}get compressedPublicKeyBuffer(){return s(this,n,"f").compressedPublicKeyBuffer}get chainCode(){return s(this,n,"f").chainCode}get address(){return s(this,n,"f").address}get parentFingerprint(){return s(this,n,"f").parentFingerprint}get fingerprint(){return s(this,n,"f").fingerprint}get index(){return s(this,n,"f").index}get curve(){return s(this,n,"f").curve}get extendedKey(){return s(this,n,"f").extendedKey}async deriveBIP44AddressKey({account:e=0,change:t=0,address_index:r}){return await s(this,n,"f").derive(c.getBIP44CoinTypeToAddressPathTuple({account:e,change:t,address_index:r}))}toJSON(){return Object.assign(Object.assign({},s(this,n,"f").toJSON()),{coin_type:this.coin_type,path:this.path})}}function d(e){if(e!==r.BIP_44_COIN_TYPE_DEPTH)throw new Error(`Invalid depth: Coin type nodes must be of depth ${r.BIP_44_COIN_TYPE_DEPTH}. Received: "${e}"`)}function h(e){if("number"!=typeof e||!Number.isInteger(e)||e<0)throw new Error("Invalid coin type: The specified coin type must be a non-negative integer number.")}async function f(e){if(e instanceof l)return d(e.depth),e;if("string"==typeof e){const t=await o.BIP44Node.fromExtendedKey(e),r=await l.fromNode(t,t.index-a.BIP_32_HARDENED_OFFSET);return d(r.depth),r}return l.fromJSON(e,e.coin_type)}r.BIP44CoinTypeNode=l,n=new WeakMap,r.deriveBIP44AddressKey=async function(e,{account:t=0,change:r=0,address_index:n}){const i=c.getBIP44CoinTypeToAddressPathTuple({account:t,change:r,address_index:n}),s=await f(e),a=await u.deriveChildNode({path:i,node:s});return new o.BIP44Node(a)},r.getBIP44AddressKeyDeriver=async function(e,t){const{account:r=0,change:n=0}=t||{},i=await f(e),s=c.getHardenedBIP32NodeToken(r),a=c.getBIP32NodeToken(n),l=async(e,t=!1)=>{const r=await u.deriveChildNode({path:[s,a,t?c.getHardenedBIP32NodeToken(e):c.getUnhardenedBIP32NodeToken(e)],node:i});return new o.BIP44Node(r)};return l.coin_type=i.coin_type,l.path=c.getBIP44ChangePathString(i.path,{account:r,change:n}),Object.freeze(l),l}}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[157,{"../../../shared/constants/app":7316,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/app");var s={version:69,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=69;const r=function(e){var t;if("object"==typeof(null==e||null===(t=e.SubjectMetadataController)||void 0===t?void 0:t.subjectMetadata)){const{SubjectMetadataController:{subjectMetadata:t}}=e;Object.values(t).forEach((e=>{e&&"object"==typeof e&&!Array.isArray(e)&&(e.subjectType=e.extensionId?i.SUBJECT_TYPES.EXTENSION:i.SUBJECT_TYPES.WEBSITE)}))}return e}(t.data);return t.data=r,t}};r.default=s}}},{package:"$root$"}],[1570,{"./SLIP10Node":1571,"./constants":1572,"./extended-keys":1581,"./utils":1583},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i=this&&this.__classPrivateFieldSet||function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},s=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(r,"__esModule",{value:!0}),r.validateBIP44Depth=r.BIP44Node=void 0;const a=e("./constants"),o=e("./utils"),c=e("./SLIP10Node"),u=e("./extended-keys");class l{constructor(e){n.set(this,void 0),i(this,n,e,"f"),Object.freeze(this)}static async fromJSON(e){return l.fromExtendedKey(e)}static async fromExtendedKey(e){if("string"==typeof e){const t=u.decodeExtendedKey(e),{chainCode:r,depth:n,parentFingerprint:i,index:s}=t;if(t.version===u.PRIVATE_KEY_VERSION){const{privateKey:e}=t;return l.fromExtendedKey({depth:n,parentFingerprint:i,index:s,privateKey:e,chainCode:r})}const{publicKey:a}=t;return l.fromExtendedKey({depth:n,parentFingerprint:i,index:s,publicKey:a,chainCode:r})}const{privateKey:t,publicKey:r,chainCode:n,depth:i,parentFingerprint:s,index:a}=e;d(i);const o=await c.SLIP10Node.fromExtendedKey({privateKey:t,publicKey:r,chainCode:n,depth:i,parentFingerprint:s,index:a,curve:"secp256k1"});return new l(o)}static async fromDerivationPath({derivationPath:e}){d(e.length-1),h(e,a.MIN_BIP_44_DEPTH);const t=await c.SLIP10Node.fromDerivationPath({derivationPath:e,curve:"secp256k1"});return new l(t)}get depth(){return s(this,n,"f").depth}get privateKeyBuffer(){return s(this,n,"f").privateKeyBuffer}get publicKeyBuffer(){return s(this,n,"f").publicKeyBuffer}get chainCodeBuffer(){return s(this,n,"f").chainCodeBuffer}get privateKey(){return s(this,n,"f").privateKey}get publicKey(){return s(this,n,"f").publicKey}get compressedPublicKeyBuffer(){return s(this,n,"f").compressedPublicKeyBuffer}get chainCode(){return s(this,n,"f").chainCode}get address(){return s(this,n,"f").address}get parentFingerprint(){return s(this,n,"f").parentFingerprint}get fingerprint(){return s(this,n,"f").fingerprint}get index(){return s(this,n,"f").index}get extendedKey(){const e={depth:this.depth,parentFingerprint:this.parentFingerprint,index:this.index,chainCode:this.chainCodeBuffer};return this.privateKeyBuffer?u.encodeExtendedKey(Object.assign(Object.assign({},e),{version:u.PRIVATE_KEY_VERSION,privateKey:this.privateKeyBuffer})):u.encodeExtendedKey(Object.assign(Object.assign({},e),{version:u.PUBLIC_KEY_VERSION,publicKey:this.publicKeyBuffer}))}get curve(){return s(this,n,"f").curve}neuter(){const e=s(this,n,"f").neuter();return new l(e)}async derive(e){if(this.depth===a.MAX_BIP_44_DEPTH)throw new Error("Illegal operation: This HD tree node is already a leaf node.");d(this.depth+e.length),h(e,this.depth+1);const t=await s(this,n,"f").derive(e);return new l(t)}toJSON(){return{depth:this.depth,parentFingerprint:this.parentFingerprint,index:this.index,privateKey:this.privateKey,publicKey:this.publicKey,chainCode:this.chainCode}}}function d(e){if(c.validateBIP32Depth(e),e<a.MIN_BIP_44_DEPTH||e>a.MAX_BIP_44_DEPTH)throw new Error(`Invalid HD tree path depth: The depth must be a positive integer N such that 0 <= N <= 5. Received: "${e}"`)}function h(e,t){e.forEach(((e,r)=>{switch(t+r){case a.MIN_BIP_44_DEPTH:if(!a.BIP_39_PATH_REGEX.test(e))throw new Error('Invalid derivation path: The "m" / seed node (depth 0) must be a BIP-39 node.');break;case 1:if(e!==a.BIP44PurposeNodeToken)throw new Error(`Invalid derivation path: The "purpose" node (depth 1) must be the string "${a.BIP44PurposeNodeToken}".`);break;case 2:if(!a.BIP_32_PATH_REGEX.test(e)||!o.isHardened(e))throw new Error('Invalid derivation path: The "coin_type" node (depth 2) must be a hardened BIP-32 node.');break;case 3:if(!a.BIP_32_PATH_REGEX.test(e)||!o.isHardened(e))throw new Error('Invalid derivation path: The "account" node (depth 3) must be a hardened BIP-32 node.');break;case 4:if(!a.BIP_32_PATH_REGEX.test(e))throw new Error('Invalid derivation path: The "change" node (depth 4) must be a BIP-32 node.');break;case a.MAX_BIP_44_DEPTH:if(!a.BIP_32_PATH_REGEX.test(e))throw new Error('Invalid derivation path: The "address_index" node (depth 5) must be a BIP-32 node.');break;default:throw new Error("Invalid derivation path: The path exceeds the maximum BIP-44 depth.")}}))}r.BIP44Node=l,n=new WeakMap,r.validateBIP44Depth=d}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1571,{"./constants":1572,"./curves":1575,"./derivation":1577,"./derivers/bip32":1578,"./utils":1583},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.deriveChildNode=r.validateParentFingerprint=r.validateBIP32Depth=r.SLIP10Node=void 0;const n=e("./constants"),i=e("./curves"),s=e("./derivation"),a=e("./derivers/bip32"),o=e("./utils");class c{constructor({depth:e,parentFingerprint:t,index:r,chainCode:n,privateKey:i,publicKey:s,curve:a}){this.depth=e,this.parentFingerprint=t,this.index=r,this.chainCodeBuffer=n,this.privateKeyBuffer=i,this.publicKeyBuffer=s,this.curve=a,Object.freeze(this)}static async fromJSON(e){return c.fromExtendedKey(e)}static async fromExtendedKey({depth:e,parentFingerprint:t,index:r,privateKey:s,publicKey:a,chainCode:h,curve:f}){const p=o.getBuffer(h,n.BUFFER_KEY_LENGTH);if(u(f),l(e),o.validateBIP32Index(r),d(t),s){const a=o.getBuffer(s,n.BUFFER_KEY_LENGTH);return new c({depth:e,parentFingerprint:t,index:r,chainCode:p,privateKey:a,publicKey:await i.getCurveByName(f).getPublicKey(s),curve:f})}if(a){const n=o.getBuffer(a,i.getCurveByName(f).publicKeyLength);return new c({depth:e,parentFingerprint:t,index:r,chainCode:p,publicKey:n,curve:f})}throw new Error("Invalid options: Must provide either a private key or a public key.")}static async fromDerivationPath({derivationPath:e,curve:t}){if(u(t),!e)throw new Error("Invalid options: Must provide a derivation path.");if(0===e.length)throw new Error("Invalid derivation path: May not specify an empty derivation path.");return await s.deriveKeyFromPath({path:e,depth:e.length-1,curve:t})}get chainCode(){return this.chainCodeBuffer.toString("hex")}get privateKey(){var e;return null===(e=this.privateKeyBuffer)||void 0===e?void 0:e.toString("hex")}get publicKey(){return this.publicKeyBuffer.toString("hex")}get compressedPublicKeyBuffer(){return i.getCurveByName(this.curve).compressPublicKey(this.publicKeyBuffer)}get address(){if("secp256k1"!==this.curve)throw new Error("Unable to get address for this node: Only secp256k1 is supported.");return`0x${a.publicKeyToEthAddress(this.publicKeyBuffer).toString("hex")}`}get fingerprint(){return o.getFingerprint(this.compressedPublicKeyBuffer)}neuter(){return new c({depth:this.depth,parentFingerprint:this.parentFingerprint,index:this.index,chainCode:this.chainCodeBuffer,publicKey:this.publicKeyBuffer,curve:this.curve})}async derive(e){return await h({path:e,node:this})}toJSON(){return{depth:this.depth,parentFingerprint:this.parentFingerprint,index:this.index,curve:this.curve,privateKey:this.privateKey,publicKey:this.publicKey,chainCode:this.chainCode}}}function u(e){if(!e||"string"!=typeof e)throw new Error("Invalid curve: Must specify a curve.");if(!Object.keys(i.curves).includes(e))throw new Error(`Invalid curve: Only the following curves are supported: ${Object.keys(i.curves).join(", ")}.`)}function l(e){if(!o.isValidInteger(e))throw new Error(`Invalid HD tree path depth: The depth must be a positive integer. Received: "${e}".`)}function d(e){if(!o.isValidInteger(e))throw new Error(`Invalid parent fingerprint: The fingerprint must be a positive integer. Received: "${e}".`)}async function h({path:e,node:t}){if(0===e.length)throw new Error("Invalid HD tree derivation path: Deriving a path of length 0 is not defined.");const r=t.depth+e.length;return l(r),await s.deriveKeyFromPath({path:e,node:t,depth:r})}r.SLIP10Node=c,r.validateBIP32Depth=l,r.validateParentFingerprint=d,r.deriveChildNode=h}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1572,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.BIP_32_HARDENED_OFFSET=r.BIP_39_PATH_REGEX=r.BIP_32_PATH_REGEX=r.BIP44PurposeNodeToken=r.MAX_BIP_44_DEPTH=r.MIN_BIP_44_DEPTH=r.HEXADECIMAL_KEY_LENGTH=r.BUFFER_KEY_LENGTH=r.BUFFER_EXTENDED_KEY_LENGTH=void 0,r.BUFFER_EXTENDED_KEY_LENGTH=64,r.BUFFER_KEY_LENGTH=32,r.HEXADECIMAL_KEY_LENGTH=64,r.MIN_BIP_44_DEPTH=0,r.MAX_BIP_44_DEPTH=5,r.BIP44PurposeNodeToken="bip32:44'",r.BIP_32_PATH_REGEX=/^bip32:\d+'?$/u,r.BIP_39_PATH_REGEX=/^bip39:([a-z]+){1}( [a-z]+){11,23}$/u,r.BIP_32_HARDENED_OFFSET=2147483648}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1573,{"./ed25519":1574,"./secp256k1":1576,"@noble/secp256k1":1749},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.mod=r.getCurveByName=r.curves=void 0;const a=e("@noble/secp256k1"),o=s(e("./secp256k1")),c=s(e("./ed25519"));r.curves={secp256k1:o,ed25519:c},r.getCurveByName=function(e){return r.curves[e]},r.mod=a.utils.mod}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1574,{"@noble/ed25519":1748,buffer:2434},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.decompressPublicKey=r.compressPublicKey=r.publicAdd=r.getPublicKey=r.publicKeyLength=r.deriveUnhardenedKeys=r.isValidPrivateKey=r.secret=r.name=r.curve=void 0;const n=e("@noble/ed25519");var i=e("@noble/ed25519");Object.defineProperty(r,"curve",{enumerable:!0,get:function(){return i.CURVE}}),r.name="ed25519",r.secret=t.from("ed25519 seed","utf8");r.isValidPrivateKey=e=>!0,r.deriveUnhardenedKeys=!1,r.publicKeyLength=33;r.getPublicKey=async(e,r)=>{const i=await n.getPublicKey(e);return t.concat([t.alloc(1,0),i])};r.publicAdd=(e,t)=>{throw new Error("Ed25519 does not support public key derivation.")};r.compressPublicKey=e=>e;r.decompressPublicKey=e=>e}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1575,{"./curve":1573,"./ed25519":1574,"./secp256k1":1576},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.ed25519=r.secp256k1=void 0,s(e("./curve"),r),r.secp256k1=a(e("./secp256k1")),r.ed25519=a(e("./ed25519"))}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1576,{"@noble/secp256k1":1749,buffer:2434},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.decompressPublicKey=r.compressPublicKey=r.publicAdd=r.getPublicKey=r.publicKeyLength=r.deriveUnhardenedKeys=r.secret=r.name=r.isValidPrivateKey=r.curve=void 0;const n=e("@noble/secp256k1");var i=e("@noble/secp256k1");Object.defineProperty(r,"curve",{enumerable:!0,get:function(){return i.CURVE}}),r.isValidPrivateKey=n.utils.isValidPrivateKey,r.name="secp256k1",r.secret=t.from("Bitcoin seed","utf8"),r.deriveUnhardenedKeys=!0,r.publicKeyLength=65;r.getPublicKey=(e,r)=>t.from(n.getPublicKey(e,r));r.publicAdd=(e,r)=>{const i=n.Point.fromHex(e).add(n.Point.fromPrivateKey(r));return i.assertValidity(),t.from(i.toRawBytes(!1))};r.compressPublicKey=e=>{const r=n.Point.fromHex(e);return t.from(r.toRawBytes(!0))};r.decompressPublicKey=e=>{const r=n.Point.fromHex(e);return t.from(r.toRawBytes(!1))}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1577,{"./BIP44CoinTypeNode":1569,"./BIP44Node":1570,"./SLIP10Node":1571,"./constants":1572,"./curves":1575,"./derivers":1580},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.validatePathSegment=r.deriveKeyFromPath=void 0;const n=e("./constants"),i=e("./derivers"),s=e("./SLIP10Node"),a=e("./BIP44Node"),o=e("./BIP44CoinTypeNode"),c=e("./curves");function u(e,t,r){if(0===e.length)throw new Error("Invalid HD path segment: The segment must not be empty.");if(e.length-1>n.MAX_BIP_44_DEPTH)throw new Error("Invalid HD path segment: The segment cannot exceed a 0-indexed depth of 5.");let i=!1;if(e.forEach(((e,t)=>{if(0===t){if(i=n.BIP_39_PATH_REGEX.test(e),!i&&!n.BIP_32_PATH_REGEX.test(e))throw l()}else if(!n.BIP_32_PATH_REGEX.test(e))throw l()})),r===n.MIN_BIP_44_DEPTH&&(!i||1!==e.length))throw new Error(`Invalid HD path segment: The segment must consist of a single BIP-39 node for depths of ${n.MIN_BIP_44_DEPTH}. Received: "${e}".`);if(!t&&!i)throw new Error("Invalid derivation parameters: Must specify parent key if the first node of the path segment is not a BIP-39 node.");if(t&&i)throw new Error("Invalid derivation parameters: May not specify parent key if the path segment starts with a BIP-39 node.")}function l(){throw new Error("Invalid HD path segment: The path segment is malformed.")}r.deriveKeyFromPath=async function(e){const{path:t,depth:r=t.length}=e,n="node"in e?e.node:undefined,l="curve"in e?e.curve:null==n?void 0:n.curve;if(n&&!(n instanceof s.SLIP10Node)&&!(n instanceof a.BIP44Node)&&!(n instanceof o.BIP44CoinTypeNode))throw new Error("Invalid arguments: Node must be a SLIP-10 node or a BIP-44 node when provided.");if(!l)throw new Error("Invalid arguments: Must specify either a parent node or curve.");return u(t,Boolean(null==n?void 0:n.privateKey)||Boolean(null==n?void 0:n.publicKey),r),await t.reduce((async(e,t)=>{const r=await e,[n,s]=t.split(":");if(!function(e){return e in i.derivers}(n))throw new Error(`Unknown derivation type: "${n}"`);const a=i.derivers[n];return await a.deriveChildKey({path:s,node:r,curve:c.getCurveByName(l)})}),Promise.resolve(n))},r.validatePathSegment=u}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1578,{"../SLIP10Node":1571,"../constants":1572,"../curves":1575,"../utils":1583,"@noble/hashes/hmac":1587,"@noble/hashes/sha3":1590,"@noble/hashes/sha512":1591,buffer:2434},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.privateAdd=r.deriveChildKey=r.publicKeyToEthAddress=r.privateKeyToEthAddress=void 0;const n=e("@noble/hashes/sha3"),i=e("@noble/hashes/hmac"),s=e("@noble/hashes/sha512"),a=e("../constants"),o=e("../utils"),c=e("../curves"),u=e("../SLIP10Node");function l(e){if(!t.isBuffer(e)||!o.isValidBufferKey(e,c.secp256k1.publicKeyLength))throw new Error("Invalid key: The key must be a 65-byte, non-zero Buffer.");return t.from(n.keccak_256(e.slice(1)).slice(-20))}function d(e,t,r){const n=o.bytesToNumber(e),i=o.bytesToNumber(t);if(i>=r.curve.n)throw new Error("Invalid tweak: Tweak is larger than the curve order.");const s=c.mod(n+i,r.curve.n);if(!r.isValidPrivateKey(s))throw new Error("Invalid private key or tweak: The resulting private key is invalid.");return o.hexStringToBuffer(s.toString(16).padStart(64,"0"))}r.privateKeyToEthAddress=function(e){if(!t.isBuffer(e)||!o.isValidBufferKey(e,a.BUFFER_KEY_LENGTH))throw new Error("Invalid key: The key must be a 32-byte, non-zero Buffer.");return l(c.secp256k1.getPublicKey(e,!1))},r.publicKeyToEthAddress=l,r.deriveChildKey=async function({path:e,node:r,curve:n=c.secp256k1}){const o=e.includes("'");if(!o&&!n.deriveUnhardenedKeys)throw new Error(`Invalid path: Cannot derive unhardened child keys with ${n.name}.`);if(!r)throw new Error("Invalid parameters: Must specify a node to derive from.");if(o&&!r.privateKey)throw new Error("Invalid parameters: Cannot derive hardened child keys without a private key.");const l=e.split("'")[0],h=parseInt(l,10);if(!/^\d+$/u.test(l)||!Number.isInteger(h)||h<0||h>=a.BIP_32_HARDENED_OFFSET)throw new Error(`Invalid BIP-32 index: The index must be a non-negative decimal integer less than ${a.BIP_32_HARDENED_OFFSET}.`);if(r.privateKeyBuffer){const e=await async function({privateKey:e,childIndex:r,isHardened:n,curve:i}){if(n){const n=t.allocUnsafe(4);n.writeUInt32BE(r+a.BIP_32_HARDENED_OFFSET,0);const i=e,s=t.alloc(1,0);return t.concat([s,i,n])}const s=t.allocUnsafe(4);s.writeUInt32BE(r,0);const o=await i.getPublicKey(e,!0);return t.concat([o,s])}({privateKey:r.privateKeyBuffer,childIndex:h,isHardened:o,curve:n}),{privateKey:c,chainCode:l}=await async function({privateKey:e,chainCode:r,secretExtension:n,curve:a}){const o=i.hmac(s.sha512,r,n),c=t.from(o.slice(0,32)),u=t.from(o.slice(32));if("ed25519"===a.name){return{privateKey:c,publicKey:await a.getPublicKey(c),chainCode:u}}const l=d(e,c,a),h=await a.getPublicKey(l);return{privateKey:l,publicKey:h,chainCode:u}}({privateKey:r.privateKeyBuffer,chainCode:r.chainCodeBuffer,secretExtension:e,curve:n});return u.SLIP10Node.fromExtendedKey({privateKey:c,chainCode:l,depth:r.depth+1,parentFingerprint:r.fingerprint,index:h+(o?a.BIP_32_HARDENED_OFFSET:0),curve:n.name})}const f=await async function({parentPublicKey:e,childIndex:r}){const n=t.alloc(4);return n.writeUInt32BE(r,0),t.concat([e,n])}({parentPublicKey:r.compressedPublicKeyBuffer,childIndex:h,curve:n}),{publicKey:p,chainCode:m}=function({publicKey:e,chainCode:r,publicExtension:n,curve:a}){const o=i.hmac(s.sha512,r,n),c=o.slice(0,32),u=o.slice(32),l=a.publicAdd(e,t.from(c));return{publicKey:t.from(l),chainCode:t.from(u)}}({publicKey:r.compressedPublicKeyBuffer,chainCode:r.chainCodeBuffer,publicExtension:f,curve:n});return u.SLIP10Node.fromExtendedKey({publicKey:p,chainCode:m,depth:r.depth+1,parentFingerprint:r.fingerprint,index:h,curve:n.name})},r.privateAdd=d}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1579,{"../SLIP10Node":1571,"../curves":1575,"@noble/hashes/hmac":1587,"@noble/hashes/sha512":1591,"@scure/bip39":1755,buffer:2434},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.createBip39KeyFromSeed=r.deriveChildKey=r.bip39MnemonicToMultipath=void 0;const n=e("@scure/bip39"),i=e("@noble/hashes/hmac"),s=e("@noble/hashes/sha512"),a=e("../curves"),o=e("../SLIP10Node");async function c(e,r=a.secp256k1){const n=t.from(i.hmac(s.sha512,r.secret,e)),c=n.slice(0,32),u=n.slice(32);return o.SLIP10Node.fromExtendedKey({privateKey:c,chainCode:u,depth:0,parentFingerprint:0,index:0,curve:r.name})}r.bip39MnemonicToMultipath=function(e){return`bip39:${e.toLowerCase().trim()}`},r.deriveChildKey=async function({path:e,curve:r}){return c(t.from(n.mnemonicToSeedSync(e)),r)},r.createBip39KeyFromSeed=c}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[158,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:70,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=70;const r=function(e){var t;if(Array.isArray(null==e||null===(t=e.PermissionLogController)||void 0===t?void 0:t.permissionActivityLog)){const{PermissionLogController:{permissionActivityLog:t}}=e;t.forEach((e=>{e&&"object"==typeof e&&!Array.isArray(e)&&(delete e.request,delete e.response)}))}return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[1580,{"./bip32":1578,"./bip39":1579},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.derivers=void 0;const a=s(e("./bip32")),o=s(e("./bip39"));r.derivers={bip32:a,bip39:o}}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1581,{"./BIP44Node":1570,"./curves/secp256k1":1576,"./utils":1583,buffer:2434},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.encodeExtendedKey=r.decodeExtendedKey=r.PRIVATE_KEY_VERSION=r.PUBLIC_KEY_VERSION=void 0;const n=e("./utils"),i=e("./BIP44Node"),s=e("./curves/secp256k1");r.PUBLIC_KEY_VERSION=76067358,r.PRIVATE_KEY_VERSION=76066276;r.decodeExtendedKey=e=>{const t=n.decodeBase58check(e);if(78!==t.length)throw new Error(`Invalid extended key: Expected a length of 78, got ${t.length}.`);const a=t.readUInt32BE(0),o=t.readUInt8(4);i.validateBIP44Depth(o);const c=t.readUInt32BE(5),u=t.readUInt32BE(9),l=t.slice(13,45);if(!n.isValidBufferKey(l,32))throw new Error("Invalid extended key: Chain code must be a 32-byte non-zero Buffer.");const d=t.slice(45,78);if(!n.isValidBufferKey(d,33))throw new Error("Invalid extended key: Key must be a 33-byte non-zero Buffer.");if(a===r.PUBLIC_KEY_VERSION){if(2!==d.readUInt8(0)&&3!==d.readUInt8(0))throw new Error("Invalid extended key: Public key must start with 0x02 or 0x03.");return{version:a,depth:o,parentFingerprint:c,index:u,chainCode:l,publicKey:s.decompressPublicKey(d)}}if(a===r.PRIVATE_KEY_VERSION){if(0!==d.readUInt8(0))throw new Error("Invalid extended key: Private key must start with 0x00.");return{version:a,depth:o,parentFingerprint:c,index:u,chainCode:l,privateKey:d.slice(1)}}throw new Error("Invalid extended key: Expected a public (xpub) or private key (xprv) version.")};r.encodeExtendedKey=e=>{const{version:i,depth:a,parentFingerprint:o,index:c,chainCode:u}=e,l=t.alloc(78);if(l.writeUInt32BE(i,0),l.writeUInt8(a,4),l.writeUInt32BE(o,5),l.writeUInt32BE(c,9),u.copy(l,13),e.version===r.PUBLIC_KEY_VERSION){const{publicKey:t}=e;s.compressPublicKey(t).copy(l,45)}if(e.version===r.PRIVATE_KEY_VERSION){const{privateKey:t}=e;t.copy(l,46)}return n.encodeBase58check(l)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1582,{"./BIP44CoinTypeNode":1569,"./BIP44Node":1570,"./SLIP10Node":1571,"./constants":1572,"./curves":1575,buffer:2434},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.PackageBuffer=r.BIP44PurposeNodeToken=r.MAX_BIP_44_DEPTH=r.MIN_BIP_44_DEPTH=r.getBIP44AddressKeyDeriver=r.deriveBIP44AddressKey=r.BIP_44_COIN_TYPE_DEPTH=r.BIP44CoinTypeNode=r.ed25519=r.secp256k1=r.SLIP10Node=r.BIP44Node=void 0;var n=e("./BIP44Node");Object.defineProperty(r,"BIP44Node",{enumerable:!0,get:function(){return n.BIP44Node}});var i=e("./SLIP10Node");Object.defineProperty(r,"SLIP10Node",{enumerable:!0,get:function(){return i.SLIP10Node}});var s=e("./curves");Object.defineProperty(r,"secp256k1",{enumerable:!0,get:function(){return s.secp256k1}}),Object.defineProperty(r,"ed25519",{enumerable:!0,get:function(){return s.ed25519}});var a=e("./BIP44CoinTypeNode");Object.defineProperty(r,"BIP44CoinTypeNode",{enumerable:!0,get:function(){return a.BIP44CoinTypeNode}}),Object.defineProperty(r,"BIP_44_COIN_TYPE_DEPTH",{enumerable:!0,get:function(){return a.BIP_44_COIN_TYPE_DEPTH}}),Object.defineProperty(r,"deriveBIP44AddressKey",{enumerable:!0,get:function(){return a.deriveBIP44AddressKey}}),Object.defineProperty(r,"getBIP44AddressKeyDeriver",{enumerable:!0,get:function(){return a.getBIP44AddressKeyDeriver}});var o=e("./constants");Object.defineProperty(r,"MIN_BIP_44_DEPTH",{enumerable:!0,get:function(){return o.MIN_BIP_44_DEPTH}}),Object.defineProperty(r,"MAX_BIP_44_DEPTH",{enumerable:!0,get:function(){return o.MAX_BIP_44_DEPTH}}),Object.defineProperty(r,"BIP44PurposeNodeToken",{enumerable:!0,get:function(){return o.BIP44PurposeNodeToken}}),r.PackageBuffer=t}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1583,{"./constants":1572,"@noble/hashes/ripemd160":1588,"@noble/hashes/sha256":1589,"@noble/hashes/utils":1592,"@scure/base":1754,buffer:2434},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.getFingerprint=r.encodeBase58check=r.decodeBase58check=r.getBuffer=r.bytesToNumber=r.isValidInteger=r.isValidBufferKey=r.nullableHexStringToBuffer=r.hexStringToBuffer=r.isValidHexString=r.stripHexPrefix=r.isHardened=r.isValidBIP32Index=r.validateBIP32Index=r.getBIP32NodeToken=r.getUnhardenedBIP32NodeToken=r.getHardenedBIP32NodeToken=r.getBIP44CoinTypeToAddressPathTuple=r.getBIP44ChangePathString=r.getBIP44CoinTypePathString=void 0;const n=e("@noble/hashes/utils"),i=e("@scure/base"),s=e("@noble/hashes/sha256"),a=e("@noble/hashes/ripemd160"),o=e("./constants");function c(e){return d(e),`${u(e)}'`}function u(e){return d(e),`bip32:${e}`}function l(e){if("number"==typeof e)return u(e);if(!e||!Number.isInteger(e.index)||"boolean"!=typeof e.hardened)throw new Error("Invalid BIP-32 index: Must be an object containing the index and whether it is hardened.");return e.hardened?c(e.index):u(e.index)}function d(e){if(!h(e))throw new Error("Invalid BIP-32 index: Must be a non-negative integer.")}function h(e){return y(e)}function f(e){return e.replace(/^0x/iu,"")}function p(e){return/^(?:0x)?[a-f0-9]+$/iu.test(e)}function m(e){if(t.isBuffer(e))return e;if("string"!=typeof e||!p(e))throw new Error(`Invalid hex string: "${e}".`);return t.from(f(e),"hex")}function g(e,t){if(e.length!==t)return!1;for(const t of e)if(0!==t)return!0;return!1}function y(e){return"number"==typeof e&&Number.isInteger(e)&&e>=0}function b(e,t){if(!g(e,t))throw new Error(`Invalid value: Must be a non-zero ${t}-byte buffer.`)}r.getBIP44CoinTypePathString=function(e){return`m / ${o.BIP44PurposeNodeToken} / ${u(e)}'`},r.getBIP44ChangePathString=function(e,t){return`${e} / ${c(t.account||0)} / ${l(t.change||0)}`},r.getBIP44CoinTypeToAddressPathTuple=function({account:e=0,change:t=0,address_index:r}){return[c(e),l(t),l(r)]},r.getHardenedBIP32NodeToken=c,r.getUnhardenedBIP32NodeToken=u,r.getBIP32NodeToken=l,r.validateBIP32Index=d,r.isValidBIP32Index=h,r.isHardened=function(e){return e.endsWith("'")},r.stripHexPrefix=f,r.isValidHexString=p,r.hexStringToBuffer=m,r.nullableHexStringToBuffer=function(e){return e?m(e):undefined},r.isValidBufferKey=g,r.isValidInteger=y,r.bytesToNumber=function(e){return BigInt(`0x${n.bytesToHex(e)}`)},r.getBuffer=function(e,r){if(e instanceof t)return b(e,r),e;if("string"==typeof e){if(!p(e))throw new Error(`Invalid value: Must be a valid hex string of length: ${2*r}.`);const t=m(e);return b(t,r),t}throw new Error("Invalid value: Expected a Buffer or hexadecimal string.")};r.decodeBase58check=e=>{const r=i.base58check(s.sha256);try{return t.from(r.decode(e))}catch(e){throw new Error("Invalid value: Value is not base58-encoded, or the checksum is invalid.")}};r.encodeBase58check=e=>i.base58check(s.sha256).encode(e);r.getFingerprint=e=>{if(!g(e,33))throw new Error("Invalid public key: The key must be a 33-byte, non-zero Buffer.");return t.from(a.ripemd160(e)).readUInt32BE(0)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/rpc-methods>@metamask/key-tree"}],[1584,{"./utils.js":1592},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.SHA2=void 0;const n=e("./utils.js");class i extends n.Hash{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,n.createView)(this.buffer)}update(e){if(this.destroyed)throw new Error("instance is destroyed");const{view:t,buffer:r,blockLen:i,finished:s}=this;if(s)throw new Error("digest() was already called");const a=(e=(0,n.toBytes)(e)).length;for(let s=0;s<a;){const o=Math.min(i-this.pos,a-s);if(o!==i)r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(t,0),this.pos=0);else{const t=(0,n.createView)(e);for(;i<=a-s;s+=i)this.process(t,s)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){if(this.destroyed)throw new Error("instance is destroyed");if(!(e instanceof Uint8Array)||e.length<this.outputLen)throw new Error("_Sha2: Invalid output buffer");if(this.finished)throw new Error("digest() was already called");this.finished=!0;const{buffer:t,view:r,blockLen:i,isLE:s}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>i-a&&(this.process(r,0),a=0);for(let e=a;e<i;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const i=BigInt(32),s=BigInt(4294967295),a=Number(r>>i&s),o=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,a,n),e.setUint32(t+u,o,n)}(r,i-8,BigInt(8*this.length),s),this.process(r,0);const o=(0,n.createView)(e);this.get().forEach(((e,t)=>o.setUint32(4*t,e,s)))}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:a}=this;return e.length=n,e.pos=a,e.finished=i,e.destroyed=s,n%t&&e.buffer.set(r),e}}r.SHA2=i}}},{package:"@metamask/rpc-methods>@metamask/key-tree>@noble/hashes"}],[1585,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.add5H=r.add5L=r.add4H=r.add4L=r.add3H=r.add3L=r.add=r.rotlBL=r.rotlBH=r.rotlSL=r.rotlSH=r.rotr32L=r.rotr32H=r.rotrBL=r.rotrBH=r.rotrSL=r.rotrSH=r.shrSL=r.shrSH=r.toBig=r.split=r.fromBig=void 0;const n=BigInt(2**32-1),i=BigInt(32);function s(e,t=!1){return t?{h:Number(e&n),l:Number(e>>i&n)}:{h:0|Number(e>>i&n),l:0|Number(e&n)}}r.fromBig=s,r.split=function(e,t=!1){let r=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let i=0;i<e.length;i++){const{h:a,l:o}=s(e[i],t);[r[i],n[i]]=[a,o]}return[r,n]};r.toBig=(e,t)=>BigInt(e>>>0)<<i|BigInt(t>>>0);r.shrSH=(e,t,r)=>e>>>r;r.shrSL=(e,t,r)=>e<<32-r|t>>>r;r.rotrSH=(e,t,r)=>e>>>r|t<<32-r;r.rotrSL=(e,t,r)=>e<<32-r|t>>>r;r.rotrBH=(e,t,r)=>e<<64-r|t>>>r-32;r.rotrBL=(e,t,r)=>e>>>r-32|t<<64-r;r.rotr32H=(e,t)=>t;r.rotr32L=(e,t)=>e;r.rotlSH=(e,t,r)=>e<<r|t>>>32-r;r.rotlSL=(e,t,r)=>t<<r|e>>>32-r;r.rotlBH=(e,t,r)=>t<<r-32|e>>>64-r;r.rotlBL=(e,t,r)=>e<<r-32|t>>>64-r,r.add=function(e,t,r,n){const i=(t>>>0)+(n>>>0);return{h:e+r+(i/2**32|0)|0,l:0|i}};r.add3L=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0);r.add3H=(e,t,r,n)=>t+r+n+(e/2**32|0)|0;r.add4L=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0);r.add4H=(e,t,r,n,i)=>t+r+n+i+(e/2**32|0)|0;r.add5L=(e,t,r,n,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(i>>>0);r.add5H=(e,t,r,n,i,s)=>t+r+n+i+s+(e/2**32|0)|0}}},{package:"@metamask/rpc-methods>@metamask/key-tree>@noble/hashes"}],[1586,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.crypto=void 0,r.crypto={node:undefined,web:"object"==typeof self&&"crypto"in self?self.crypto:undefined}}}},{package:"@metamask/rpc-methods>@metamask/key-tree>@noble/hashes"}],[1587,{"./utils.js":1592},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.hmac=void 0;const n=e("./utils.js");class i extends n.Hash{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,(0,n.assertHash)(e);const r=(0,n.toBytes)(t);if(this.iHash=e.create(),!(this.iHash instanceof n.Hash))throw new TypeError("Expected instance of class which extends utils.Hash");const i=this.blockLen=this.iHash.blockLen;this.outputLen=this.iHash.outputLen;const s=new Uint8Array(i);s.set(r.length>this.iHash.blockLen?e.create().update(r).digest():r);for(let e=0;e<s.length;e++)s[e]^=54;this.iHash.update(s),this.oHash=e.create();for(let e=0;e<s.length;e++)s[e]^=106;this.oHash.update(s),s.fill(0)}update(e){if(this.destroyed)throw new Error("instance is destroyed");return this.iHash.update(e),this}digestInto(e){if(this.destroyed)throw new Error("instance is destroyed");if(!(e instanceof Uint8Array)||e.length!==this.outputLen)throw new Error("HMAC: Invalid output buffer");if(this.finished)throw new Error("digest() was already called");this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:a}=this;return(e=e).finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}r.hmac=(e,t,r)=>new i(e,t).update(r).digest(),r.hmac.create=(e,t)=>new i(e,t)}}},{package:"@metamask/rpc-methods>@metamask/key-tree>@noble/hashes"}],[1588,{"./_sha2.js":1584,"./utils.js":1592},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ripemd160=r.RIPEMD160=void 0;const n=e("./_sha2.js"),i=e("./utils.js"),s=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),a=Uint8Array.from({length:16},((e,t)=>t)),o=a.map((e=>(9*e+5)%16));let c=[a],u=[o];for(let e=0;e<4;e++)for(let t of[c,u])t.push(t[e].map((e=>s[e])));const l=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map((e=>new Uint8Array(e))),d=c.map(((e,t)=>e.map((e=>l[t][e])))),h=u.map(((e,t)=>e.map((e=>l[t][e])))),f=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),p=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),m=(e,t)=>e<<t|e>>>32-t;function g(e,t,r,n){return 0===e?t^r^n:1===e?t&r|~t&n:2===e?(t|~r)^n:3===e?t&n|r&~n:t^(r|~n)}const y=new Uint32Array(16);class b extends n.SHA2{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:r,h3:n,h4:i}=this;return[e,t,r,n,i]}set(e,t,r,n,i){this.h0=0|e,this.h1=0|t,this.h2=0|r,this.h3=0|n,this.h4=0|i}process(e,t){for(let r=0;r<16;r++,t+=4)y[r]=e.getUint32(t,!0);let r=0|this.h0,n=r,i=0|this.h1,s=i,a=0|this.h2,o=a,l=0|this.h3,b=l,v=0|this.h4,w=v;for(let e=0;e<5;e++){const t=4-e,_=f[e],S=p[e],k=c[e],E=u[e],P=d[e],T=h[e];for(let t=0;t<16;t++){const n=m(r+g(e,i,a,l)+y[k[t]]+_,P[t])+v|0;r=v,v=l,l=0|m(a,10),a=i,i=n}for(let e=0;e<16;e++){const r=m(n+g(t,s,o,b)+y[E[e]]+S,T[e])+w|0;n=w,w=b,b=0|m(o,10),o=s,s=r}}this.set(this.h1+a+b|0,this.h2+l+w|0,this.h3+v+n|0,this.h4+r+s|0,this.h0+i+o|0)}roundClean(){y.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}r.RIPEMD160=b,r.ripemd160=(0,i.wrapConstructor)((()=>new b))}}},{package:"@metamask/rpc-methods>@metamask/key-tree>@noble/hashes"}],[1589,{"./_sha2.js":1584,"./utils.js":1592},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.sha256=void 0;const n=e("./_sha2.js"),i=e("./utils.js"),s=(e,t,r)=>e&t^e&r^t&r,a=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),o=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),c=new Uint32Array(64);class u extends n.SHA2{constructor(){super(64,32,8,!1),this.A=0|o[0],this.B=0|o[1],this.C=0|o[2],this.D=0|o[3],this.E=0|o[4],this.F=0|o[5],this.G=0|o[6],this.H=0|o[7]}get(){const{A:e,B:t,C:r,D:n,E:i,F:s,G:a,H:o}=this;return[e,t,r,n,i,s,a,o]}set(e,t,r,n,i,s,a,o){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|a,this.H=0|o}process(e,t){for(let r=0;r<16;r++,t+=4)c[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=c[e-15],r=c[e-2],n=(0,i.rotr)(t,7)^(0,i.rotr)(t,18)^t>>>3,s=(0,i.rotr)(r,17)^(0,i.rotr)(r,19)^r>>>10;c[e]=s+c[e-7]+n+c[e-16]|0}let{A:r,B:n,C:o,D:u,E:l,F:d,G:h,H:f}=this;for(let e=0;e<64;e++){const t=f+((0,i.rotr)(l,6)^(0,i.rotr)(l,11)^(0,i.rotr)(l,25))+((p=l)&d^~p&h)+a[e]+c[e]|0,m=((0,i.rotr)(r,2)^(0,i.rotr)(r,13)^(0,i.rotr)(r,22))+s(r,n,o)|0;f=h,h=d,d=l,l=u+t|0,u=o,o=n,n=r,r=t+m|0}var p;r=r+this.A|0,n=n+this.B|0,o=o+this.C|0,u=u+this.D|0,l=l+this.E|0,d=d+this.F|0,h=h+this.G|0,f=f+this.H|0,this.set(r,n,o,u,l,d,h,f)}roundClean(){c.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}r.sha256=(0,i.wrapConstructor)((()=>new u))}}},{package:"@metamask/rpc-methods>@metamask/key-tree>@noble/hashes"}],[159,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:71,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=71;const r=function(e){e.NotificationController&&(e.AnnouncementController={announcements:e.NotificationController.notifications},delete e.NotificationController);return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[1590,{"./_u64.js":1585,"./utils.js":1592},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.shake256=r.shake128=r.keccak_512=r.keccak_384=r.keccak_256=r.keccak_224=r.sha3_512=r.sha3_384=r.sha3_256=r.sha3_224=r.Keccak=r.keccakP=void 0;const a=s(e("./_u64.js")),o=e("./utils.js"),[c,u,l]=[[],[],[]],d=BigInt(0),h=BigInt(1),f=BigInt(2),p=BigInt(7),m=BigInt(256),g=BigInt(113);for(let e=0,t=h,r=1,n=0;e<24;e++){[r,n]=[n,(2*r+3*n)%5],c.push(2*(5*n+r)),u.push((e+1)*(e+2)/2%64);let i=d;for(let e=0;e<7;e++)t=(t<<h^(t>>p)*g)%m,t&f&&(i^=h<<(h<<BigInt(e))-h);l.push(i)}const[y,b]=a.split(l,!0),v=(e,t,r)=>r>32?a.rotlBH(e,t,r):a.rotlSH(e,t,r),w=(e,t,r)=>r>32?a.rotlBL(e,t,r):a.rotlSL(e,t,r);function _(e,t=24){const r=new Uint32Array(10);for(let n=24-t;n<24;n++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){const n=(t+8)%10,i=(t+2)%10,s=r[i],a=r[i+1],o=v(s,a,1)^r[n],c=w(s,a,1)^r[n+1];for(let r=0;r<50;r+=10)e[t+r]^=o,e[t+r+1]^=c}let t=e[2],i=e[3];for(let r=0;r<24;r++){const n=u[r],s=v(t,i,n),a=w(t,i,n),o=c[r];t=e[o],i=e[o+1],e[o]=s,e[o+1]=a}for(let t=0;t<50;t+=10){for(let n=0;n<10;n++)r[n]=e[t+n];for(let n=0;n<10;n++)e[t+n]^=~r[(n+2)%10]&r[(n+4)%10]}e[0]^=y[n],e[1]^=b[n]}r.fill(0)}r.keccakP=_;class S extends o.Hash{constructor(e,t,r,n=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,o.assertNumber)(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,o.u32)(this.state)}keccak(){_(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){if(this.destroyed)throw new Error("instance is destroyed");if(this.finished)throw new Error("digest() was already called");const{blockLen:t,state:r}=this,n=(e=(0,o.toBytes)(e)).length;for(let i=0;i<n;){const s=Math.min(t-this.pos,n-i);for(let t=0;t<s;t++)r[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:n}=this;e[r]^=t,0!=(128&t)&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){if(this.destroyed)throw new Error("instance is destroyed");if(!(e instanceof Uint8Array))throw new Error("Keccak: invalid output buffer");this.finish();for(let t=0,r=e.length;t<r;){this.posOut>=this.blockLen&&this.keccak();const n=Math.min(this.blockLen-this.posOut,r-t);e.set(this.state.subarray(this.posOut,this.posOut+n),t),this.posOut+=n,t+=n}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,o.assertNumber)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(e.length<this.outputLen)throw new Error("Keccak: invalid output buffer");if(this.finished)throw new Error("digest() was already called");return this.finish(),this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:n,rounds:i,enableXOF:s}=this;return e||(e=new S(t,r,n,s,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=r,e.outputLen=n,e.enableXOF=s,e.destroyed=this.destroyed,e}}r.Keccak=S;const k=(e,t,r)=>(0,o.wrapConstructor)((()=>new S(t,e,r)));r.sha3_224=k(6,144,28),r.sha3_256=k(6,136,32),r.sha3_384=k(6,104,48),r.sha3_512=k(6,72,64),r.keccak_224=k(1,144,28),r.keccak_256=k(1,136,32),r.keccak_384=k(1,104,48),r.keccak_512=k(1,72,64);const E=(e,t,r)=>(0,o.wrapConstructorWithOpts)(((n={})=>new S(t,e,n.dkLen!==undefined?n.dkLen:r,!0)));r.shake128=E(31,168,16),r.shake256=E(31,136,32)}}},{package:"@metamask/rpc-methods>@metamask/key-tree>@noble/hashes"}],[1591,{"./_sha2.js":1584,"./_u64.js":1585,"./utils.js":1592},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.sha384=r.sha512_256=r.sha512=r.SHA512=void 0;const a=e("./_sha2.js"),o=s(e("./_u64.js")),c=e("./utils.js"),[u,l]=o.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))),d=new Uint32Array(80),h=new Uint32Array(80);class f extends a.SHA2{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:r,Bl:n,Ch:i,Cl:s,Dh:a,Dl:o,Eh:c,El:u,Fh:l,Fl:d,Gh:h,Gl:f,Hh:p,Hl:m}=this;return[e,t,r,n,i,s,a,o,c,u,l,d,h,f,p,m]}set(e,t,r,n,i,s,a,o,c,u,l,d,h,f,p,m){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|i,this.Cl=0|s,this.Dh=0|a,this.Dl=0|o,this.Eh=0|c,this.El=0|u,this.Fh=0|l,this.Fl=0|d,this.Gh=0|h,this.Gl=0|f,this.Hh=0|p,this.Hl=0|m}process(e,t){for(let r=0;r<16;r++,t+=4)d[r]=e.getUint32(t),h[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|d[e-15],r=0|h[e-15],n=o.rotrSH(t,r,1)^o.rotrSH(t,r,8)^o.shrSH(t,r,7),i=o.rotrSL(t,r,1)^o.rotrSL(t,r,8)^o.shrSL(t,r,7),s=0|d[e-2],a=0|h[e-2],c=o.rotrSH(s,a,19)^o.rotrBH(s,a,61)^o.shrSH(s,a,6),u=o.rotrSL(s,a,19)^o.rotrBL(s,a,61)^o.shrSL(s,a,6),l=o.add4L(i,u,h[e-7],h[e-16]),f=o.add4H(l,n,c,d[e-7],d[e-16]);d[e]=0|f,h[e]=0|l}let{Ah:r,Al:n,Bh:i,Bl:s,Ch:a,Cl:c,Dh:f,Dl:p,Eh:m,El:g,Fh:y,Fl:b,Gh:v,Gl:w,Hh:_,Hl:S}=this;for(let e=0;e<80;e++){const t=o.rotrSH(m,g,14)^o.rotrSH(m,g,18)^o.rotrBH(m,g,41),k=o.rotrSL(m,g,14)^o.rotrSL(m,g,18)^o.rotrBL(m,g,41),E=m&y^~m&v,P=g&b^~g&w,T=o.add5L(S,k,P,l[e],h[e]),A=o.add5H(T,_,t,E,u[e],d[e]),O=0|T,I=o.rotrSH(r,n,28)^o.rotrBH(r,n,34)^o.rotrBH(r,n,39),C=o.rotrSL(r,n,28)^o.rotrBL(r,n,34)^o.rotrBL(r,n,39),x=r&i^r&a^i&a,N=n&s^n&c^s&c;_=0|v,S=0|w,v=0|y,w=0|b,y=0|m,b=0|g,({h:m,l:g}=o.add(0|f,0|p,0|A,0|O)),f=0|a,p=0|c,a=0|i,c=0|s,i=0|r,s=0|n;const M=o.add3L(O,C,N);r=o.add3H(M,A,I,x),n=0|M}({h:r,l:n}=o.add(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:s}=o.add(0|this.Bh,0|this.Bl,0|i,0|s)),({h:a,l:c}=o.add(0|this.Ch,0|this.Cl,0|a,0|c)),({h:f,l:p}=o.add(0|this.Dh,0|this.Dl,0|f,0|p)),({h:m,l:g}=o.add(0|this.Eh,0|this.El,0|m,0|g)),({h:y,l:b}=o.add(0|this.Fh,0|this.Fl,0|y,0|b)),({h:v,l:w}=o.add(0|this.Gh,0|this.Gl,0|v,0|w)),({h:_,l:S}=o.add(0|this.Hh,0|this.Hl,0|_,0|S)),this.set(r,n,i,s,a,c,f,p,m,g,y,b,v,w,_,S)}roundClean(){d.fill(0),h.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}r.SHA512=f;class p extends f{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class m extends f{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}r.sha512=(0,c.wrapConstructor)((()=>new f)),r.sha512_256=(0,c.wrapConstructor)((()=>new p)),r.sha384=(0,c.wrapConstructor)((()=>new m))}}},{package:"@metamask/rpc-methods>@metamask/key-tree>@noble/hashes"}],[1592,{"@noble/hashes/crypto":1586},function(){with(this)return function(){"use strict";return function(e,t,r){
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
Object.defineProperty(r,"__esModule",{value:!0}),r.randomBytes=r.wrapConstructorWithOpts=r.wrapConstructor=r.checkOpts=r.Hash=r.assertHash=r.assertBytes=r.assertBool=r.assertNumber=r.concatBytes=r.toBytes=r.utf8ToBytes=r.asyncLoop=r.nextTick=r.hexToBytes=r.bytesToHex=r.isLE=r.rotr=r.createView=r.u32=r.u8=void 0;const n=e("@noble/hashes/crypto");r.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);r.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));r.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);if(r.rotr=(e,t)=>e<<32-t|e>>>t,r.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],!r.isLE)throw new Error("Non little-endian hardware is not supported");const i=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function s(e){if("string"!=typeof e)throw new TypeError("utf8ToBytes expected string, got "+typeof e);return(new TextEncoder).encode(e)}function a(e){if("string"==typeof e&&(e=s(e)),!(e instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof e})`);return e}function o(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}r.bytesToHex=function(e){let t="";for(let r=0;r<e.length;r++)t+=i[e[r]];return t},r.hexToBytes=function(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r,i=e.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s))throw new Error("Invalid byte sequence");t[r]=s}return t},r.nextTick=(()=>{const e=void 0!==t&&"function"==typeof t.require&&t.require.bind(t);try{if(e){const{setImmediate:t}=e("timers");return()=>new Promise((e=>t(e)))}}catch(e){}return()=>new Promise((e=>setTimeout(e,0)))})(),r.asyncLoop=async function(e,t,n){let i=Date.now();for(let s=0;s<e;s++){n(s);const e=Date.now()-i;e>=0&&e<t||(await(0,r.nextTick)(),i+=e)}},r.utf8ToBytes=s,r.toBytes=a,r.concatBytes=function(...e){if(!e.every((e=>e instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r},r.assertNumber=o,r.assertBool=function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},r.assertBytes=function(e,...t){if(!(e instanceof Uint8Array)||t.length&&!t.includes(e.length))throw new TypeError(`Expected ${t} bytes, not ${typeof e} with length=${e.length}`)},r.assertHash=function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");o(e.outputLen),o(e.blockLen)};r.Hash=class{clone(){return this._cloneInto()}};r.checkOpts=function(e,t){if(t!==undefined&&("object"!=typeof t||(r=t,"[object Object]"!==Object.prototype.toString.call(r)||r.constructor!==Object)))throw new TypeError("Options should be object or undefined");var r;return Object.assign(e,t)},r.wrapConstructor=function(e){const t=t=>e().update(a(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t},r.wrapConstructorWithOpts=function(e){const t=(t,r)=>e(r).update(a(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},r.randomBytes=function(e=32){if(n.crypto.web)return n.crypto.web.getRandomValues(new Uint8Array(e));if(n.crypto.node)return new Uint8Array(n.crypto.node.randomBytes(e).buffer);throw new Error("The environment doesn't have randomBytes function")}}}},{package:"@metamask/rpc-methods>@metamask/key-tree>@noble/hashes"}],[16,{"../../../../shared/constants/network":7322,"eth-block-tracker":2733,"eth-json-rpc-infura":2765,"eth-json-rpc-middleware":2771,"json-rpc-engine":5166},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({network:e,projectId:t}){const r=(0,a.default)({network:e,projectId:t,maxAttempts:5,source:"metamask"}),n=(0,s.providerFromMiddleware)(r),c=new o.PollingBlockTracker({provider:n});return{networkMiddleware:(0,i.mergeMiddleware)([u({network:e}),(0,s.createBlockCacheMiddleware)({blockTracker:c}),(0,s.createInflightCacheMiddleware)(),(0,s.createBlockRefMiddleware)({blockTracker:c,provider:n}),(0,s.createRetryOnEmptyMiddleware)({blockTracker:c,provider:n}),(0,s.createBlockTrackerInspectorMiddleware)({blockTracker:c}),r]),blockTracker:c}};var n,i=e("json-rpc-engine"),s=e("eth-json-rpc-middleware"),a=(n=e("eth-json-rpc-infura"))&&n.__esModule?n:{default:n},o=e("eth-block-tracker"),c=e("../../../../shared/constants/network");function u({network:e}){if(!c.NETWORK_TYPE_TO_ID_MAP[e])throw new Error(`createInfuraClient - unknown network "${e}"`);const{chainId:t,networkId:r}=c.NETWORK_TYPE_TO_ID_MAP[e];return(0,i.createScaffoldMiddleware)({eth_chainId:t,net_version:r})}}}},{package:"$root$"}],[160,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:72,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=72;const r=function(e){const t=(null==e?void 0:e.PreferencesController)||{};return{...e,PreferencesController:{...t,knownMethodData:{}}}}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[1600,{"./Substream":1601,"end-of-stream":2709,once:5726,"readable-stream":6831},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ObjectMultiplex=void 0;const i=e("readable-stream"),s=n(e("end-of-stream")),a=n(e("once")),o=e("./Substream"),c=Symbol("IGNORE_SUBSTREAM");class u extends i.Duplex{constructor(e={}){super(Object.assign(Object.assign({},e),{objectMode:!0})),this._substreams={}}createStream(e){if(this.destroyed)throw new Error(`ObjectMultiplex - parent stream for name "${e}" already destroyed`);if(this._readableState.ended||this._writableState.ended)throw new Error(`ObjectMultiplex - parent stream for name "${e}" already ended`);if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const t=new o.Substream({parent:this,name:e});return this._substreams[e]=t,function(e,t){const r=a.default(t);s.default(e,{readable:!1},r),s.default(e,{writable:!1},r)}(this,(e=>t.destroy(e||undefined))),t}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=c}_read(){return undefined}_write(e,t,r){const{name:n,data:i}=e;if(!n)return console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),r();const s=this._substreams[n];return s?(s!==c&&s.push(i),r()):(console.warn(`ObjectMultiplex - orphaned data for stream "${n}"`),r())}}r.ObjectMultiplex=u}}},{package:"@metamask/providers>@metamask/object-multiplex"}],[1601,{"readable-stream":6831},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.Substream=void 0;const n=e("readable-stream");class i extends n.Duplex{constructor({parent:e,name:t}){super({objectMode:!0}),this._parent=e,this._name=t}_read(){return undefined}_write(e,t,r){this._parent.push({name:this._name,data:e}),r()}}r.Substream=i}}},{package:"@metamask/providers>@metamask/object-multiplex"}],[1602,{"./ObjectMultiplex":1600},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./ObjectMultiplex");t.exports=n.ObjectMultiplex}}},{package:"@metamask/providers>@metamask/object-multiplex"}],[1603,{"./ObservableStore":1606},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ComposedStore=void 0;const n=e("./ObservableStore");class i extends n.ObservableStore{constructor(e){super();this.getState()||this.putState({}),this._children=e||{},Object.keys(this._children).forEach((e=>{const t=this._children[e];this._addChild(e,t)}))}_addChild(e,t){const r=t=>{const r=this.getState();r[e]=t,this.putState(r)};t.subscribe(r),r(t.getState())}}r.ComposedStore=i}}},{package:"@metamask/obs-store"}],[1604,{"./ObservableStore":1606},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LocalStorageStore=void 0;const n=e("./ObservableStore");class i extends n.ObservableStore{constructor(e={}){if(!global.localStorage)throw new Error("LocalStorageStore - can't find localStorage.");if(super(),!e.storageKey)throw new Error("LocalStorageStore - no storageKey specified.");this._storageKey=e.storageKey}_getState(){const e=global.localStorage.getItem(this._storageKey);return e?JSON.parse(e):undefined}_putState(e){const t=JSON.stringify(e);return global.localStorage.setItem(this._storageKey,t)}}r.LocalStorageStore=i}}},{package:"@metamask/obs-store"}],[1605,{"./ObservableStore":1606},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MergedStore=void 0;const n=e("./ObservableStore");class i extends n.ObservableStore{constructor(e=[]){super();this.getState()||this.putState({}),this._children=e,e.forEach((e=>this._addChild(e))),this._updateWholeState()}_addChild(e){e.subscribe((()=>this._updateWholeState()))}_updateWholeState(){const e=this._children.map((e=>e.getState())),t=Object.assign({},...e);this.putState(t)}}r.MergedStore=i}}},{package:"@metamask/obs-store"}],[1606,{"@metamask/safe-event-emitter":1629},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ObservableStore=void 0;const i=n(e("@metamask/safe-event-emitter"));class s extends i.default{constructor(e={}){super(),this._state=e}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState(),r=Object.assign({},t,e);this.putState(r)}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}r.ObservableStore=s}}},{package:"@metamask/obs-store"}],[1607,{stream:2437},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeAsStream=void 0;const n=e("stream");class i extends n.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const r=super.pipe(e,t);return e.write(this.obsStore.getState()),r}_write(e,t,r){this.obsStore.putState(e),r()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}r.storeAsStream=function(e){return new i(e)}}}},{package:"@metamask/obs-store"}],[1608,{"./ComposedStore":1603,"./LocalStorageStore":1604,"./MergedStore":1605,"./ObservableStore":1606,"./asStream":1607,"./transform":1609},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./asStream"),r),i(e("./ComposedStore"),r),i(e("./LocalStorageStore"),r),i(e("./MergedStore"),r),i(e("./ObservableStore"),r),i(e("./transform"),r)}}},{package:"@metamask/obs-store"}],[1609,{through2:1610},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeTransformStream=void 0;const n=e("through2");r.storeTransformStream=function(e){return n.obj(((t,r,n)=>{try{return n(null,e(t)),undefined}catch(e){return n(e),undefined}}))}}}},{package:"@metamask/obs-store"}],[161,{lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:73,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=73;const r=function(e){const t=(null==e?void 0:e.PreferencesController)||{};return{...e,PreferencesController:{...t,knownMethodData:{}}}}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[1610,{_process:5832,"readable-stream":6831,util:2440,xtend:7303},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("readable-stream").Transform,i=e("util").inherits,s=e("xtend");function a(e){n.call(this,e),this._destroyed=!1}function o(e,t,r){r(null,e)}function c(e){return function(t,r,n){return"function"==typeof t&&(n=r,r=t,t={}),"function"!=typeof r&&(r=o),"function"!=typeof n&&(n=null),e(t,r,n)}}i(a,n),a.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=c((function(e,t,r){var n=new a(e);return n._transform=t,r&&(n._flush=r),n})),t.exports.ctor=c((function(e,t,r){function n(t){if(!(this instanceof n))return new n(t);this.options=s(e,t),a.call(this,this.options)}return i(n,a),n.prototype._transform=t,r&&(n.prototype._flush=r),n})),t.exports.obj=c((function(e,t,r){var n=new a(s({objectMode:!0,highWaterMark:16},e));return n._transform=t,r&&(n._flush=r),n}))}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/obs-store>through2"}],[1611,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.SnapCaveatType=void 0,function(e){e.PermittedDerivationPaths="permittedDerivationPaths",e.PermittedCoinTypes="permittedCoinTypes"}(r.SnapCaveatType||(r.SnapCaveatType={}))}}},{package:"@metamask/rpc-methods"}],[1612,{"./caveats":1611,"./permitted":1617,"./restricted":1624,"./utils":1628},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.selectHooks=r.SnapCaveatType=r.caveatMappers=r.caveatSpecifications=r.restrictedMethodPermissionBuilders=r.permittedMethods=void 0;var n=e("./permitted");Object.defineProperty(r,"permittedMethods",{enumerable:!0,get:function(){return n.handlers}});var i=e("./restricted");Object.defineProperty(r,"restrictedMethodPermissionBuilders",{enumerable:!0,get:function(){return i.builders}}),Object.defineProperty(r,"caveatSpecifications",{enumerable:!0,get:function(){return i.caveatSpecifications}}),Object.defineProperty(r,"caveatMappers",{enumerable:!0,get:function(){return i.caveatMappers}});var s=e("./caveats");Object.defineProperty(r,"SnapCaveatType",{enumerable:!0,get:function(){return s.SnapCaveatType}});var a=e("./utils");Object.defineProperty(r,"selectHooks",{enumerable:!0,get:function(){return a.selectHooks}})}}},{package:"@metamask/rpc-methods"}],[1613,{"@metamask/snap-utils":1716,"@metamask/utils":1730,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.handleInstallSnaps=r.preprocessRequestedPermissions=void 0;const n=e("eth-rpc-errors"),i=e("@metamask/utils"),s=e("@metamask/snap-utils");r.preprocessRequestedPermissions=function(e){if(!(0,i.isObject)(e))throw n.ethErrors.rpc.invalidRequest({data:{requestedPermissions:e}});return e.wallet_snap?Object.keys(e).reduce(((t,r)=>{if("wallet_snap"===r){if(!(0,i.isObject)(e[r]))throw n.ethErrors.rpc.invalidParams({message:"Invalid params to 'wallet_requestPermissions'",data:{requestedPermissions:e}});const a=e[r];Object.keys(a).forEach((r=>{const i=s.SNAP_PREFIX+r;if(e[i])throw n.ethErrors.rpc.invalidParams({message:`Snap '${r}' requested both as direct permission and under 'wallet_snap'. We recommend using 'wallet_snap' only.`,data:{requestedPermissions:e}});t[i]=a[r]}))}else t[r]=e[r];return t}),{}):e},r.handleInstallSnaps=async function(e,t){if(!(0,i.isObject)(e))throw n.ethErrors.rpc.invalidParams({message:"Invalid snap installation params.",data:{requestedSnaps:e}});if(0===Object.keys(e).length)throw n.ethErrors.rpc.invalidParams({message:"Must specify at least one snap to install.",data:{requestedSnaps:e}});return await t(e)}}}},{package:"@metamask/rpc-methods"}],[1614,{"./common/snapInstallation":1613,"@metamask/snap-utils":1716,"@metamask/utils":1730,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.enableWalletHandler=void 0;const n=e("@metamask/snap-utils"),i=e("@metamask/utils"),s=e("eth-rpc-errors"),a=e("./common/snapInstallation");r.enableWalletHandler={methodNames:["wallet_enable"],implementation:async function(e,t,r,o,{getAccounts:c,installSnaps:u,requestPermissions:l,getPermissions:d}){if(!Array.isArray(e.params))return o(s.ethErrors.rpc.invalidParams({message:'"params" must be an array.'}));const h={accounts:[],permissions:[],snaps:{}};let f;try{f=(0,a.preprocessRequestedPermissions)(e.params[0]);const t=await d();if(t&&function(e,t){return Object.entries(t).every((([t,r])=>!((null==r?void 0:r.caveats)&&r.caveats.length>0)&&(0,i.hasProperty)(e,t)))}(t,f)?h.permissions=Object.values(t):h.permissions=await l(f),!h.permissions||!h.permissions.length)throw s.ethErrors.provider.userRejectedRequest({data:e})}catch(e){return o(e)}const p=h.permissions.filter((e=>e.parentCapability.startsWith(n.SNAP_PREFIX)&&e.parentCapability in f)).reduce(((e,t)=>(e[t.parentCapability.replace(n.SNAP_PREFIX_REGEX,"")]=f[t.parentCapability],e)),{});try{Object.keys(p).length>0&&(h.snaps=await(0,a.handleInstallSnaps)(p,u))}catch(e){h.errors||(h.errors=[]),h.errors.push((0,s.serializeError)(e))}return h.accounts=await c(),t.result=h,o()},hookNames:{getAccounts:!0,installSnaps:!0,requestPermissions:!0,getPermissions:!0}}}}},{package:"@metamask/rpc-methods"}],[1615,{"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getAppKeyHandler=void 0;const n=e("eth-rpc-errors");r.getAppKeyHandler={methodNames:["snap_getAppKey"],implementation:async function(e,t,r,i,{getAppKey:s,getUnlockPromise:a}){const[o]=(null==e?void 0:e.params)||[];if(o!==undefined&&(!o||"string"!=typeof o))return i(n.ethErrors.rpc.invalidParams({message:"Must omit params completely or specify a single hexadecimal string Ethereum account."}));try{return await a(!0),t.result=await s(o),i()}catch(e){return i(e)}},hookNames:{getAppKey:!0,getUnlockPromise:!0}}}}},{package:"@metamask/rpc-methods"}],[1616,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSnapsHandler=void 0,r.getSnapsHandler={methodNames:["wallet_getSnaps"],implementation:function(e,t,r,n,{getSnaps:i}){return t.result=i(),n()},hookNames:{getSnaps:!0}}}}},{package:"@metamask/rpc-methods"}],[1617,{"./enable":1614,"./getAppKey":1615,"./getSnaps":1616,"./installSnaps":1618,"./invokeSnapSugar":1619},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.handlers=void 0;const n=e("./enable"),i=e("./getAppKey"),s=e("./getSnaps"),a=e("./installSnaps"),o=e("./invokeSnapSugar");r.handlers=[n.enableWalletHandler,i.getAppKeyHandler,s.getSnapsHandler,a.installSnapsHandler,o.invokeSnapSugarHandler]}}},{package:"@metamask/rpc-methods"}],[1618,{"./common/snapInstallation":1613,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.installSnapsHandler=void 0;const n=e("eth-rpc-errors"),i=e("./common/snapInstallation");r.installSnapsHandler={methodNames:["wallet_installSnaps"],implementation:async function(e,t,r,s,{installSnaps:a}){if(!Array.isArray(e.params))return s(n.ethErrors.rpc.invalidParams({message:'"params" must be an array.'}));try{t.result=await(0,i.handleInstallSnaps)(e.params[0],a)}catch(e){t.error=e}return s()},hookNames:{installSnaps:!0}}}}},{package:"@metamask/rpc-methods"}],[1619,{"@metamask/snap-utils":1716,"@metamask/utils":1730,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.invokeSnapSugarHandler=void 0;const n=e("eth-rpc-errors"),i=e("@metamask/utils"),s=e("@metamask/snap-utils");r.invokeSnapSugarHandler={methodNames:["wallet_invokeSnap"],implementation:function(e,t,r,a){if(!Array.isArray(e.params)||"string"!=typeof e.params[0]||!(0,i.isObject)(e.params[1]))return a(n.ethErrors.rpc.invalidParams({message:"Must specify a string snap ID and a plain request object."}));return e.method=s.SNAP_PREFIX+e.params[0],e.params=[e.params[1]],r()},hookNames:undefined}}}},{package:"@metamask/rpc-methods"}],[162,{"../../../shared/constants/transaction":7329,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){return function(s){const a=(0,n.cloneDeep)(s);a.meta.version=e;try{const e=function(e,t,r){const n=e,{TransactionController:s}=n;if(s&&s.transactions){const{transactions:e}=s;n.TransactionController.transactions=e.map((e=>t(e)?(e.status=i.TRANSACTION_STATUSES.FAILED,e.err={message:r,note:`Tx automatically failed by migration because ${r}`},e):e))}return n}(a.data,r,t);a.data=e}catch(t){console.warn(`MetaMask Migration #${e}${t.stack}`)}return Promise.resolve(a)}};var n=e("lodash"),i=e("../../../shared/constants/transaction")}}},{package:"$root$"}],[1620,{"@metamask/controllers":1458,"@metamask/utils":1730,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.confirmBuilder=void 0;const n=e("@metamask/controllers"),i=e("@metamask/utils"),s=e("eth-rpc-errors"),a="snap_confirm";function o({showConfirmation:e}){return async function(t){const{params:r,context:{origin:n}}=t;return await e(n,function(e){if(!Array.isArray(e)||!(0,i.isObject)(e[0]))throw s.ethErrors.rpc.invalidParams({message:"Expected array params with single object."});const{prompt:t,description:r,textAreaContent:n}=e[0];if(!t||"string"!=typeof t||t.length>40)throw s.ethErrors.rpc.invalidParams({message:'Must specify a non-empty string "prompt" less than 40 characters long.'});if(r&&("string"!=typeof r||r.length>140))throw s.ethErrors.rpc.invalidParams({message:'"description" must be a string no more than 140 characters long if specified.'});if(n&&("string"!=typeof n||n.length>1800))throw s.ethErrors.rpc.invalidParams({message:'"textAreaContent" must be a string no more than 1800 characters long if specified.'});return e[0]}(r))}}r.confirmBuilder=Object.freeze({targetKey:a,specificationBuilder:({allowedCaveats:e=null,methodHooks:t})=>({permissionType:n.PermissionType.RestrictedMethod,targetKey:a,allowedCaveats:e,methodImplementation:o(t)}),methodHooks:{showConfirmation:!0}})}}},{package:"@metamask/rpc-methods"}],[1621,{"../caveats":1611,"../utils":1628,"@metamask/controllers":1458,"@metamask/key-tree":1582,"@metamask/utils":1730,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getBip32EntropyImplementation=r.getBip32EntropyCaveatSpecifications=r.getBip32EntropyCaveatMapper=r.getBip32EntropyBuilder=r.validateCaveatPaths=r.validatePath=void 0;const n=e("@metamask/controllers"),i=e("eth-rpc-errors"),s=e("@metamask/utils"),a=e("@metamask/key-tree"),o=e("../caveats"),c=e("../utils"),u=/^\d+'?$/u,l="snap_getBip32Entropy";function d(e){if(!(0,s.isPlainObject)(e))throw i.ethErrors.rpc.invalidParams({message:"Expected a plain object."});if(!(0,s.hasProperty)(e,"path")||!Array.isArray(e.path)||0===e.path.length)throw i.ethErrors.rpc.invalidParams({message:'Invalid "path" parameter. The path must be a non-empty BIP-32 derivation path array.'});if("m"!==e.path[0])throw i.ethErrors.rpc.invalidParams({message:'Invalid "path" parameter. The path must start with "m".'});if(e.path.slice(1).some((e=>"string"!=typeof e||!u.test(e))))throw i.ethErrors.rpc.invalidParams({message:'Invalid "path" parameter. The path must be a valid BIP-32 derivation path array.'});if(e.path.length<3)throw i.ethErrors.rpc.invalidParams({message:'Invalid "path" parameter. Paths must have a length of at least three.'});if(!(0,s.hasProperty)(e,"curve")||"secp256k1"!==e.curve&&"ed25519"!==e.curve)throw i.ethErrors.rpc.invalidParams({message:'Invalid "curve" parameter. The curve must be "secp256k1" or "ed25519".'});if("ed25519"===e.curve&&e.path.slice(1).some((e=>!e.endsWith("'"))))throw i.ethErrors.rpc.invalidParams({message:'Invalid "path" parameter. Ed25519 does not support unhardened paths.'})}function h(e){if(!(0,s.hasProperty)(e,"value")||!Array.isArray(e.value)||0===e.value.length)throw i.ethErrors.rpc.invalidParams({message:"Expected non-empty array of paths."});e.value.forEach((e=>d(e)))}r.validatePath=d,r.validateCaveatPaths=h;function f({getMnemonic:e,getUnlockPromise:t}){return async function(r){await t(!0);const n=r.params;return(await a.SLIP10Node.fromDerivationPath({curve:n.curve,derivationPath:[`bip39:${await e()}`,...n.path.slice(1).map((e=>`bip32:${e}`))]})).toJSON()}}r.getBip32EntropyBuilder=Object.freeze({targetKey:l,specificationBuilder:({methodHooks:e})=>({permissionType:n.PermissionType.RestrictedMethod,targetKey:l,allowedCaveats:[o.SnapCaveatType.PermittedDerivationPaths],methodImplementation:f(e),validator:({caveats:e})=>{if(1!==(null==e?void 0:e.length)||e[0].type!==o.SnapCaveatType.PermittedDerivationPaths)throw i.ethErrors.rpc.invalidParams({message:`Expected a single "${o.SnapCaveatType.PermittedDerivationPaths}" caveat.`})}}),methodHooks:{getMnemonic:!0,getUnlockPromise:!0}}),r.getBip32EntropyCaveatMapper=function(e){return{caveats:[{type:o.SnapCaveatType.PermittedDerivationPaths,value:e}]}},r.getBip32EntropyCaveatSpecifications={[o.SnapCaveatType.PermittedDerivationPaths]:Object.freeze({type:o.SnapCaveatType.PermittedDerivationPaths,decorator:(e,t)=>async r=>{const{params:n}=r;d(n);if(!t.value.find((e=>(0,c.isEqual)(n.path,e.path)&&e.curve===n.curve)))throw i.ethErrors.rpc.invalidParams({message:"The requested path is not permitted. Allowed paths must be specified in the snap manifest."});return await e(r)},validator:e=>h(e)})},r.getBip32EntropyImplementation=f}}},{package:"@metamask/rpc-methods"}],[1622,{"../caveats":1611,"@metamask/controllers":1458,"@metamask/key-tree":1582,"@metamask/utils":1730,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getBip44EntropyImplementation=r.getBip44EntropyCaveatSpecifications=r.getBip44EntropyCaveatMapper=r.getBip44EntropyBuilder=r.validateCaveat=r.validateParams=void 0;const n=e("@metamask/controllers"),i=e("eth-rpc-errors"),s=e("@metamask/key-tree"),a=e("@metamask/utils"),o=e("../caveats"),c="snap_getBip44Entropy";function u(e){if(!(0,a.isPlainObject)(e)||!(0,a.hasProperty)(e,"coinType"))throw i.ethErrors.rpc.invalidParams({message:"Expected a plain object containing a coin type."});if("number"!=typeof e.coinType||!Number.isInteger(e.coinType)||e.coinType<0||e.coinType>2147483647)throw i.ethErrors.rpc.invalidParams({message:'Invalid "coinType" parameter. Coin type must be a non-negative integer.'})}function l(e){if(!(0,a.hasProperty)(e,"value")||!Array.isArray(e.value)||0===e.value.length)throw i.ethErrors.rpc.invalidParams({message:"Expected non-empty array of coin types."});e.value.forEach(u)}r.validateParams=u,r.validateCaveat=l;function d({getMnemonic:e,getUnlockPromise:t}){return async function(r){await t(!0);const n=r.params;return(await s.BIP44CoinTypeNode.fromDerivationPath([`bip39:${await e()}`,"bip32:44'",`bip32:${n.coinType}'`])).toJSON()}}r.getBip44EntropyBuilder=Object.freeze({targetKey:c,specificationBuilder:({methodHooks:e})=>({permissionType:n.PermissionType.RestrictedMethod,targetKey:c,allowedCaveats:[o.SnapCaveatType.PermittedCoinTypes],methodImplementation:d(e),validator:({caveats:e})=>{if(1!==(null==e?void 0:e.length)||e[0].type!==o.SnapCaveatType.PermittedCoinTypes)throw i.ethErrors.rpc.invalidParams({message:`Expected a single "${o.SnapCaveatType.PermittedCoinTypes}" caveat.`})}}),methodHooks:{getMnemonic:!0,getUnlockPromise:!0}}),r.getBip44EntropyCaveatMapper=function(e){return{caveats:[{type:o.SnapCaveatType.PermittedCoinTypes,value:e}]}},r.getBip44EntropyCaveatSpecifications={[o.SnapCaveatType.PermittedCoinTypes]:Object.freeze({type:o.SnapCaveatType.PermittedCoinTypes,decorator:(e,t)=>async r=>{const{params:n}=r;u(n);if(!t.value.find((e=>e.coinType===n.coinType)))throw i.ethErrors.rpc.invalidParams({message:"The requested coin type is not permitted. Allowed coin types must be specified in the snap manifest."});return await e(r)},validator:e=>l(e)})},r.getBip44EntropyImplementation=d}}},{package:"@metamask/rpc-methods"}],[1623,{"@metamask/controllers":1458,"@metamask/key-tree":1582,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getBip44EntropyLegacyBuilder=void 0;const n=e("@metamask/controllers"),i=e("eth-rpc-errors"),s=e("@metamask/key-tree"),a="snap_getBip44Entropy_",o=`${a}*`;r.getBip44EntropyLegacyBuilder=Object.freeze({targetKey:o,specificationBuilder:({allowedCaveats:e=null,methodHooks:t})=>({permissionType:n.PermissionType.RestrictedMethod,targetKey:o,allowedCaveats:e,methodImplementation:u(t)}),methodHooks:{getMnemonic:!0,getUnlockPromise:!0}});const c=/^\d+$/u;function u({getMnemonic:e,getUnlockPromise:t}){return async function(r){console.warn('"snap_getBip44Entropy_*" is deprecated in favour of "snap_getBip44Entropy". This will be removed in a future release. Please refer to the documentation for more information.');const n=r.method.substr(a.length);if(!c.test(n))throw i.ethErrors.rpc.methodNotFound({message:`Invalid BIP-44 code: ${n}`});await t(!0);return(await s.BIP44CoinTypeNode.fromDerivationPath([`bip39:${await e()}`,"bip32:44'",`bip32:${Number(n)}'`])).toJSON()}}}}},{package:"@metamask/rpc-methods"}],[1624,{"./confirm":1620,"./getBip32Entropy":1621,"./getBip44Entropy":1622,"./getBip44EntropyLegacy":1623,"./invokeSnap":1625,"./manageState":1626,"./notify":1627},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.caveatMappers=r.caveatSpecifications=r.builders=r.NotificationType=r.ManageStateOperation=void 0;const n=e("./confirm"),i=e("./getBip44Entropy"),s=e("./invokeSnap"),a=e("./manageState"),o=e("./notify"),c=e("./getBip32Entropy"),u=e("./getBip44EntropyLegacy");var l=e("./manageState");Object.defineProperty(r,"ManageStateOperation",{enumerable:!0,get:function(){return l.ManageStateOperation}});var d=e("./notify");Object.defineProperty(r,"NotificationType",{enumerable:!0,get:function(){return d.NotificationType}}),r.builders={[n.confirmBuilder.targetKey]:n.confirmBuilder,[c.getBip32EntropyBuilder.targetKey]:c.getBip32EntropyBuilder,[i.getBip44EntropyBuilder.targetKey]:i.getBip44EntropyBuilder,[u.getBip44EntropyLegacyBuilder.targetKey]:u.getBip44EntropyLegacyBuilder,[s.invokeSnapBuilder.targetKey]:s.invokeSnapBuilder,[a.manageStateBuilder.targetKey]:a.manageStateBuilder,[o.notifyBuilder.targetKey]:o.notifyBuilder},r.caveatSpecifications=Object.assign(Object.assign({},c.getBip32EntropyCaveatSpecifications),i.getBip44EntropyCaveatSpecifications),r.caveatMappers={[c.getBip32EntropyBuilder.targetKey]:c.getBip32EntropyCaveatMapper,[i.getBip44EntropyBuilder.targetKey]:i.getBip44EntropyCaveatMapper}}}},{package:"@metamask/rpc-methods"}],[1625,{"@metamask/controllers":1458,"@metamask/snap-utils":1716,"@metamask/utils":1730,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.invokeSnapBuilder=void 0;const n=e("@metamask/controllers"),i=e("@metamask/utils"),s=e("eth-rpc-errors"),a=e("@metamask/snap-utils"),o=`${a.SNAP_PREFIX}*`;function c({getSnap:e,handleSnapRpcRequest:t}){return async function(r){const{params:n=[],method:o,context:c}=r,u=n[0];if(!(0,i.isObject)(u))throw s.ethErrors.rpc.invalidParams({message:"Must specify snap RPC request object as single parameter."});const l=o.substr(a.SNAP_PREFIX.length);if(!e(l))throw s.ethErrors.rpc.invalidRequest({message:`The snap "${l}" is not installed. This is a bug, please report it.`});const{origin:d}=c;return await t({snapId:l,origin:d,request:u,handler:a.HandlerType.OnRpcRequest})}}r.invokeSnapBuilder=Object.freeze({targetKey:o,specificationBuilder:({allowedCaveats:e=null,methodHooks:t})=>({permissionType:n.PermissionType.RestrictedMethod,targetKey:o,allowedCaveats:e,methodImplementation:c(t)}),methodHooks:{getSnap:!0,handleSnapRpcRequest:!0}})}}},{package:"@metamask/rpc-methods"}],[1626,{"@metamask/controllers":1458,"@metamask/utils":1730,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.STORAGE_SIZE_LIMIT=r.ManageStateOperation=r.manageStateBuilder=void 0;const n=e("@metamask/controllers"),i=e("@metamask/utils"),s=e("eth-rpc-errors"),a="snap_manageState";var o;function c({clearSnapState:e,getSnapState:t,updateSnapState:n}){return async function(a){const{params:c=[],method:u,context:{origin:l}}=a,[d,h]=c;switch(d){case o.clearState:return await e(l),null;case o.getState:return await t(l);case o.updateState:{if(!(0,i.isObject)(h))throw s.ethErrors.rpc.invalidParams({message:`Invalid ${u} "updateState" parameter: The new state must be a plain object.`,data:{receivedNewState:void 0===h?"undefined":h}});const[e,t]=(0,i.validateJsonAndGetSize)(h);if(!e)throw s.ethErrors.rpc.invalidParams({message:`Invalid ${u} "updateState" parameter: The new state must be JSON serializable.`,data:{receivedNewState:void 0===h?"undefined":h}});if(t>r.STORAGE_SIZE_LIMIT)throw s.ethErrors.rpc.invalidParams({message:`Invalid ${u} "updateState" parameter: The new state must not exceed ${r.STORAGE_SIZE_LIMIT} bytes in size.`,data:{receivedNewState:void 0===h?"undefined":h}});return await n(l,h),null}default:throw s.ethErrors.rpc.invalidParams(`Invalid ${u} operation: "${d}"`)}}}r.manageStateBuilder=Object.freeze({targetKey:a,specificationBuilder:({allowedCaveats:e=null,methodHooks:t})=>({permissionType:n.PermissionType.RestrictedMethod,targetKey:a,allowedCaveats:e,methodImplementation:c(t)}),methodHooks:{clearSnapState:!0,getSnapState:!0,updateSnapState:!0}}),function(e){e.clearState="clear",e.getState="get",e.updateState="update"}(o=r.ManageStateOperation||(r.ManageStateOperation={})),r.STORAGE_SIZE_LIMIT=104857600}}},{package:"@metamask/rpc-methods"}],[1627,{"@metamask/controllers":1458,"@metamask/utils":1730,"eth-rpc-errors":2815},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.notifyBuilder=r.NotificationType=void 0;const n=e("@metamask/controllers"),i=e("@metamask/utils"),s=e("eth-rpc-errors"),a="snap_notify";var o;!function(e){e.native="native",e.inApp="inApp"}(o=r.NotificationType||(r.NotificationType={}));function c({showNativeNotification:e,showInAppNotification:t}){return async function(r){const{params:n,context:{origin:a}}=r,c=function(e){if(!Array.isArray(e)||!(0,i.isObject)(e[0]))throw s.ethErrors.rpc.invalidParams({message:"Expected array params with single object."});const{type:t,message:r}=e[0];if(!t||"string"!=typeof t||!Object.values(o).includes(t))throw s.ethErrors.rpc.invalidParams({message:'Must specify a valid notification "type".'});if(!r||"string"!=typeof r||r.length>=50)throw s.ethErrors.rpc.invalidParams({message:'Must specify a non-empty string "message" less than 50 characters long.'});return e[0]}(n);switch(c.type){case o.native:return await e(a,c);case o.inApp:return await t(a,c);default:throw s.ethErrors.rpc.invalidParams({message:'Must specify a valid notification "type".'})}}}r.notifyBuilder=Object.freeze({targetKey:a,specificationBuilder:({allowedCaveats:e=null,methodHooks:t})=>({permissionType:n.PermissionType.RestrictedMethod,targetKey:a,allowedCaveats:e,methodImplementation:c(t)}),methodHooks:{showNativeNotification:!0,showInAppNotification:!0}})}}},{package:"@metamask/rpc-methods"}],[1628,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isEqual=r.selectHooks=void 0,r.selectHooks=function(e,t){return t?Object.keys(t).reduce(((t,r)=>{const n=r;return t[n]=e[n],t}),{}):undefined},r.isEqual=function(e,t){return e.length===t.length&&e.every(((e,r)=>e===t[r]))}}}},{package:"@metamask/rpc-methods"}],[163,{"./002":90,"./003":91,"./004":92,"./005":93,"./006":94,"./007":95,"./008":96,"./009":97,"./010":98,"./011":99,"./012":100,"./013":101,"./014":102,"./015":103,"./016":104,"./017":105,"./018":106,"./019":107,"./020":108,"./021":109,"./022":110,"./023":111,"./024":112,"./025":113,"./026":114,"./027":115,"./028":116,"./029":117,"./030":118,"./031":119,"./032":120,"./033":121,"./034":122,"./035":123,"./036":124,"./037":125,"./038":126,"./039":127,"./040":128,"./041":129,"./042":130,"./043":131,"./044":132,"./045":133,"./046":134,"./047":135,"./048":136,"./049":137,"./050":138,"./051":139,"./052":140,"./053":141,"./054":142,"./055":143,"./056":144,"./057":145,"./058":146,"./059":147,"./060":148,"./061":149,"./062":150,"./063":151,"./064":152,"./065":153,"./066":154,"./067":155,"./068":156,"./069":157,"./070":158,"./071":159,"./072":160,"./073":161},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=_e(e("./002")),i=_e(e("./003")),s=_e(e("./004")),a=_e(e("./005")),o=_e(e("./006")),c=_e(e("./007")),u=_e(e("./008")),l=_e(e("./009")),d=_e(e("./010")),h=_e(e("./011")),f=_e(e("./012")),p=_e(e("./013")),m=_e(e("./014")),g=_e(e("./015")),y=_e(e("./016")),b=_e(e("./017")),v=_e(e("./018")),w=_e(e("./019")),_=_e(e("./020")),S=_e(e("./021")),k=_e(e("./022")),E=_e(e("./023")),P=_e(e("./024")),T=_e(e("./025")),A=_e(e("./026")),O=_e(e("./027")),I=_e(e("./028")),C=_e(e("./029")),x=_e(e("./030")),N=_e(e("./031")),M=_e(e("./032")),j=_e(e("./033")),R=_e(e("./034")),B=_e(e("./035")),L=_e(e("./036")),D=_e(e("./037")),U=_e(e("./038")),$=_e(e("./039")),H=_e(e("./040")),K=_e(e("./041")),F=_e(e("./042")),q=_e(e("./043")),V=_e(e("./044")),W=_e(e("./045")),z=_e(e("./046")),G=_e(e("./047")),J=_e(e("./048")),Z=_e(e("./049")),Y=_e(e("./050")),X=_e(e("./051")),Q=_e(e("./052")),ee=_e(e("./053")),te=_e(e("./054")),re=_e(e("./055")),ne=_e(e("./056")),ie=_e(e("./057")),se=_e(e("./058")),ae=_e(e("./059")),oe=_e(e("./060")),ce=_e(e("./061")),ue=_e(e("./062")),le=_e(e("./063")),de=_e(e("./064")),he=_e(e("./065")),fe=_e(e("./066")),pe=_e(e("./067")),me=_e(e("./068")),ge=_e(e("./069")),ye=_e(e("./070")),be=_e(e("./071")),ve=_e(e("./072")),we=_e(e("./073"));function _e(e){return e&&e.__esModule?e:{default:e}}var Se=[n.default,i.default,s.default,a.default,o.default,c.default,u.default,l.default,d.default,h.default,f.default,p.default,m.default,g.default,y.default,b.default,v.default,w.default,_.default,S.default,k.default,E.default,P.default,T.default,A.default,O.default,I.default,C.default,x.default,N.default,M.default,j.default,R.default,B.default,L.default,D.default,U.default,$.default,H.default,K.default,F.default,q.default,V.default,W.default,z.default,G.default,J.default,Z.default,Y.default,X.default,Q.default,ee.default,te.default,re.default,ne.default,ie.default,se.default,ae.default,oe.default,ce.default,ue.default,le.default,de.default,he.default,fe.default,pe.default,me.default,ge.default,ye.default,be.default,ve.default,we.default];r.default=Se}}},{package:"$root$"}],[1631,{"./constants":1632,"./types":1634,"./utils":1635,"@metamask/controllers":1458,"bignumber.js":1636,ethers:2916,"lodash/cloneDeep":5558,"lodash/mapValues":5585},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_INTERVAL=void 0;const i=e("@metamask/controllers"),s=e("bignumber.js"),a=e("ethers"),o=n(e("lodash/mapValues")),c=n(e("lodash/cloneDeep")),u=e("./types"),l=e("./utils"),d=e("./constants"),{safelyExecute:h}=i.util;r.DEFAULT_INTERVAL=5e3;class f extends i.BaseController{constructor({onNetworkStateChange:e,getNonceLock:t,getNetwork:n,provider:i,confirmExternalTransaction:s,trackMetaMetricsEvent:o},c,u){super(c,u),this.defaultConfig={interval:r.DEFAULT_INTERVAL,chainId:d.CHAIN_IDS.ETHEREUM,clientId:"default",supportedChainIds:[d.CHAIN_IDS.ETHEREUM,d.CHAIN_IDS.RINKEBY]},this.defaultState={smartTransactionsState:{smartTransactions:{},userOptIn:undefined,fees:{approvalTxFees:undefined,tradeTxFees:undefined},liveness:!0}},this.getNonceLock=t,this.getNetwork=n,this.ethersProvider=new a.ethers.providers.Web3Provider(i),this.confirmExternalTransaction=s,this.trackMetaMetricsEvent=o,this.initialize(),this.initializeSmartTransactionsForChainId(),e((({provider:e})=>{const{chainId:t}=e;this.configure({chainId:t}),this.initializeSmartTransactionsForChainId(),this.checkPoll(this.state),this.ethersProvider=new a.ethers.providers.Web3Provider(i)})),this.subscribe((e=>this.checkPoll(e)))}async fetch(e,t){const{clientId:r}=this.config,n=Object.assign(Object.assign({},t),{headers:Object.assign({"Content-Type":"application/json"},r&&{"X-Client-Id":r})});return l.handleFetch(e,n)}checkPoll(e){const{smartTransactions:t}=e.smartTransactionsState,r=t[this.config.chainId],n=null==r?void 0:r.filter(l.isSmartTransactionPending);!this.timeoutHandle&&(null==n?void 0:n.length)>0?this.poll():this.timeoutHandle&&0===(null==n?void 0:n.length)&&this.stop()}initializeSmartTransactionsForChainId(){var e;if(this.config.supportedChainIds.includes(this.config.chainId)){const{smartTransactionsState:t}=this.state;this.update({smartTransactionsState:Object.assign(Object.assign({},t),{smartTransactions:Object.assign(Object.assign({},t.smartTransactions),{[this.config.chainId]:null!==(e=t.smartTransactions[this.config.chainId])&&void 0!==e?e:[]})})})}}async poll(e){const{chainId:t,supportedChainIds:r}=this.config;e&&this.configure({interval:e},!1,!1),this.timeoutHandle&&clearInterval(this.timeoutHandle),r.includes(t)&&(await h((()=>this.updateSmartTransactions())),this.timeoutHandle=setInterval((()=>{h((()=>this.updateSmartTransactions()))}),this.config.interval))}async stop(){this.timeoutHandle&&clearInterval(this.timeoutHandle),this.timeoutHandle=undefined}setOptInState(e){this.update({smartTransactionsState:Object.assign(Object.assign({},this.state.smartTransactionsState),{userOptIn:e})})}trackStxStatusChange(e,t){if(!t)return;let r=c.default(e);if(r=Object.assign(Object.assign({},c.default(t)),r),!r.swapMetaData||r.status===t.status&&t.swapMetaData)return;const n={stx_status:r.status,token_from_symbol:r.sourceTokenSymbol,token_to_symbol:r.destinationTokenSymbol,processing_time:l.getStxProcessingTime(r.time),stx_enabled:!0,current_stx_enabled:!0,stx_user_opt_in:!0};this.trackMetaMetricsEvent({event:"STX Status Updated",category:"swaps",sensitiveProperties:n})}isNewSmartTransaction(e){const{chainId:t}=this.config,{smartTransactionsState:r}=this.state,{smartTransactions:n}=r,i=n[t],s=null==i?void 0:i.findIndex((t=>t.uuid===e));return-1===s||s===undefined}updateSmartTransaction(e){const{chainId:t}=this.config,{smartTransactionsState:r}=this.state,{smartTransactions:n}=r,i=n[t],s=null==i?void 0:i.findIndex((t=>t.uuid===e.uuid)),a=this.isNewSmartTransaction(e.uuid);if(this.trackStxStatusChange(e,a?undefined:i[s]),a){const n=i.findIndex((t=>{var r,n,i;return(null===(r=t.txParams)||void 0===r?void 0:r.nonce)===(null===(n=e.txParams)||void 0===n?void 0:n.nonce)&&(null===(i=t.status)||void 0===i?void 0:i.startsWith("cancelled"))})),s=[c.default(e)],a=Object.assign(Object.assign({},e),{history:s}),o=n>-1?i.slice(0,n).concat(i.slice(n+1)).concat(a):i.concat(a);this.update({smartTransactionsState:Object.assign(Object.assign({},r),{smartTransactions:Object.assign(Object.assign({},r.smartTransactions),{[t]:o})})})}else{if((e.status===u.SmartTransactionStatuses.SUCCESS||e.status===u.SmartTransactionStatuses.REVERTED)&&!e.confirmed){const t=i[s],r=Object.assign(Object.assign({},t),e);this.confirmSmartTransaction(r)}this.update({smartTransactionsState:Object.assign(Object.assign({},r),{smartTransactions:Object.assign(Object.assign({},r.smartTransactions),{[t]:r.smartTransactions[t].map(((t,r)=>r===s?Object.assign(Object.assign({},t),e):t))})})})}}async updateSmartTransactions(){const{smartTransactions:e}=this.state.smartTransactionsState,{chainId:t}=this.config,r=(null==e?void 0:e[t]).filter(l.isSmartTransactionPending).map((e=>e.uuid));r.length>0&&this.fetchSmartTransactionsStatus(r)}async confirmSmartTransaction(e){var t,r,n;const i=null===(t=e.statusMetadata)||void 0===t?void 0:t.minedHash;try{const t=await this.ethersProvider.getTransactionReceipt(i),s=await this.ethersProvider.getTransaction(i),c=null===(r=s.maxFeePerGas)||void 0===r?void 0:r.toHexString(),u=null===(n=s.maxPriorityFeePerGas)||void 0===n?void 0:n.toHexString();if(null==t?void 0:t.blockNumber){const r=await this.ethersProvider.getBlock(null==t?void 0:t.blockNumber,!1),n=null==r?void 0:r.baseFeePerGas.toHexString(),s=o.default(t,(e=>e instanceof a.ethers.BigNumber?e.toHexString():e)),d=Object.assign(Object.assign({},e.txParams),{maxFeePerGas:c,maxPriorityFeePerGas:u}),h=Object.assign(Object.assign({},e),{id:e.uuid,status:"confirmed",hash:i,txParams:d}),f=l.snapshotFromTxMeta(h),p=l.replayHistory(h.history),m=l.generateHistoryEntry(p,f,"txStateManager: setting status to confirmed"),g=m.length>0?Object.assign(Object.assign({},h),{history:h.history.concat(m)}):h;this.confirmExternalTransaction(g,s,n),this.trackMetaMetricsEvent({event:"STX Confirmed",category:"swaps"}),this.updateSmartTransaction(Object.assign(Object.assign({},e),{confirmed:!0}))}}catch(e){this.trackMetaMetricsEvent({event:"STX Confirmation Failed",category:"swaps"}),console.error("confirm error",e)}}async fetchSmartTransactionsStatus(e){const{chainId:t}=this.config,r=new URLSearchParams({uuids:e.join(",")}),n=`${l.getAPIRequestURL(u.APIType.BATCH_STATUS,t)}?${r.toString()}`,i=await this.fetch(n);return Object.entries(i).forEach((([e,t])=>{this.updateSmartTransaction({statusMetadata:t,status:l.calculateStatus(t),cancellable:l.isSmartTransactionCancellable(t),uuid:e})})),i}async addNonceToTransaction(e){const t=await this.getNonceLock(e.from),r=t.nextNonce;return t.releaseLock(),Object.assign(Object.assign({},e),{nonce:`0x${r.toString(16)}`})}clearFees(){const e={approvalTxFees:undefined,tradeTxFees:undefined};return this.update({smartTransactionsState:Object.assign(Object.assign({},this.state.smartTransactionsState),{fees:e})}),e}async getFees(e,t){const{chainId:r}=this.config,n=[];let i;if(t){const r=await this.addNonceToTransaction(t);n.push(r),i=Object.assign(Object.assign({},e),{nonce:l.incrementNonceInHex(r.nonce)})}else i=await this.addNonceToTransaction(e);n.push(i);const s=await this.fetch(l.getAPIRequestURL(u.APIType.GET_FEES,r),{method:"POST",body:JSON.stringify({txs:n})});let a,o;return t?(a=null==s?void 0:s.txs[0],o=null==s?void 0:s.txs[1]):o=null==s?void 0:s.txs[0],this.update({smartTransactionsState:Object.assign(Object.assign({},this.state.smartTransactionsState),{fees:{approvalTxFees:a,tradeTxFees:o}})}),{approvalTxFees:a,tradeTxFees:o}}async submitSignedTransactions({txParams:e,signedTransactions:t,signedCanceledTransactions:r}){const{chainId:n}=this.config,i=await this.fetch(l.getAPIRequestURL(u.APIType.SUBMIT_TRANSACTIONS,n),{method:"POST",body:JSON.stringify({rawTxs:t,rawCancelTxs:r})}),o=Date.now(),c=this.getNetwork();let d;try{const t=await this.ethersProvider.getBalance(null==e?void 0:e.from);d=new s.BigNumber(t.toHexString()).toString(16)}catch(e){console.error("ethers error",e)}const h=await this.getNonceLock(null==e?void 0:e.from),f=a.ethers.utils.hexlify(h.nextNonce);e&&!(null==e?void 0:e.nonce)&&(e.nonce=f);const{nonceDetails:p}=h;return this.updateSmartTransaction({chainId:n,nonceDetails:p,metamaskNetworkId:c,preTxBalance:d,status:u.SmartTransactionStatuses.PENDING,time:o,txParams:e,uuid:i.uuid,cancellable:!0}),h.releaseLock(),i}async cancelSmartTransaction(e){const{chainId:t}=this.config;await this.fetch(l.getAPIRequestURL(u.APIType.CANCEL,t),{method:"POST",body:JSON.stringify({uuid:e})})}async fetchLiveness(){const{chainId:e}=this.config;let t=!1;try{const r=await this.fetch(l.getAPIRequestURL(u.APIType.LIVENESS,e));t=Boolean(r.lastBlock)}catch(e){console.log('"fetchLiveness" API call failed')}return this.update({smartTransactionsState:Object.assign(Object.assign({},this.state.smartTransactionsState),{liveness:t})}),t}async setStatusRefreshInterval(e){e!==this.config.interval&&this.configure({interval:e},!1,!1)}getTransactions({addressFrom:e,status:t}){const{smartTransactions:r}=this.state.smartTransactionsState,{chainId:n}=this.config,i=null==r?void 0:r[n];return i&&0!==i.length?i.filter((r=>{var n;return r.status===t&&(null===(n=r.txParams)||void 0===n?void 0:n.from)===e})):[]}}r.default=f}}},{package:"@metamask/smart-transactions-controller"}],[1632,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.CHAIN_IDS=r.API_BASE_URL=void 0,r.API_BASE_URL="https://transaction.metaswap.codefi.network",r.CHAIN_IDS={ETHEREUM:"0x1",RINKEBY:"0x4",BSC:"0x38"}}}},{package:"@metamask/smart-transactions-controller"}],[1633,{"./SmartTransactionsController":1631,"isomorphic-fetch":5152},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),e("isomorphic-fetch");const i=n(e("./SmartTransactionsController"));r.default=i.default}}},{package:"@metamask/smart-transactions-controller"}],[1634,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i;Object.defineProperty(r,"__esModule",{value:!0}),r.cancellationReasonToStatusMap=r.SmartTransactionStatuses=r.SmartTransactionCancellationReason=r.SmartTransactionMinedTx=r.APIType=void 0,function(e){e[e.GET_FEES=0]="GET_FEES",e[e.ESTIMATE_GAS=1]="ESTIMATE_GAS",e[e.SUBMIT_TRANSACTIONS=2]="SUBMIT_TRANSACTIONS",e[e.CANCEL=3]="CANCEL",e[e.BATCH_STATUS=4]="BATCH_STATUS",e[e.LIVENESS=5]="LIVENESS"}(r.APIType||(r.APIType={})),function(e){e.NOT_MINED="not_mined",e.SUCCESS="success",e.CANCELLED="cancelled",e.REVERTED="reverted",e.UNKNOWN="unknown"}(r.SmartTransactionMinedTx||(r.SmartTransactionMinedTx={})),function(e){e.WOULD_REVERT="would_revert",e.TOO_CHEAP="too_cheap",e.DEADLINE_MISSED="deadline_missed",e.INVALID_NONCE="invalid_nonce",e.USER_CANCELLED="user_cancelled",e.NOT_CANCELLED="not_cancelled",e.PREVIOUS_TX_CANCELLED="previous_tx_cancelled"}(n=r.SmartTransactionCancellationReason||(r.SmartTransactionCancellationReason={})),function(e){e.PENDING="pending",e.SUCCESS="success",e.REVERTED="reverted",e.UNKNOWN="unknown",e.CANCELLED="cancelled",e.CANCELLED_WOULD_REVERT="cancelled_would_revert",e.CANCELLED_TOO_CHEAP="cancelled_too_cheap",e.CANCELLED_DEADLINE_MISSED="cancelled_deadline_missed",e.CANCELLED_INVALID_NONCE="cancelled_invalid_nonce",e.CANCELLED_USER_CANCELLED="cancelled_user_cancelled",e.CANCELLED_PREVIOUS_TX_CANCELLED="cancelled_previous_tx_cancelled",e.RESOLVED="resolved"}(i=r.SmartTransactionStatuses||(r.SmartTransactionStatuses={})),r.cancellationReasonToStatusMap={[n.WOULD_REVERT]:i.CANCELLED_WOULD_REVERT,[n.TOO_CHEAP]:i.CANCELLED_TOO_CHEAP,[n.DEADLINE_MISSED]:i.CANCELLED_DEADLINE_MISSED,[n.INVALID_NONCE]:i.CANCELLED_INVALID_NONCE,[n.USER_CANCELLED]:i.CANCELLED_USER_CANCELLED,[n.PREVIOUS_TX_CANCELLED]:i.CANCELLED_PREVIOUS_TX_CANCELLED}}}},{package:"@metamask/smart-transactions-controller"}],[1635,{"./constants":1632,"./types":1634,"bignumber.js":1636,ethers:2916,"fast-json-patch":1640,lodash:5584},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.incrementNonceInHex=r.isSmartTransactionCancellable=r.handleFetch=r.mapKeysToCamel=r.getStxProcessingTime=r.snapshotFromTxMeta=r.replayHistory=r.generateHistoryEntry=r.calculateStatus=r.getAPIRequestURL=r.isSmartTransactionStatusResolved=r.isSmartTransactionPending=void 0;const i=n(e("fast-json-patch")),s=n(e("lodash")),a=e("bignumber.js"),o=e("ethers"),c=e("./types"),u=e("./constants");r.isSmartTransactionPending=function(e){return e.status===c.SmartTransactionStatuses.PENDING};r.isSmartTransactionStatusResolved=e=>"uuid_not_found"===e,r.getAPIRequestURL=function(e,t){const r=parseInt(t,16);switch(e){case c.APIType.GET_FEES:return`${u.API_BASE_URL}/networks/${r}/getFees`;case c.APIType.ESTIMATE_GAS:return`${u.API_BASE_URL}/networks/${r}/estimateGas`;case c.APIType.SUBMIT_TRANSACTIONS:return`${u.API_BASE_URL}/networks/${r}/submitTransactions`;case c.APIType.CANCEL:return`${u.API_BASE_URL}/networks/${r}/cancel`;case c.APIType.BATCH_STATUS:return`${u.API_BASE_URL}/networks/${r}/batchStatus`;case c.APIType.LIVENESS:return`${u.API_BASE_URL}/networks/${r}/health`;default:throw new Error("Invalid APIType")}};r.calculateStatus=e=>{if(r.isSmartTransactionStatusResolved(e))return c.SmartTransactionStatuses.RESOLVED;const t=[c.SmartTransactionCancellationReason.WOULD_REVERT,c.SmartTransactionCancellationReason.TOO_CHEAP,c.SmartTransactionCancellationReason.DEADLINE_MISSED,c.SmartTransactionCancellationReason.INVALID_NONCE,c.SmartTransactionCancellationReason.USER_CANCELLED,c.SmartTransactionCancellationReason.PREVIOUS_TX_CANCELLED];if((null==e?void 0:e.minedTx)===c.SmartTransactionMinedTx.NOT_MINED){if(e.cancellationReason===c.SmartTransactionCancellationReason.NOT_CANCELLED)return c.SmartTransactionStatuses.PENDING;const r=t.findIndex((t=>t===e.cancellationReason))>-1;if(e.cancellationReason&&r)return e.isSettled?c.cancellationReasonToStatusMap[e.cancellationReason]:c.SmartTransactionStatuses.PENDING}else{if((null==e?void 0:e.minedTx)===c.SmartTransactionMinedTx.SUCCESS)return c.SmartTransactionStatuses.SUCCESS;if((null==e?void 0:e.minedTx)===c.SmartTransactionMinedTx.CANCELLED)return c.SmartTransactionStatuses.CANCELLED;if((null==e?void 0:e.minedTx)===c.SmartTransactionMinedTx.REVERTED)return c.SmartTransactionStatuses.REVERTED;if((null==e?void 0:e.minedTx)===c.SmartTransactionMinedTx.UNKNOWN)return c.SmartTransactionStatuses.UNKNOWN}return c.SmartTransactionStatuses.UNKNOWN},r.generateHistoryEntry=function(e,t,r){const n=i.default.compare(e,t);return n[0]&&(r&&(n[0].note=r),n[0].timestamp=Date.now()),n},r.replayHistory=function(e){return s.default.cloneDeep(e).reduce(((e,t)=>i.default.applyPatch(e,t).newDocument))},r.snapshotFromTxMeta=function(e){const t=Object.assign({},e);return delete t.history,s.default.cloneDeep(t)};r.getStxProcessingTime=e=>e?Math.round((Date.now()-e)/1e3):undefined;r.mapKeysToCamel=e=>{if(!s.default.isObject(e))return e;const t=s.default.mapValues(e,(e=>s.default.isArray(e)?e.map(r.mapKeysToCamel):s.default.isObject(e)?r.mapKeysToCamel(e):e));return s.default.mapKeys(t,((e,t)=>s.default.camelCase(t)))},r.handleFetch=async function(e,t){const n=await fetch(e,t),i=await n.json();if(!n.ok)throw console.log("response",n),new Error(`Fetch error:${JSON.stringify(Object.assign({status:n.status},r.mapKeysToCamel(i)))}`);return i};r.isSmartTransactionCancellable=e=>e.minedTx===c.SmartTransactionMinedTx.NOT_MINED&&(!e.cancellationReason||e.cancellationReason===c.SmartTransactionCancellationReason.NOT_CANCELLED);r.incrementNonceInHex=e=>{const t=new a.BigNumber(e,16).toString(10);return o.ethers.utils.hexlify(Number(t)+1)}}}},{package:"@metamask/smart-transactions-controller"}],[1636,{},function(){with(this)return function(){"use strict";return function(e,t,r){!function(e){var r,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,i=Math.ceil,s=Math.floor,a="[BigNumber Error] ",o=a+"Number primitive has more than 15 significant digits: ",c=1e14,u=14,l=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],h=1e7,f=1e9;function p(e){var t=0|e;return e>0||e===t?t:t-1}function m(e){for(var t,r,n=1,i=e.length,s=e[0]+"";n<i;){for(t=e[n++]+"",r=u-t.length;r--;t="0"+t);s+=t}for(i=s.length;48===s.charCodeAt(--i););return s.slice(0,i+1||1)}function g(e,t){var r,n,i=e.c,s=t.c,a=e.s,o=t.s,c=e.e,u=t.e;if(!a||!o)return null;if(r=i&&!i[0],n=s&&!s[0],r||n)return r?n?0:-o:a;if(a!=o)return a;if(r=a<0,n=c==u,!i||!s)return n?0:!i^r?1:-1;if(!n)return c>u^r?1:-1;for(o=(c=i.length)<(u=s.length)?c:u,a=0;a<o;a++)if(i[a]!=s[a])return i[a]>s[a]^r?1:-1;return c==u?0:c>u^r?1:-1}function y(e,t,r,n){if(e<t||e>r||e!==s(e))throw Error(a+(n||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function b(e){var t=e.c.length-1;return p(e.e/u)==t&&e.c[t]%2!=0}function v(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function w(e,t,r){var n,i;if(t<0){for(i=r+".";++t;i+=r);e=i+e}else if(++t>(n=e.length)){for(i=r,t-=n;--t;i+=r);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}r=function e(t){var r,_,S,k,E,P,T,A,O,I,C=F.prototype={constructor:F,toString:null,valueOf:null},x=new F(1),N=20,M=4,j=-7,R=21,B=-1e7,L=1e7,D=!1,U=1,$=0,H={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},K="0123456789abcdefghijklmnopqrstuvwxyz";function F(e,t){var r,i,a,c,d,h,f,p,m=this;if(!(m instanceof F))return new F(e,t);if(null==t){if(e&&!0===e._isBigNumber)return m.s=e.s,void(!e.c||e.e>L?m.c=m.e=null:e.e<B?m.c=[m.e=0]:(m.e=e.e,m.c=e.c.slice()));if((h="number"==typeof e)&&0*e==0){if(m.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>L?m.c=m.e=null:(m.e=c,m.c=[e]))}p=String(e)}else{if(!n.test(p=String(e)))return S(m,p,h);m.s=45==p.charCodeAt(0)?(p=p.slice(1),-1):1}(c=p.indexOf("."))>-1&&(p=p.replace(".","")),(d=p.search(/e/i))>0?(c<0&&(c=d),c+=+p.slice(d+1),p=p.substring(0,d)):c<0&&(c=p.length)}else{if(y(t,2,K.length,"Base"),10==t)return z(m=new F(e),N+m.e+1,M);if(p=String(e),h="number"==typeof e){if(0*e!=0)return S(m,p,h,t);if(m.s=1/e<0?(p=p.slice(1),-1):1,F.DEBUG&&p.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else m.s=45===p.charCodeAt(0)?(p=p.slice(1),-1):1;for(r=K.slice(0,t),c=d=0,f=p.length;d<f;d++)if(r.indexOf(i=p.charAt(d))<0){if("."==i){if(d>c){c=f;continue}}else if(!a&&(p==p.toUpperCase()&&(p=p.toLowerCase())||p==p.toLowerCase()&&(p=p.toUpperCase()))){a=!0,d=-1,c=0;continue}return S(m,String(e),h,t)}h=!1,(c=(p=_(p,t,10,m.s)).indexOf("."))>-1?p=p.replace(".",""):c=p.length}for(d=0;48===p.charCodeAt(d);d++);for(f=p.length;48===p.charCodeAt(--f););if(p=p.slice(d,++f)){if(f-=d,h&&F.DEBUG&&f>15&&(e>l||e!==s(e)))throw Error(o+m.s*e);if((c=c-d-1)>L)m.c=m.e=null;else if(c<B)m.c=[m.e=0];else{if(m.e=c,m.c=[],d=(c+1)%u,c<0&&(d+=u),d<f){for(d&&m.c.push(+p.slice(0,d)),f-=u;d<f;)m.c.push(+p.slice(d,d+=u));d=u-(p=p.slice(d)).length}else d-=f;for(;d--;p+="0");m.c.push(+p)}}else m.c=[m.e=0]}function q(e,t,r,n){var i,s,a,o,c;if(null==r?r=M:y(r,0,8),!e.c)return e.toString();if(i=e.c[0],a=e.e,null==t)c=m(e.c),c=1==n||2==n&&(a<=j||a>=R)?v(c,a):w(c,a,"0");else if(s=(e=z(new F(e),t,r)).e,o=(c=m(e.c)).length,1==n||2==n&&(t<=s||s<=j)){for(;o<t;c+="0",o++);c=v(c,s)}else if(t-=a,c=w(c,s,"0"),s+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=s-o)>0)for(s+1==o&&(c+=".");t--;c+="0");return e.s<0&&i?"-"+c:c}function V(e,t){for(var r,n=1,i=new F(e[0]);n<e.length;n++){if(!(r=new F(e[n])).s){i=r;break}t.call(i,r)&&(i=r)}return i}function W(e,t,r){for(var n=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,n++);return(r=n+r*u-1)>L?e.c=e.e=null:r<B?e.c=[e.e=0]:(e.e=r,e.c=t),e}function z(e,t,r,n){var a,o,l,h,f,p,m,g=e.c,y=d;if(g){e:{for(a=1,h=g[0];h>=10;h/=10,a++);if((o=t-a)<0)o+=u,l=t,m=(f=g[p=0])/y[a-l-1]%10|0;else if((p=i((o+1)/u))>=g.length){if(!n)break e;for(;g.length<=p;g.push(0));f=m=0,a=1,l=(o%=u)-u+1}else{for(f=h=g[p],a=1;h>=10;h/=10,a++);m=(l=(o%=u)-u+a)<0?0:f/y[a-l-1]%10|0}if(n=n||t<0||null!=g[p+1]||(l<0?f:f%y[a-l-1]),n=r<4?(m||n)&&(0==r||r==(e.s<0?3:2)):m>5||5==m&&(4==r||n||6==r&&(o>0?l>0?f/y[a-l]:0:g[p-1])%10&1||r==(e.s<0?8:7)),t<1||!g[0])return g.length=0,n?(t-=e.e+1,g[0]=y[(u-t%u)%u],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=p,h=1,p--):(g.length=p+1,h=y[u-o],g[p]=l>0?s(f/y[a-l]%y[l])*h:0),n)for(;;){if(0==p){for(o=1,l=g[0];l>=10;l/=10,o++);for(l=g[0]+=h,h=1;l>=10;l/=10,h++);o!=h&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[p]+=h,g[p]!=c)break;g[p--]=0,h=1}for(o=g.length;0===g[--o];g.pop());}e.e>L?e.c=e.e=null:e.e<B&&(e.c=[e.e=0])}return e}function G(e){var t,r=e.e;return null===r?e.toString():(t=m(e.c),t=r<=j||r>=R?v(t,r):w(t,r,"0"),e.s<0?"-"+t:t)}return F.clone=e,F.ROUND_UP=0,F.ROUND_DOWN=1,F.ROUND_CEIL=2,F.ROUND_FLOOR=3,F.ROUND_HALF_UP=4,F.ROUND_HALF_DOWN=5,F.ROUND_HALF_EVEN=6,F.ROUND_HALF_CEIL=7,F.ROUND_HALF_FLOOR=8,F.EUCLID=9,F.config=F.set=function(e){var t,r;if(null!=e){if("object"!=typeof e)throw Error(a+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(y(r=e[t],0,f,t),N=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(y(r=e[t],0,8,t),M=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(y(r[0],-f,0,t),y(r[1],0,f,t),j=r[0],R=r[1]):(y(r,-f,f,t),j=-(R=r<0?-r:r))),e.hasOwnProperty(t="RANGE"))if((r=e[t])&&r.pop)y(r[0],-f,-1,t),y(r[1],1,f,t),B=r[0],L=r[1];else{if(y(r,-f,f,t),!r)throw Error(a+t+" cannot be zero: "+r);B=-(L=r<0?-r:r)}if(e.hasOwnProperty(t="CRYPTO")){if((r=e[t])!==!!r)throw Error(a+t+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw D=!r,Error(a+"crypto unavailable");D=r}else D=r}if(e.hasOwnProperty(t="MODULO_MODE")&&(y(r=e[t],0,9,t),U=r),e.hasOwnProperty(t="POW_PRECISION")&&(y(r=e[t],0,f,t),$=r),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(r=e[t]))throw Error(a+t+" not an object: "+r);H=r}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(a+t+" invalid: "+r);K=r}}return{DECIMAL_PLACES:N,ROUNDING_MODE:M,EXPONENTIAL_AT:[j,R],RANGE:[B,L],CRYPTO:D,MODULO_MODE:U,POW_PRECISION:$,FORMAT:H,ALPHABET:K}},F.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!F.DEBUG)return!0;var t,r,n=e.c,i=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(n)){if((1===o||-1===o)&&i>=-f&&i<=f&&i===s(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break e}if((t=(i+1)%u)<1&&(t+=u),String(n[0]).length==t){for(t=0;t<n.length;t++)if((r=n[t])<0||r>=c||r!==s(r))break e;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(a+"Invalid BigNumber: "+e)},F.maximum=F.max=function(){return V(arguments,C.lt)},F.minimum=F.min=function(){return V(arguments,C.gt)},F.random=(k=9007199254740992,E=Math.random()*k&2097151?function(){return s(Math.random()*k)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,r,n,o,c,l=0,h=[],p=new F(x);if(null==e?e=N:y(e,0,f),o=i(e/u),D)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));l<o;)(c=131072*t[l]+(t[l+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[l]=r[0],t[l+1]=r[1]):(h.push(c%1e14),l+=2);l=o/2}else{if(!crypto.randomBytes)throw D=!1,Error(a+"crypto unavailable");for(t=crypto.randomBytes(o*=7);l<o;)(c=281474976710656*(31&t[l])+1099511627776*t[l+1]+4294967296*t[l+2]+16777216*t[l+3]+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6])>=9e15?crypto.randomBytes(7).copy(t,l):(h.push(c%1e14),l+=7);l=o/7}if(!D)for(;l<o;)(c=E())<9e15&&(h[l++]=c%1e14);for(o=h[--l],e%=u,o&&e&&(c=d[u-e],h[l]=s(o/c)*c);0===h[l];h.pop(),l--);if(l<0)h=[n=0];else{for(n=-1;0===h[0];h.splice(0,1),n-=u);for(l=1,c=h[0];c>=10;c/=10,l++);l<u&&(n-=u-l)}return p.e=n,p.c=h,p}),F.sum=function(){for(var e=1,t=arguments,r=new F(t[0]);e<t.length;)r=r.plus(t[e++]);return r},_=function(){var e="0123456789";function t(e,t,r,n){for(var i,s,a=[0],o=0,c=e.length;o<c;){for(s=a.length;s--;a[s]*=t);for(a[0]+=n.indexOf(e.charAt(o++)),i=0;i<a.length;i++)a[i]>r-1&&(null==a[i+1]&&(a[i+1]=0),a[i+1]+=a[i]/r|0,a[i]%=r)}return a.reverse()}return function(n,i,s,a,o){var c,u,l,d,h,f,p,g,y=n.indexOf("."),b=N,v=M;for(y>=0&&(d=$,$=0,n=n.replace(".",""),f=(g=new F(i)).pow(n.length-y),$=d,g.c=t(w(m(f.c),f.e,"0"),10,s,e),g.e=g.c.length),l=d=(p=t(n,i,s,o?(c=K,e):(c=e,K))).length;0==p[--d];p.pop());if(!p[0])return c.charAt(0);if(y<0?--l:(f.c=p,f.e=l,f.s=a,p=(f=r(f,g,b,v,s)).c,h=f.r,l=f.e),y=p[u=l+b+1],d=s/2,h=h||u<0||null!=p[u+1],h=v<4?(null!=y||h)&&(0==v||v==(f.s<0?3:2)):y>d||y==d&&(4==v||h||6==v&&1&p[u-1]||v==(f.s<0?8:7)),u<1||!p[0])n=h?w(c.charAt(1),-b,c.charAt(0)):c.charAt(0);else{if(p.length=u,h)for(--s;++p[--u]>s;)p[u]=0,u||(++l,p=[1].concat(p));for(d=p.length;!p[--d];);for(y=0,n="";y<=d;n+=c.charAt(p[y++]));n=w(n,l,c.charAt(0))}return n}}(),r=function(){function e(e,t,r){var n,i,s,a,o=0,c=e.length,u=t%h,l=t/h|0;for(e=e.slice();c--;)o=((i=u*(s=e[c]%h)+(n=l*s+(a=e[c]/h|0)*u)%h*h+o)/r|0)+(n/h|0)+l*a,e[c]=i%r;return o&&(e=[o].concat(e)),e}function t(e,t,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,i,a,o,l){var d,h,f,m,g,y,b,v,w,_,S,k,E,P,T,A,O,I=n.s==i.s?1:-1,C=n.c,x=i.c;if(!(C&&C[0]&&x&&x[0]))return new F(n.s&&i.s&&(C?!x||C[0]!=x[0]:x)?C&&0==C[0]||!x?0*I:I/0:NaN);for(w=(v=new F(I)).c=[],I=a+(h=n.e-i.e)+1,l||(l=c,h=p(n.e/u)-p(i.e/u),I=I/u|0),f=0;x[f]==(C[f]||0);f++);if(x[f]>(C[f]||0)&&h--,I<0)w.push(1),m=!0;else{for(P=C.length,A=x.length,f=0,I+=2,(g=s(l/(x[0]+1)))>1&&(x=e(x,g,l),C=e(C,g,l),A=x.length,P=C.length),E=A,S=(_=C.slice(0,A)).length;S<A;_[S++]=0);O=x.slice(),O=[0].concat(O),T=x[0],x[1]>=l/2&&T++;do{if(g=0,(d=t(x,_,A,S))<0){if(k=_[0],A!=S&&(k=k*l+(_[1]||0)),(g=s(k/T))>1)for(g>=l&&(g=l-1),b=(y=e(x,g,l)).length,S=_.length;1==t(y,_,b,S);)g--,r(y,A<b?O:x,b,l),b=y.length,d=1;else 0==g&&(d=g=1),b=(y=x.slice()).length;if(b<S&&(y=[0].concat(y)),r(_,y,S,l),S=_.length,-1==d)for(;t(x,_,A,S)<1;)g++,r(_,A<S?O:x,S,l),S=_.length}else 0===d&&(g++,_=[0]);w[f++]=g,_[0]?_[S++]=C[E]||0:(_=[C[E]],S=1)}while((E++<P||null!=_[0])&&I--);m=null!=_[0],w[0]||w.splice(0,1)}if(l==c){for(f=1,I=w[0];I>=10;I/=10,f++);z(v,a+(v.e=f+h*u-1)+1,o,m)}else v.e=h,v.r=+m;return v}}(),P=/^(-?)0([xbo])(?=\w[\w.]*$)/i,T=/^([^.]+)\.$/,A=/^\.([^.]+)$/,O=/^-?(Infinity|NaN)$/,I=/^\s*\+(?=[\w.])|^\s+|\s+$/g,S=function(e,t,r,n){var i,s=r?t:t.replace(I,"");if(O.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!r&&(s=s.replace(P,(function(e,t,r){return i="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=i?e:t})),n&&(i=n,s=s.replace(T,"$1").replace(A,"0.$1")),t!=s))return new F(s,i);if(F.DEBUG)throw Error(a+"Not a"+(n?" base "+n:"")+" number: "+t);e.s=null}e.c=e.e=null},C.absoluteValue=C.abs=function(){var e=new F(this);return e.s<0&&(e.s=1),e},C.comparedTo=function(e,t){return g(this,new F(e,t))},C.decimalPlaces=C.dp=function(e,t){var r,n,i,s=this;if(null!=e)return y(e,0,f),null==t?t=M:y(t,0,8),z(new F(s),e+s.e+1,t);if(!(r=s.c))return null;if(n=((i=r.length-1)-p(this.e/u))*u,i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},C.dividedBy=C.div=function(e,t){return r(this,new F(e,t),N,M)},C.dividedToIntegerBy=C.idiv=function(e,t){return r(this,new F(e,t),0,1)},C.exponentiatedBy=C.pow=function(e,t){var r,n,o,c,l,d,h,f,p=this;if((e=new F(e)).c&&!e.isInteger())throw Error(a+"Exponent not an integer: "+G(e));if(null!=t&&(t=new F(t)),l=e.e>14,!p.c||!p.c[0]||1==p.c[0]&&!p.e&&1==p.c.length||!e.c||!e.c[0])return f=new F(Math.pow(+G(p),l?2-b(e):+G(e))),t?f.mod(t):f;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new F(NaN);(n=!d&&p.isInteger()&&t.isInteger())&&(p=p.mod(t))}else{if(e.e>9&&(p.e>0||p.e<-1||(0==p.e?p.c[0]>1||l&&p.c[1]>=24e7:p.c[0]<8e13||l&&p.c[0]<=9999975e7)))return c=p.s<0&&b(e)?-0:0,p.e>-1&&(c=1/c),new F(d?1/c:c);$&&(c=i($/u+2))}for(l?(r=new F(.5),d&&(e.s=1),h=b(e)):h=(o=Math.abs(+G(e)))%2,f=new F(x);;){if(h){if(!(f=f.times(p)).c)break;c?f.c.length>c&&(f.c.length=c):n&&(f=f.mod(t))}if(o){if(0===(o=s(o/2)))break;h=o%2}else if(z(e=e.times(r),e.e+1,1),e.e>14)h=b(e);else{if(0===(o=+G(e)))break;h=o%2}p=p.times(p),c?p.c&&p.c.length>c&&(p.c.length=c):n&&(p=p.mod(t))}return n?f:(d&&(f=x.div(f)),t?f.mod(t):c?z(f,$,M,undefined):f)},C.integerValue=function(e){var t=new F(this);return null==e?e=M:y(e,0,8),z(t,t.e+1,e)},C.isEqualTo=C.eq=function(e,t){return 0===g(this,new F(e,t))},C.isFinite=function(){return!!this.c},C.isGreaterThan=C.gt=function(e,t){return g(this,new F(e,t))>0},C.isGreaterThanOrEqualTo=C.gte=function(e,t){return 1===(t=g(this,new F(e,t)))||0===t},C.isInteger=function(){return!!this.c&&p(this.e/u)>this.c.length-2},C.isLessThan=C.lt=function(e,t){return g(this,new F(e,t))<0},C.isLessThanOrEqualTo=C.lte=function(e,t){return-1===(t=g(this,new F(e,t)))||0===t},C.isNaN=function(){return!this.s},C.isNegative=function(){return this.s<0},C.isPositive=function(){return this.s>0},C.isZero=function(){return!!this.c&&0==this.c[0]},C.minus=function(e,t){var r,n,i,s,a=this,o=a.s;if(t=(e=new F(e,t)).s,!o||!t)return new F(NaN);if(o!=t)return e.s=-t,a.plus(e);var l=a.e/u,d=e.e/u,h=a.c,f=e.c;if(!l||!d){if(!h||!f)return h?(e.s=-t,e):new F(f?a:NaN);if(!h[0]||!f[0])return f[0]?(e.s=-t,e):new F(h[0]?a:3==M?-0:0)}if(l=p(l),d=p(d),h=h.slice(),o=l-d){for((s=o<0)?(o=-o,i=h):(d=l,i=f),i.reverse(),t=o;t--;i.push(0));i.reverse()}else for(n=(s=(o=h.length)<(t=f.length))?o:t,o=t=0;t<n;t++)if(h[t]!=f[t]){s=h[t]<f[t];break}if(s&&(i=h,h=f,f=i,e.s=-e.s),(t=(n=f.length)-(r=h.length))>0)for(;t--;h[r++]=0);for(t=c-1;n>o;){if(h[--n]<f[n]){for(r=n;r&&!h[--r];h[r]=t);--h[r],h[n]+=c}h[n]-=f[n]}for(;0==h[0];h.splice(0,1),--d);return h[0]?W(e,h,d):(e.s=3==M?-1:1,e.c=[e.e=0],e)},C.modulo=C.mod=function(e,t){var n,i,s=this;return e=new F(e,t),!s.c||!e.s||e.c&&!e.c[0]?new F(NaN):!e.c||s.c&&!s.c[0]?new F(s):(9==U?(i=e.s,e.s=1,n=r(s,e,0,3),e.s=i,n.s*=i):n=r(s,e,0,U),(e=s.minus(n.times(e))).c[0]||1!=U||(e.s=s.s),e)},C.multipliedBy=C.times=function(e,t){var r,n,i,s,a,o,l,d,f,m,g,y,b,v,w,_=this,S=_.c,k=(e=new F(e,t)).c;if(!(S&&k&&S[0]&&k[0]))return!_.s||!e.s||S&&!S[0]&&!k||k&&!k[0]&&!S?e.c=e.e=e.s=null:(e.s*=_.s,S&&k?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=p(_.e/u)+p(e.e/u),e.s*=_.s,(l=S.length)<(m=k.length)&&(b=S,S=k,k=b,i=l,l=m,m=i),i=l+m,b=[];i--;b.push(0));for(v=c,w=h,i=m;--i>=0;){for(r=0,g=k[i]%w,y=k[i]/w|0,s=i+(a=l);s>i;)r=((d=g*(d=S[--a]%w)+(o=y*d+(f=S[a]/w|0)*g)%w*w+b[s]+r)/v|0)+(o/w|0)+y*f,b[s--]=d%v;b[s]=r}return r?++n:b.splice(0,1),W(e,b,n)},C.negated=function(){var e=new F(this);return e.s=-e.s||null,e},C.plus=function(e,t){var r,n=this,i=n.s;if(t=(e=new F(e,t)).s,!i||!t)return new F(NaN);if(i!=t)return e.s=-t,n.minus(e);var s=n.e/u,a=e.e/u,o=n.c,l=e.c;if(!s||!a){if(!o||!l)return new F(i/0);if(!o[0]||!l[0])return l[0]?e:new F(o[0]?n:0*i)}if(s=p(s),a=p(a),o=o.slice(),i=s-a){for(i>0?(a=s,r=l):(i=-i,r=o),r.reverse();i--;r.push(0));r.reverse()}for((i=o.length)-(t=l.length)<0&&(r=l,l=o,o=r,t=i),i=0;t;)i=(o[--t]=o[t]+l[t]+i)/c|0,o[t]=c===o[t]?0:o[t]%c;return i&&(o=[i].concat(o),++a),W(e,o,a)},C.precision=C.sd=function(e,t){var r,n,i,s=this;if(null!=e&&e!==!!e)return y(e,1,f),null==t?t=M:y(t,0,8),z(new F(s),e,t);if(!(r=s.c))return null;if(n=(i=r.length-1)*u+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return e&&s.e+1>n&&(n=s.e+1),n},C.shiftedBy=function(e){return y(e,-9007199254740991,l),this.times("1e"+e)},C.squareRoot=C.sqrt=function(){var e,t,n,i,s,a=this,o=a.c,c=a.s,u=a.e,l=N+4,d=new F("0.5");if(1!==c||!o||!o[0])return new F(!c||c<0&&(!o||o[0])?NaN:o?a:1/0);if(0==(c=Math.sqrt(+G(a)))||c==1/0?(((t=m(o)).length+u)%2==0&&(t+="0"),c=Math.sqrt(+t),u=p((u+1)/2)-(u<0||u%2),n=new F(t=c==1/0?"5e"+u:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+u)):n=new F(c+""),n.c[0])for((c=(u=n.e)+l)<3&&(c=0);;)if(s=n,n=d.times(s.plus(r(a,s,l,1))),m(s.c).slice(0,c)===(t=m(n.c)).slice(0,c)){if(n.e<u&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(z(n,n.e+N+2,1),e=!n.times(n).eq(a));break}if(!i&&(z(s,s.e+N+2,0),s.times(s).eq(a))){n=s;break}l+=4,c+=4,i=1}return z(n,n.e+N+1,M,e)},C.toExponential=function(e,t){return null!=e&&(y(e,0,f),e++),q(this,e,t,1)},C.toFixed=function(e,t){return null!=e&&(y(e,0,f),e=e+this.e+1),q(this,e,t)},C.toFormat=function(e,t,r){var n,i=this;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=H;else if("object"!=typeof r)throw Error(a+"Argument not an object: "+r);if(n=i.toFixed(e,t),i.c){var s,o=n.split("."),c=+r.groupSize,u=+r.secondaryGroupSize,l=r.groupSeparator||"",d=o[0],h=o[1],f=i.s<0,p=f?d.slice(1):d,m=p.length;if(u&&(s=c,c=u,u=s,m-=s),c>0&&m>0){for(s=m%c||c,d=p.substr(0,s);s<m;s+=c)d+=l+p.substr(s,c);u>0&&(d+=l+p.slice(s)),f&&(d="-"+d)}n=h?d+(r.decimalSeparator||"")+((u=+r.fractionGroupSize)?h.replace(new RegExp("\\d{"+u+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):h):d}return(r.prefix||"")+n+(r.suffix||"")},C.toFraction=function(e){var t,n,i,s,o,c,l,h,f,p,g,y,b=this,v=b.c;if(null!=e&&(!(l=new F(e)).isInteger()&&(l.c||1!==l.s)||l.lt(x)))throw Error(a+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+G(l));if(!v)return new F(b);for(t=new F(x),f=n=new F(x),i=h=new F(x),y=m(v),o=t.e=y.length-b.e-1,t.c[0]=d[(c=o%u)<0?u+c:c],e=!e||l.comparedTo(t)>0?o>0?t:f:l,c=L,L=1/0,l=new F(y),h.c[0]=0;p=r(l,t,0,1),1!=(s=n.plus(p.times(i))).comparedTo(e);)n=i,i=s,f=h.plus(p.times(s=f)),h=s,t=l.minus(p.times(s=t)),l=s;return s=r(e.minus(n),i,0,1),h=h.plus(s.times(f)),n=n.plus(s.times(i)),h.s=f.s=b.s,g=r(f,i,o*=2,M).minus(b).abs().comparedTo(r(h,n,o,M).minus(b).abs())<1?[f,i]:[h,n],L=c,g},C.toNumber=function(){return+G(this)},C.toPrecision=function(e,t){return null!=e&&y(e,1,f),q(this,e,t,2)},C.toString=function(e){var t,r=this,n=r.s,i=r.e;return null===i?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(null==e?t=i<=j||i>=R?v(m(r.c),i):w(m(r.c),i,"0"):10===e?t=w(m((r=z(new F(r),N+i+1,M)).c),r.e,"0"):(y(e,2,K.length,"Base"),t=_(w(m(r.c),i,"0"),10,e,n,!0)),n<0&&r.c[0]&&(t="-"+t)),t},C.valueOf=C.toJSON=function(){return G(this)},C._isBigNumber=!0,null!=t&&F.set(t),F}(),r.default=r.BigNumber=r,"function"==typeof define&&define.amd?define((function(){return r})):void 0!==t&&t.exports?t.exports=r:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=r)}(this)}}},{package:"@metamask/smart-transactions-controller>bignumber.js"}],[1637,{"./helpers.js":1639},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./helpers.js");r.JsonPatchError=n.PatchError,r.deepClone=n._deepClone;var i={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var i=a(r,this.path);i&&(i=n._deepClone(i));var s=o(r,{op:"remove",path:this.from}).removed;return o(r,{op:"add",path:this.path,value:s}),{newDocument:r,removed:i}},copy:function(e,t,r){var i=a(r,this.from);return o(r,{op:"add",path:this.path,value:n._deepClone(i)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:d(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},s={add:function(e,t,r){return n.isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:i.move,copy:i.copy,test:i.test,_get:i._get};function a(e,t){if(""==t)return e;var r={op:"_get",path:t};return o(e,r),r.value}function o(e,t,o,c,l,h){if(void 0===o&&(o=!1),void 0===c&&(c=!0),void 0===l&&(l=!0),void 0===h&&(h=0),o&&("function"==typeof o?o(t,0,e,t.path):u(t,0)),""===t.path){var f={newDocument:e};if("add"===t.op)return f.newDocument=t.value,f;if("replace"===t.op)return f.newDocument=t.value,f.removed=e,f;if("move"===t.op||"copy"===t.op)return f.newDocument=a(e,t.from),"move"===t.op&&(f.removed=e),f;if("test"===t.op){if(f.test=d(e,t.value),!1===f.test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,t,e);return f.newDocument=e,f}if("remove"===t.op)return f.removed=e,f.newDocument=null,f;if("_get"===t.op)return t.value=e,f;if(o)throw new r.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",h,t,e);return f}c||(e=n._deepClone(e));var p=(t.path||"").split("/"),m=e,g=1,y=p.length,b=undefined,v=void 0,w=void 0;for(w="function"==typeof o?o:u;;){if((v=p[g])&&-1!=v.indexOf("~")&&(v=n.unescapePathComponent(v)),l&&"__proto__"==v)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(o&&b===undefined&&(m[v]===undefined?b=p.slice(0,g).join("/"):g==y-1&&(b=t.path),b!==undefined&&w(t,0,e,b)),g++,Array.isArray(m)){if("-"===v)v=m.length;else{if(o&&!n.isInteger(v))throw new r.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",h,t,e);n.isInteger(v)&&(v=~~v)}if(g>=y){if(o&&"add"===t.op&&v>m.length)throw new r.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",h,t,e);if(!1===(f=s[t.op].call(t,m,v,e)).test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,t,e);return f}}else if(g>=y){if(!1===(f=i[t.op].call(t,m,v,e)).test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,t,e);return f}if(m=m[v],o&&g<y&&(!m||"object"!=typeof m))throw new r.JsonPatchError("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",h,t,e)}}function c(e,t,i,s,a){if(void 0===s&&(s=!0),void 0===a&&(a=!0),i&&!Array.isArray(t))throw new r.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");s||(e=n._deepClone(e));for(var c=new Array(t.length),u=0,l=t.length;u<l;u++)c[u]=o(e,t[u],i,!0,a,u),e=c[u].newDocument;return c.newDocument=e,c}function u(e,t,s,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new r.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,s);if(!i[e.op])throw new r.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,s);if("string"!=typeof e.path)throw new r.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,s);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new r.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,s);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new r.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,s);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&e.value===undefined)throw new r.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,s);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&n.hasUndefined(e.value))throw new r.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,s);if(s)if("add"==e.op){var o=e.path.split("/").length,c=a.split("/").length;if(o!==c+1&&o!==c)throw new r.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,s)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new r.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,s)}else if("move"===e.op||"copy"===e.op){var u=l([{op:"_get",path:e.from,value:undefined}],s);if(u&&"OPERATION_PATH_UNRESOLVABLE"===u.name)throw new r.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,s)}}function l(e,t,i){try{if(!Array.isArray(e))throw new r.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)c(n._deepClone(t),n._deepClone(e),i||!0);else{i=i||u;for(var s=0;s<e.length;s++)i(e[s],s,t,undefined)}}catch(e){if(e instanceof r.JsonPatchError)return e;throw e}}function d(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,n,i,s=Array.isArray(e),a=Array.isArray(t);if(s&&a){if((n=e.length)!=t.length)return!1;for(r=n;0!=r--;)if(!d(e[r],t[r]))return!1;return!0}if(s!=a)return!1;var o=Object.keys(e);if((n=o.length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=n;0!=r--;)if(!d(e[i=o[r]],t[i]))return!1;return!0}return e!=e&&t!=t}r.getValueByPointer=a,r.applyOperation=o,r.applyPatch=c,r.applyReducer=function(e,t,n){var i=o(e,t);if(!1===i.test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument},r.validator=u,r.validate=l,r._areEquals=d}}},{package:"@metamask/smart-transactions-controller>fast-json-patch"}],[1638,{"./core.js":1637,"./helpers.js":1639},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var n=e("./helpers.js"),i=e("./core.js"),s=new WeakMap,a=function(e){this.observers=new Map,this.obj=e},o=function(e,t){this.callback=e,this.observer=t};function c(e,t){void 0===t&&(t=!1);var r=s.get(e.object);u(r.value,e.object,e.patches,"",t),e.patches.length&&i.applyPatch(r.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function u(e,t,r,i,s){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=n._objectKeys(t),o=n._objectKeys(e),c=!1,l=o.length-1;l>=0;l--){var d=e[f=o[l]];if(!n.hasOwnProperty(t,f)||t[f]===undefined&&d!==undefined&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(s&&r.push({op:"test",path:i+"/"+n.escapePathComponent(f),value:n._deepClone(d)}),r.push({op:"remove",path:i+"/"+n.escapePathComponent(f)}),c=!0):(s&&r.push({op:"test",path:i,value:e}),r.push({op:"replace",path:i,value:t}),!0);else{var h=t[f];"object"==typeof d&&null!=d&&"object"==typeof h&&null!=h&&Array.isArray(d)===Array.isArray(h)?u(d,h,r,i+"/"+n.escapePathComponent(f),s):d!==h&&(!0,s&&r.push({op:"test",path:i+"/"+n.escapePathComponent(f),value:n._deepClone(d)}),r.push({op:"replace",path:i+"/"+n.escapePathComponent(f),value:n._deepClone(h)}))}}if(c||a.length!=o.length)for(l=0;l<a.length;l++){var f=a[l];n.hasOwnProperty(e,f)||t[f]===undefined||r.push({op:"add",path:i+"/"+n.escapePathComponent(f),value:n._deepClone(t[f])})}}}r.unobserve=function(e,t){t.unobserve()},r.observe=function(e,t){var r,i=function(e){return s.get(e)}(e);if(i){var u=function(e,t){return e.observers.get(t)}(i,t);r=u&&u.observer}else i=new a(e),s.set(e,i);if(r)return r;if(r={},i.value=n._deepClone(e),t){r.callback=t,r.next=null;var l=function(){c(r)},d=function(){clearTimeout(r.next),r.next=setTimeout(l)};"undefined"!=typeof window&&(window.addEventListener("mouseup",d),window.addEventListener("keyup",d),window.addEventListener("mousedown",d),window.addEventListener("keydown",d),window.addEventListener("change",d))}return r.patches=[],r.object=e,r.unobserve=function(){c(r),clearTimeout(r.next),function(e,t){e.observers.delete(t.callback)}(i,r),"undefined"!=typeof window&&(window.removeEventListener("mouseup",d),window.removeEventListener("keyup",d),window.removeEventListener("mousedown",d),window.removeEventListener("keydown",d),window.removeEventListener("change",d))},i.observers.set(t,new o(t,r)),r},r.generate=c,r.compare=function(e,t,r){void 0===r&&(r=!1);var n=[];return u(e,t,n,"",r),n}}}},{package:"@metamask/smart-transactions-controller>fast-json-patch"}],[1639,{},function(){with(this)return function(){"use strict";return function(e,t,r){
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var n,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var s=Object.prototype.hasOwnProperty;function a(e,t){return s.call(e,t)}function o(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);t=[];for(var n in e)a(e,n)&&t.push(n);return t}function c(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function u(e,t){var r;for(var n in e)if(a(e,n)){if(e[n]===t)return c(n)+"/";if("object"==typeof e[n]&&""!=(r=u(e[n],t)))return c(n)+"/"+r}return""}function l(e,t){var r=[e];for(var n in t){var i="object"==typeof t[n]?JSON.stringify(t[n],null,2):t[n];void 0!==i&&r.push(n+": "+i)}return r.join("\n")}Object.defineProperty(r,"hasOwnProperty",{value:a}),r._objectKeys=o,r._deepClone=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},r.isInteger=function(e){for(var t,r=0,n=e.length;r<n;){if(!((t=e.charCodeAt(r))>=48&&t<=57))return!1;r++}return!0},r.escapePathComponent=c,r.unescapePathComponent=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},r._getPathRecursive=u,r.getPath=function(e,t){if(e===t)return"/";var r=u(e,t);if(""===r)throw new Error("Object not found in root");return"/"+r},r.hasUndefined=function e(t){if(t===undefined)return!0;if(t)if(Array.isArray(t)){for(var r=0,n=t.length;r<n;r++)if(e(t[r]))return!0}else if("object"==typeof t){var i=o(t),s=i.length;for(r=0;r<s;r++)if(e(t[i[r]]))return!0}return!1};var d=function(e){function t(t,r,n,i,s){var a=this.constructor,o=e.call(this,l(t,{name:r,index:n,operation:i,tree:s}))||this;return o.name=r,o.index=n,o.operation=i,o.tree=s,Object.setPrototypeOf(o,a.prototype),o.message=l(t,{name:r,index:n,operation:i,tree:s}),o}return i(t,e),t}(Error);r.PatchError=d}}},{package:"@metamask/smart-transactions-controller>fast-json-patch"}],[1640,{"./commonjs/core.js":1637,"./commonjs/duplex.js":1638,"./commonjs/helpers.js":1639},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./commonjs/core.js");Object.assign(r,n);var i=e("./commonjs/duplex.js");Object.assign(r,i);var s=e("./commonjs/helpers.js");r.JsonPatchError=s.PatchError,r.deepClone=s._deepClone,r.escapePathComponent=s.escapePathComponent,r.unescapePathComponent=s.unescapePathComponent}}},{package:"@metamask/smart-transactions-controller>fast-json-patch"}],[1641,{"@metamask/snap-utils":1716,"@xstate/fsm":1946},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.forceStrict=r.validateMachine=void 0;const n=e("@metamask/snap-utils"),i=e("@xstate/fsm");r.validateMachine=function(e){var t;(0,n.assert)("_options"in e,"The machine is not an @xstate/fsm machine");const r=e,i=new Set,s=e=>{return(0,n.flatMap)((t=e,Array.isArray(t)?t:t===undefined||null===t?[]:[t]),(e=>"string"==typeof e?[e]:((0,n.assert)("function"==typeof e),[]))).forEach(i.add.bind(i));var t};for(const e of Object.values(r.config.states)){s(e.entry),s(e.exit);for(const r of Object.values(null!==(t=e.on)&&void 0!==t?t:{}))s(r.actions)}i.forEach((e=>(0,n.assert)(r._options.actions!==undefined&&e in r._options.actions,`Action "${e}" doesn't have an implementation`)))},r.forceStrict=function(e){let t=!1;e.subscribe((e=>{(0,n.assert)(!t||e.changed,"Invalid state transition"),t=!0}));const r=e.send.bind(e);e.send=(...t)=>((0,n.assert)(e.status===i.InterpreterStatus.Running,"Interpreter is stopped"),r(...t))}}}},{package:"@metamask/snap-controllers"}],[1642,{"./services":1645,"./snaps":1656,"./utils":1660},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./services"),r),i(e("./snaps"),r),i(e("./utils"),r)}}},{package:"@metamask/snap-controllers"}],[1643,{"../utils":1660,"@metamask/object-multiplex":1602,"@metamask/snap-utils":1716,"@metamask/utils":1730,"json-rpc-engine":5166,"json-rpc-middleware-stream":1685,nanoid:1697,pump:5932},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.setupMultiplex=r.AbstractExecutionService=void 0;const i=n(e("@metamask/object-multiplex")),s=e("@metamask/snap-utils"),a=e("@metamask/utils"),o=e("json-rpc-engine"),c=e("nanoid"),u=n(e("pump")),l=e("json-rpc-middleware-stream"),d=e("../utils");function h(e,t){const r=new i.default;return(0,u.default)(e,r,e,(e=>{e&&(t?console.error(`"${t}" stream failure.`,e):console.error(e))})),r}r.AbstractExecutionService=class{constructor({setupSnapProvider:e,messenger:t,terminationTimeout:r=a.Duration.Second}){this._snapRpcHooks=new Map,this.jobs=new Map,this.setupSnapProvider=e,this.snapToJobMap=new Map,this.jobToSnapMap=new Map,this._messenger=t,this._terminationTimeout=r,this.registerMessageHandlers()}registerMessageHandlers(){this._messenger.registerActionHandler("ExecutionService:handleRpcRequest",((e,t)=>this.handleRpcRequest(e,t))),this._messenger.registerActionHandler("ExecutionService:executeSnap",(e=>this.executeSnap(e))),this._messenger.registerActionHandler("ExecutionService:terminateSnap",(e=>this.terminateSnap(e))),this._messenger.registerActionHandler("ExecutionService:terminateAllSnaps",(()=>this.terminateAllSnaps()))}async terminate(e){const t=this.jobs.get(e);if(!t)throw new Error(`Job with id "${e}" not found.`);const r=await(0,d.withTimeout)(this._command(e,{jsonrpc:"2.0",method:"terminate",params:[],id:(0,c.nanoid)()}),this._terminationTimeout);r!==d.hasTimedOut&&"OK"===r||console.error(`Job "${e}" failed to terminate gracefully.`,r),Object.values(t.streams).forEach((e=>{try{!e.destroyed&&e.destroy(),e.removeAllListeners()}catch(e){console.error("Error while destroying stream",e)}})),this._terminate(t),this._removeSnapAndJobMapping(e),this.jobs.delete(e),console.log(`Job "${e}" terminated.`)}async _initJob(){const e=(0,c.nanoid)(),{streams:t,worker:r}=await this._initStreams(e),n=new o.JsonRpcEngine,i=(0,l.createStreamMiddleware)();(0,u.default)(i.stream,t.command,i.stream),n.push(i.middleware);const s={id:e,streams:t,rpcEngine:n,worker:r};return this.jobs.set(e,s),s}async _initStreams(e){const{worker:t,stream:r}=await this._initEnvStream(e),n=h(r,`Job: "${e}"`),i=n.createStream(s.SNAP_STREAM_NAMES.COMMAND),o=t=>{if((0,a.isJsonRpcRequest)(t))return;const r=this.jobToSnapMap.get(e);"OutboundRequest"===t.method?this._messenger.publish("ExecutionService:outboundRequest",r):"OutboundResponse"===t.method?this._messenger.publish("ExecutionService:outboundResponse",r):"UnhandledError"===t.method?(0,a.isObject)(t.params)&&t.params.error?(this._messenger.publish("ExecutionService:unhandledError",r,t.params.error),i.removeListener("data",o)):console.error(new Error(`Received malformed "${t.method}" command stream notification.`)):console.error(new Error(`Received unexpected command stream notification "${t.method}".`))};i.on("data",o);const c=n.createStream(s.SNAP_STREAM_NAMES.JSON_RPC);return{streams:{command:i,rpc:c,_connection:r},worker:t}}async terminateSnap(e){const t=this.snapToJobMap.get(e);t&&await this.terminate(t)}async terminateAllSnaps(){await Promise.all([...this.jobs.keys()].map((e=>this.terminate(e)))),this._snapRpcHooks.clear()}async getRpcRequestHandler(e){return this._snapRpcHooks.get(e)}async executeSnap(e){if(this.snapToJobMap.has(e.snapId))throw new Error(`Snap "${e.snapId}" is already being executed.`);const t=await this._initJob();this._mapSnapAndJob(e.snapId,t.id),await this._command(t.id,{jsonrpc:"2.0",method:"ping",id:(0,c.nanoid)()});const r=t.streams.rpc;this.setupSnapProvider(e.snapId,r);const n=await this._command(t.id,{jsonrpc:"2.0",method:"executeSnap",params:e,id:(0,c.nanoid)()});return this._createSnapHooks(e.snapId,t.id),n}async _command(e,t){if("object"!=typeof t)throw new Error("Must send object.");const r=this.jobs.get(e);if(!r)throw new Error(`Job with id "${e}" not found.`);console.log("Parent: Sending Command",t);const n=await r.rpcEngine.handle(t);if(n.error)throw new Error(n.error.message);return n.result}_removeSnapHooks(e){this._snapRpcHooks.delete(e)}_createSnapHooks(e,t){this._snapRpcHooks.set(e,(async({origin:r,handler:n,request:i})=>await this._command(t,{id:(0,c.nanoid)(),jsonrpc:"2.0",method:"snapRpc",params:{origin:r,handler:n,request:i,target:e}})))}_getJobForSnap(e){return this.snapToJobMap.get(e)}_getSnapForJob(e){return this.jobToSnapMap.get(e)}_mapSnapAndJob(e,t){this.snapToJobMap.set(e,t),this.jobToSnapMap.set(t,e)}_removeSnapAndJobMapping(e){const t=this.jobToSnapMap.get(e);if(!t)throw new Error(`job: "${e}" has no mapped snap.`);this.jobToSnapMap.delete(e),this.snapToJobMap.delete(t),this._removeSnapHooks(t)}async handleRpcRequest(e,t){const r=await this.getRpcRequestHandler(e);if(!r)throw new Error(`Snap execution service returned no RPC handler for running snap "${e}".`);return r(t)}},r.setupMultiplex=h}}},{package:"@metamask/snap-controllers"}],[1644,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0})}}},{package:"@metamask/snap-controllers"}],[1645,{"./AbstractExecutionService":1643,"./ExecutionService":1644,"./iframe":1647},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./AbstractExecutionService"),r),i(e("./ExecutionService"),r),i(e("./iframe"),r)}}},{package:"@metamask/snap-controllers"}],[1646,{"../AbstractExecutionService":1643,"@metamask/post-message-stream":1664},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.IframeExecutionService=void 0;const n=e("@metamask/post-message-stream"),i=e("../AbstractExecutionService");class s extends i.AbstractExecutionService{constructor({iframeUrl:e,messenger:t,setupSnapProvider:r}){super({messenger:t,setupSnapProvider:r}),this.iframeUrl=e}_terminate(e){var t;null===(t=document.getElementById(e.id))||void 0===t||t.remove()}async _initEnvStream(e){const t=await this._createWindow(this.iframeUrl.toString(),e);return{worker:t,stream:new n.WindowPostMessageStream({name:"parent",target:"child",targetWindow:t,targetOrigin:"*"})}}_createWindow(e,t){return new Promise(((r,n)=>{const i=document.createElement("iframe");i.setAttribute("id",t),i.setAttribute("src",e),document.body.appendChild(i),i.addEventListener("load",(()=>{i.contentWindow?r(i.contentWindow):n(new Error(`iframe.contentWindow not present on load for job "${t}".`))})),i.setAttribute("sandbox","allow-scripts")}))}}r.IframeExecutionService=s}}},{package:"@metamask/snap-controllers"}],[1647,{"./IframeExecutionService":1646},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./IframeExecutionService"),r)}}},{package:"@metamask/snap-controllers"}],[1648,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.RequestQueue=void 0;r.RequestQueue=class{constructor(e){this.maxQueueSize=e,this.queueSizes=new Map}increment(e){var t;const r=null!==(t=this.queueSizes.get(e))&&void 0!==t?t:0;if(r>=this.maxQueueSize)throw new Error("Maximum number of requests reached. Try again later.");this.queueSizes.set(e,r+1)}decrement(e){var t;const r=null!==(t=this.queueSizes.get(e))&&void 0!==t?t:0;if(0===r)throw new Error(`Cannot decrement, ${e} does not have any outstanding requests.`);this.queueSizes.set(e,r-1)}get(e){var t;return null!==(t=this.queueSizes.get(e))&&void 0!==t?t:0}}}}},{package:"@metamask/snap-controllers"}],[1649,{"../fsm":1641,"../utils":1660,"./RequestQueue":1648,"./Timer":1650,"./endowments":1652,"./utils":1657,"@metamask/browser-passworder":1424,"@metamask/controllers":1458,"@metamask/rpc-methods":1612,"@metamask/snap-utils":1716,"@metamask/utils":1730,"@xstate/fsm":1946,"eth-rpc-errors":2815,nanoid:1697},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.SnapController=r.SnapEvents=r.SnapStatus=r.AppKeyType=r.SNAP_APPROVAL_UPDATE=r.controllerName=void 0;const s=i(e("@metamask/browser-passworder")),a=e("@metamask/controllers"),o=e("@metamask/snap-utils"),c=e("@metamask/utils"),u=e("@xstate/fsm"),l=e("eth-rpc-errors"),d=e("nanoid"),h=e("@metamask/rpc-methods"),f=e("../fsm"),p=e("../utils"),m=e("./endowments"),g=e("./RequestQueue"),y=e("./utils"),b=e("./Timer");r.controllerName="SnapController",r.SNAP_APPROVAL_UPDATE="wallet_updateSnap";const v=new Set(["initialPermissions","id","permissionName","version"]);var w;!function(e){e.stateEncryption="stateEncryption"}(w=r.AppKeyType||(r.AppKeyType={}));const _={snapErrors:{},snaps:{},snapStates:{}};function S(e){return Object.keys(e).reduce(((t,r)=>(v.has(r)&&(t[r]=e[r]),t)),{})}r.SnapStatus={installing:"installing",running:"running",stopped:"stopped",crashed:"crashed"},r.SnapEvents={start:"START",stop:"STOP",crash:"CRASH",update:"UPDATE"};class k extends a.BaseControllerV2{constructor({closeAllConnections:e,messenger:t,state:n,getAppKey:i,environmentEndowmentPermissions:s=[],npmRegistryUrl:a,idleTimeCheckInterval:o=(0,c.inMilliseconds)(5,c.Duration.Second),checkBlockList:u,maxIdleTime:l=(0,c.inMilliseconds)(30,c.Duration.Second),maxRequestTime:d=(0,c.inMilliseconds)(60,c.Duration.Second),fetchFunction:h=globalThis.fetch.bind(globalThis),featureFlags:f={}}){super({messenger:t,metadata:{snapErrors:{persist:!1,anonymous:!1},snapStates:{persist:!0,anonymous:!1},snaps:{persist:e=>Object.values(e).map((e=>Object.assign(Object.assign({},e),{status:r.SnapStatus.stopped}))).reduce(((e,t)=>(e[t.id]=t,e)),{}),anonymous:!1}},name:"SnapController",state:Object.assign(Object.assign({},_),n)}),this._closeAllConnections=e,this._environmentEndowmentPermissions=s,this._featureFlags=f,this._fetchFunction=h,this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._getAppKey=i,this._idleTimeCheckInterval=o,this._checkSnapBlockList=u,this._maxIdleTime=l,this._maxRequestTime=d,this._npmRegistryUrl=a,this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onOutboundRequest=this._onOutboundRequest.bind(this),this._onOutboundResponse=this._onOutboundResponse.bind(this),this._snapsRuntimeData=new Map,this._pollForLastRequestStatus(),this.messagingSystem.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.subscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messagingSystem.subscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.initializeStateMachine(),this.registerMessageHandlers()}initializeStateMachine(){const e=({snapId:e})=>this.getExpect(e).enabled,t={initial:"installing",states:{installing:{on:{START:{target:"running",cond:e}}},running:{on:{STOP:"stopped",CRASH:"crashed"}},stopped:{on:{START:{target:"running",cond:e},UPDATE:"installing"}},crashed:{on:{START:{target:"running",cond:e}}}}};this._statusMachine=(0,u.createMachine)(t),(0,f.validateMachine)(this._statusMachine)}registerMessageHandlers(){this.messagingSystem.registerActionHandler(`${r.controllerName}:add`,((...e)=>this.add(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:clearSnapState`,((...e)=>this.clearSnapState(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:get`,((...e)=>this.get(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:getSnapState`,((...e)=>this.getSnapState(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:handleRequest`,((...e)=>this.handleRequest(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:has`,((...e)=>this.has(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:updateBlockedSnaps`,(()=>this.updateBlockedSnaps())),this.messagingSystem.registerActionHandler(`${r.controllerName}:updateSnapState`,((...e)=>this.updateSnapState(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:enable`,((...e)=>this.enableSnap(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:disable`,((...e)=>this.disableSnap(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:remove`,((...e)=>this.removeSnap(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:getSnaps`,((...e)=>this.getPermittedSnaps(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:install`,((...e)=>this.installSnaps(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:removeSnapError`,((...e)=>this.removeSnapError(...e)))}_pollForLastRequestStatus(){this._timeoutForLastRequestStatus=setTimeout((async()=>{await this._stopSnapsLastRequestPastMax(),this._pollForLastRequestStatus()}),this._idleTimeCheckInterval)}async updateBlockedSnaps(){const e=await this._checkSnapBlockList(Object.values(this.state.snaps).reduce(((e,t)=>(e[t.id]=t.version,e)),{}));await Promise.all(Object.entries(e).map((e=>{var[t,r]=e,{blocked:i}=r,s=n(r,["blocked"]);return i?this._blockSnap(t,s):this._unblockSnap(t)})))}async _blockSnap(e,t){if(this.has(e)){try{this.update((r=>{r.snaps[e].blocked=!0,r.snaps[e].blockInformation=t})),await this.disableSnap(e)}catch(t){console.error(`Encountered error when stopping blocked snap "${e}".`,t)}this.messagingSystem.publish(`${r.controllerName}:snapBlocked`,e,t)}}async _unblockSnap(e){this.has(e)&&this.state.snaps[e].blocked&&(this.update((t=>{t.snaps[e].blocked=!1,delete t.snaps[e].blockInformation})),this.messagingSystem.publish(`${r.controllerName}:snapUnblocked`,e))}async isBlocked(e,t){return(await this._checkSnapBlockList({[e]:t}))[e].blocked}async _assertIsUnblocked(e,t){if(await this.isBlocked(e,t))throw new Error(`Cannot install version "${t}" of snap "${e}": the version is blocked.`)}async _stopSnapsLastRequestPastMax(){const e=[...this._snapsRuntimeData.entries()];return Promise.all(e.filter((([e,t])=>0===t.pendingInboundRequests.length&&t.lastRequest&&this._maxIdleTime&&(0,c.timeSince)(t.lastRequest)>this._maxIdleTime)).map((([e])=>this.stopSnap(e,"STOP"))))}async _onUnhandledSnapError(e,t){await this.stopSnap(e,"CRASH"),this.addSnapError(t)}async _onOutboundRequest(e){const t=this.getRuntimeExpect(e);t.pendingInboundRequests.forEach((e=>e.timer.pause())),t.pendingOutboundRequests+=1}async _onOutboundResponse(e){const t=this.getRuntimeExpect(e);t.pendingOutboundRequests-=1,0===t.pendingOutboundRequests&&t.pendingInboundRequests.forEach((e=>e.timer.resume()))}transition(e,t){const{interpreter:r}=this.getRuntimeOrDefault(e);r.send(t),this.update((t=>{t.snaps[e].status=r.state.value}))}async startSnap(e){const t=this.getExpect(e);if(!1===this.state.snaps[e].enabled)throw new Error(`Snap "${e}" is disabled.`);await this._startSnap({snapId:e,sourceCode:t.sourceCode})}enableSnap(e){if(this.getExpect(e),this.state.snaps[e].blocked)throw new Error(`Snap "${e}" is blocked and cannot be enabled.`);this.update((t=>{t.snaps[e].enabled=!0}))}disableSnap(e){if(!this.has(e))throw new Error(`Snap "${e}" not found.`);return this.update((t=>{t.snaps[e].enabled=!1})),this.isRunning(e)?this.stopSnap(e,"STOP"):Promise.resolve()}async stopSnap(e,t="STOP"){const r=this.getRuntime(e);if(!r)throw new Error(`The snap "${e}" is not running.`);r.lastRequest=null,r.pendingInboundRequests=[],r.pendingOutboundRequests=0;try{this.isRunning(e)&&(this._closeAllConnections(e),await this.terminateSnap(e))}finally{this.isRunning(e)&&this.transition(e,t)}}async terminateSnap(e){await this.messagingSystem.call("ExecutionService:terminateSnap",e),this.messagingSystem.publish("SnapController:snapTerminated",this.getTruncatedExpect(e))}isRunning(e){return"running"===this.getExpect(e).status}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getExpect(e){const t=this.get(e);return(0,o.assert)(t!==undefined,new Error(`Snap "${e}" not found.`)),t}getTruncated(e){const t=this.get(e);return t?S(t):null}getTruncatedExpect(e){return S(this.getExpect(e))}async updateSnapState(e,t){const r=await this.encryptSnapState(e,t);this.update((t=>{t.snapStates[e]=r}))}async clearSnapState(e){this.update((t=>{delete t.snapStates[e]}))}addSnapError(e){this.update((t=>{const r=(0,d.nanoid)();t.snapErrors[r]=Object.assign(Object.assign({},e),{internalID:r})}))}async removeSnapError(e){this.update((t=>{delete t.snapErrors[e]}))}async clearSnapErrors(){this.update((e=>{e.snapErrors={}}))}async getSnapState(e){const t=this.state.snapStates[e];return t?this.decryptSnapState(e,t):null}async getEncryptionKey(e){return this._getAppKey(e,w.stateEncryption)}async encryptSnapState(e,t){const r=await this.getEncryptionKey(e);return s.default.encrypt(r,t)}async decryptSnapState(e,t){const r=await this.getEncryptionKey(e);try{return await s.default.decrypt(r,t)}catch(e){throw new Error("Failed to decrypt snap state, the state must be corrupted.")}}clearState(){const e=Object.keys(this.state.snaps);e.forEach((e=>{this._closeAllConnections(e)})),this.messagingSystem.call("ExecutionService:terminateAllSnaps"),e.forEach(this.revokeAllSnapPermissions),this.update((e=>{e.snaps={},e.snapStates={}}))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");await Promise.all(e.map((async e=>{const t=this.getTruncatedExpect(e);await this.disableSnap(e),this.revokeAllSnapPermissions(e);const r=(0,o.getSnapPermissionName)(e);this.messagingSystem.call("PermissionController:revokePermissionForAllSubjects",r),this._snapsRuntimeData.delete(e),this.update((t=>{delete t.snaps[e],delete t.snapStates[e]})),this.messagingSystem.publish("SnapController:snapRemoved",t)})))}async revokeAllSnapPermissions(e){await this.messagingSystem.call("PermissionController:hasPermissions",e)&&this.messagingSystem.call("PermissionController:revokeAllPermissions",e)}async getPermittedSnaps(e){var t;return Object.values(null!==(t=await this.messagingSystem.call("PermissionController:getPermissions",e))&&void 0!==t?t:{}).reduce(((e,t)=>{if(t.parentCapability.startsWith(o.SNAP_PREFIX)){const r=t.parentCapability.replace(o.SNAP_PREFIX_REGEX,""),n=this.getTruncated(r);e[r]=n||{error:(0,l.serializeError)(new Error("Snap permitted but not installed."))}}return e}),{})}async installSnaps(e,t){const r={};return await Promise.all(Object.entries(t).map((async([t,{version:n}])=>{const i=(0,o.resolveVersion)(n),s=(0,o.getSnapPermissionName)(t);(0,o.isValidSnapVersionRange)(i)?await this.messagingSystem.call("PermissionController:hasPermission",e,s)?r[t]=Object.assign({},await this.processRequestedSnap(e,t,i)):r[t]={error:l.ethErrors.provider.unauthorized(`Not authorized to install snap "${t}". Request the permission for the snap before attempting to install it.`)}:r[t]={error:l.ethErrors.rpc.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${i}".`)}}))),r}async processRequestedSnap(e,t,r){try{(0,o.validateSnapId)(t)}catch(e){return{error:l.ethErrors.rpc.invalidParams(`"${t}" is not a valid snap id.`)}}const n=this.getTruncated(t);if(n&&(0,o.getSnapPrefix)(t)!==o.SnapIdPrefixes.local){if((0,o.satisfiesVersionRange)(n.version,r))return n;if(!0!==this._featureFlags.dappsCanUpdateSnaps)return{error:l.ethErrors.rpc.invalidParams(`Version mismatch with already installed snap. ${t}@${n.version} doesn't satisfy requested version ${r}`)};try{const i=await this.updateSnap(e,t,r);return null===i?{error:l.ethErrors.rpc.invalidParams(`Snap "${t}@${n.version}" is already installed, couldn't update to a version inside requested "${r}" range.`)}:i}catch(e){return{error:(0,l.serializeError)(e)}}}n&&this.isRunning(t)&&await this.stopSnap(t,"STOP");try{const{sourceCode:n}=await this.add({origin:e,id:t,versionRange:r});await this.authorize(t),await this._startSnap({snapId:t,sourceCode:n});const i=this.getTruncatedExpect(t);return this.messagingSystem.publish("SnapController:snapInstalled",i),i}catch(e){return console.error("Error when adding snap.",e),this.has(t)&&this.removeSnap(t),{error:(0,l.serializeError)(e)}}}async updateSnap(e,t,n=o.DEFAULT_REQUESTED_SNAP_VERSION){const i=this.getExpect(t);if(!(0,o.isValidSnapVersionRange)(n))throw new Error(`Received invalid snap version range: "${n}".`);const s=await this._fetchSnap(t,n),a=s.manifest.version;if(!(0,o.gtVersion)(a,i.version))return console.warn(`Tried updating snap "${t}" within "${n}" version range, but newer version "${a}" is already installed`),null;await this._assertIsUnblocked(t,a);const{newPermissions:u,unusedPermissions:l,approvedPermissions:h}=await this.calculatePermissionsChange(t,s.manifest.initialPermissions),f=(0,d.nanoid)();if(!await this.messagingSystem.call("ApprovalController:addRequest",{origin:e,id:f,type:r.SNAP_APPROVAL_UPDATE,requestData:{metadata:{id:f,origin:t,dappOrigin:e},permissions:u,snapId:t,newVersion:s.manifest.version,newPermissions:u,approvedPermissions:h,unusedPermissions:l}},!0))return null;this.isRunning(t)&&await this.stopSnap(t,"STOP"),this.transition(t,"UPDATE"),this._set({origin:e,id:t,manifest:s.manifest,sourceCode:s.sourceCode,versionRange:n});const p=Object.keys(l);(0,c.isNonEmptyArray)(p)&&await this.messagingSystem.call("PermissionController:revokePermissions",{[t]:p}),(0,c.isNonEmptyArray)(Object.keys(u))&&await this.messagingSystem.call("PermissionController:grantPermissions",{approvedPermissions:u,subject:{origin:t}}),await this._startSnap({snapId:t,sourceCode:s.sourceCode});const m=this.getTruncatedExpect(t);return this.messagingSystem.publish("SnapController:snapUpdated",m,i.version),m}async add(e){const{id:t}=e;if((0,o.validateSnapId)(t),!e||!("origin"in e)||!("id"in e)||!("manifest"in e)&&"sourceCode"in e||"manifest"in e&&!("sourceCode"in e))throw new Error(`Invalid add snap args for snap "${t}".`);const r=this.getRuntimeOrDefault(t);r.installPromise||(console.info(`Adding snap: ${t}`),r.installPromise=(async()=>{if("manifest"in e&&"sourceCode"in e)return this._set(Object.assign(Object.assign({},e),{id:t}));const r=await this._fetchSnap(t,e.versionRange);return await this._assertIsUnblocked(t,r.manifest.version),this._set(Object.assign(Object.assign(Object.assign({},e),r),{id:t}))})());try{return await r.installPromise}catch(e){throw r.installPromise=null,e}}async _startSnap(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);try{const r=await this._executeWithTimeout(t,this.messagingSystem.call("ExecutionService:executeSnap",Object.assign(Object.assign({},e),{endowments:await this._getEndowments(t)})));return this.transition(t,"START"),r}catch(e){throw await this.terminateSnap(t),e}}async _getEndowments(e){let t=[];for(const r of this._environmentEndowmentPermissions)if(await this.messagingSystem.call("PermissionController:hasPermission",e,r)){const n=await this.messagingSystem.call("PermissionController:getEndowments",e,r);if(n){if(!Array.isArray(n)||n.some((e=>"string"!=typeof e)))throw new Error("Expected an array of string endowment names.");t=t.concat(n)}}const r=[...new Set([...o.DEFAULT_ENDOWMENTS,...t])];return r.length<o.DEFAULT_ENDOWMENTS.length+t.length&&console.error("Duplicate endowments found. Default endowments should not be requested.",t),r}_set(e){var t;const{id:r,origin:n,manifest:i,sourceCode:s,svgIcon:a,versionRange:c=o.DEFAULT_REQUESTED_SNAP_VERSION}=e;(0,o.validateSnapJsonFile)(o.NpmSnapFileNames.Manifest,i);const{version:u}=i;if(!(0,o.satisfiesVersionRange)(u,c))throw new Error(`Version mismatch. Manifest for "${r}" specifies version "${u}" which doesn't satisfy requested version range "${c}"`);if("string"!=typeof s||0===s.length)throw new Error(`Invalid source code for snap "${r}".`);const l=null==i?void 0:i.initialPermissions;if(!l||"object"!=typeof l||Array.isArray(l))throw new Error(`Invalid initial permissions for snap "${r}".`);const d=this.state.snaps[r],h=[...null!==(t=null==d?void 0:d.versionHistory)&&void 0!==t?t:[],{version:u,date:Date.now(),origin:n}],f=Object.assign(Object.assign({},d),{blocked:!1,enabled:!0,permissionName:(0,o.getSnapPermissionName)(r),id:r,initialPermissions:l,manifest:i,sourceCode:s,status:this._statusMachine.config.initial,version:u,versionHistory:h});return delete f.blockInformation,this.update((e=>{e.snaps[r]=f})),this.messagingSystem.publish("SnapController:snapAdded",f,a),f}async _fetchSnap(e,t=o.DEFAULT_REQUESTED_SNAP_VERSION){try{const r=(0,o.getSnapPrefix)(e);switch(r){case o.SnapIdPrefixes.local:return this._fetchLocalSnap(e.replace(o.SnapIdPrefixes.local,""));case o.SnapIdPrefixes.npm:return this._fetchNpmSnap(e.replace(o.SnapIdPrefixes.npm,""),t);default:return(0,o.assertExhaustive)(r)}}catch(t){throw new Error(`Failed to fetch Snap "${e}": ${t.message}`)}}async _fetchNpmSnap(e,t){if(!(0,o.isValidSnapVersionRange)(t))throw new Error(`Received invalid Snap version range: "${t}".`);const{manifest:r,sourceCode:n,svgIcon:i}=await(0,y.fetchNpmSnap)(e,t,this._npmRegistryUrl,this._fetchFunction);return{manifest:r,sourceCode:n,svgIcon:i}}async _fetchLocalSnap(e){const t={cache:"no-cache"},r=new URL(o.NpmSnapFileNames.Manifest,e);if(!o.LOCALHOST_HOSTNAMES.has(r.hostname))throw new Error(`Invalid URL: Locally hosted Snaps must be hosted on localhost. Received URL: "${r.toString()}"`);const n=await(await this._fetchFunction(r.toString(),t)).json();(0,o.validateSnapJsonFile)(o.NpmSnapFileNames.Manifest,n);const i=n,{source:{location:{npm:{filePath:s,iconPath:a}}}}=i,[c,u]=await Promise.all([(await this._fetchFunction(new URL(s,e).toString(),t)).text(),a?(await this._fetchFunction(new URL(a,e).toString(),t)).text():undefined]);return(0,o.validateSnapShasum)(i,c),{manifest:i,sourceCode:c,svgIcon:u}}processSnapPermissions(e){return(0,o.fromEntries)(Object.entries(e).map((([e,t])=>(0,c.hasProperty)(h.caveatMappers,e)?[e,h.caveatMappers[e](t)]:[e,t])))}async authorize(e){console.info(`Authorizing snap: ${e}`);const t=this.state.snaps[e],{initialPermissions:r}=t;try{if((0,c.isNonEmptyArray)(Object.keys(r))){const t=this.processSnapPermissions(r),[n]=await this.messagingSystem.call("PermissionController:requestPermissions",{origin:e},t);return Object.values(n).map((e=>e.parentCapability))}return[]}finally{this.getRuntimeExpect(e).installPromise=null}}destroy(){super.destroy(),this._timeoutForLastRequestStatus&&clearTimeout(this._timeoutForLastRequestStatus),this.messagingSystem.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.unsubscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messagingSystem.unsubscribe("ExecutionService:outboundResponse",this._onOutboundResponse)}async handleRequest({snapId:e,origin:t,handler:r,request:n}){const i=await this.getRpcRequestHandler(e);if(!i)throw new Error(`Snap RPC message handler not found for snap "${e}".`);return i({origin:t,handler:r,request:n})}async getRpcRequestHandler(e){const t=this.getRuntimeOrDefault(e),n=t.rpcHandler;if(n)return n;const i=new g.RequestQueue(5),s=new Map,a=async({origin:t,handler:n,request:a})=>{if(!1===this.state.snaps[e].enabled)throw new Error(`Snap "${e}" is disabled.`);if(this.state.snaps[e].status===r.SnapStatus.installing)throw new Error(`Snap "${e}" is currently being installed. Please try again later.`);if(!1===this.isRunning(e)){let r=s.get(e);if(r){if(i.get(t)>=i.maxQueueSize)throw new Error("Exceeds maximum number of requests waiting to be resolved, please try again.")}else r=this.startSnap(e),s.set(e,r);i.increment(t);try{await r}finally{i.decrement(t),s.get(e)===r&&s.delete(e)}}let o=a;if((0,c.hasProperty)(a,"jsonrpc")){if("2.0"!==a.jsonrpc)throw l.ethErrors.rpc.invalidRequest({message:'Invalid "jsonrpc" property. Must be "2.0" if provided.',data:a.jsonrpc})}else o=Object.assign(Object.assign({},a),{jsonrpc:"2.0"});const u=new b.Timer(this._maxRequestTime);this._recordSnapRpcRequestStart(e,a.id,u);const d=this.messagingSystem.call("ExecutionService:handleRpcRequest",e,{origin:t,handler:n,request:o});try{const t=await this._executeWithTimeout(e,d,u);return this._recordSnapRpcRequestFinish(e,a.id),t}catch(t){throw await this.stopSnap(e,"CRASH"),t}};return t.rpcHandler=a,a}async _executeWithTimeout(e,t,r){if(await this.messagingSystem.call("PermissionController:hasPermission",e,m.SnapEndowments.longRunning))return t;const n=await(0,p.withTimeout)(t,null!=r?r:this._maxRequestTime);if(n===p.hasTimedOut)throw new Error("The request timed out.");return n}_recordSnapRpcRequestStart(e,t,r){const n=this.getRuntimeExpect(e);n.pendingInboundRequests.push({requestId:t,timer:r}),n.lastRequest=null}_recordSnapRpcRequestFinish(e,t){const r=this.getRuntimeExpect(e);r.pendingInboundRequests=r.pendingInboundRequests.filter((e=>e.requestId!==t)),0===r.pendingInboundRequests.length&&(r.lastRequest=Date.now())}getRuntime(e){return this._snapsRuntimeData.get(e)}getRuntimeExpect(e){const t=this.getRuntime(e);return(0,o.assert)(t!==undefined,new Error(`Snap "${e}" runtime data not found`)),t}getRuntimeOrDefault(e){var t;if(!this._snapsRuntimeData.has(e)){const r=this.get(e),n=(0,u.interpret)(this._statusMachine);n.start({context:{snapId:e},value:null!==(t=null==r?void 0:r.status)&&void 0!==t?t:this._statusMachine.config.initial}),(0,f.forceStrict)(n),this._snapsRuntimeData.set(e,{lastRequest:null,rpcHandler:null,installPromise:null,pendingInboundRequests:[],pendingOutboundRequests:0,interpreter:n})}return this.getRuntimeExpect(e)}async calculatePermissionsChange(e,t){var r;const n=null!==(r=await this.messagingSystem.call("PermissionController:getPermissions",e))&&void 0!==r?r:{},i=(0,p.setDiff)(t,n),s=(0,p.setDiff)(n,t);return{newPermissions:i,unusedPermissions:s,approvedPermissions:(0,p.setDiff)(n,s)}}}r.SnapController=k}}},{package:"@metamask/snap-controllers"}],[1650,{"@metamask/snap-utils":1716},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.Timer=void 0;const n=e("@metamask/snap-utils");r.Timer=class{constructor(e){(0,n.assert)(!Number.isNaN(e),new TypeError("Can't start a timer with NaN time")),(0,n.assert)(e>=0,new TypeError("Can't start a timer with negative time")),this.state={value:"stopped",remaining:e}}get status(){return this.state.value}cancel(){(0,n.assert)("paused"===this.status||"running"===this.status,new Error("Tried to cancel a not running Timer")),this.onFinish(!1)}pause(){(0,n.assert)("running"===this.state.value,new Error("Tried to pause a not running Timer"));const{callback:e,start:t,timeout:r,remaining:i}=this.state;r!==undefined&&clearTimeout(r),this.state={value:"paused",callback:e,remaining:i-(Date.now()-t)}}start(e){(0,n.assert)("stopped"===this.state.value,new Error("Tried to start an already running Timer"));const{remaining:t}=this.state;this.state={value:"paused",remaining:t,callback:e},this.resume()}resume(){(0,n.assert)("paused"===this.state.value,new Error("Tried to resume not paused Timer"));const{remaining:e,callback:t}=this.state,r=Date.now();let i;e!==Number.POSITIVE_INFINITY&&(i=setTimeout((()=>this.onFinish(!0)),e)),this.state={value:"running",callback:t,remaining:e,start:r,timeout:i}}onFinish(e){(0,n.assert)("running"===this.state.value||"paused"===this.state.value),"running"===this.state.value&&this.state.timeout!==undefined&&clearTimeout(this.state.timeout);const{callback:t}=this.state;this.state={value:"finished"},e&&t()}}}}},{package:"@metamask/snap-controllers"}],[1651,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.SnapEndowments=void 0,function(e){e.networkAccess="endowment:network-access",e.longRunning="endowment:long-running",e.transactionInsight="endowment:transaction-insight"}(r.SnapEndowments||(r.SnapEndowments={}))}}},{package:"@metamask/snap-controllers"}],[1652,{"./enum":1651,"./long-running":1653,"./network-access":1654,"./transaction-insight":1655},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.endowmentPermissionBuilders=void 0;const s=e("./long-running"),a=e("./network-access"),o=e("./transaction-insight");r.endowmentPermissionBuilders={[a.networkAccessEndowmentBuilder.targetKey]:a.networkAccessEndowmentBuilder,[s.longRunningEndowmentBuilder.targetKey]:s.longRunningEndowmentBuilder,[o.transactionInsightEndowmentBuilder.targetKey]:o.transactionInsightEndowmentBuilder},i(e("./enum"),r)}}},{package:"@metamask/snap-controllers"}],[1653,{"./enum":1651,"@metamask/controllers":1458},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.longRunningEndowmentBuilder=void 0;const n=e("@metamask/controllers"),i=e("./enum").SnapEndowments.longRunning;r.longRunningEndowmentBuilder=Object.freeze({targetKey:i,specificationBuilder:e=>({permissionType:n.PermissionType.Endowment,targetKey:i,allowedCaveats:null,endowmentGetter:e=>undefined})})}}},{package:"@metamask/snap-controllers"}],[1654,{"./enum":1651,"@metamask/controllers":1458},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.networkAccessEndowmentBuilder=void 0;const n=e("@metamask/controllers"),i=e("./enum").SnapEndowments.networkAccess;r.networkAccessEndowmentBuilder=Object.freeze({targetKey:i,specificationBuilder:e=>({permissionType:n.PermissionType.Endowment,targetKey:i,allowedCaveats:null,endowmentGetter:e=>["fetch","WebSocket","Request","Headers","Response"]})})}}},{package:"@metamask/snap-controllers"}],[1655,{"./enum":1651,"@metamask/controllers":1458},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.transactionInsightEndowmentBuilder=void 0;const n=e("@metamask/controllers"),i=e("./enum").SnapEndowments.transactionInsight;r.transactionInsightEndowmentBuilder=Object.freeze({targetKey:i,specificationBuilder:e=>({permissionType:n.PermissionType.Endowment,targetKey:i,allowedCaveats:null,endowmentGetter:e=>undefined})})}}},{package:"@metamask/snap-controllers"}],[1656,{"./SnapController":1649,"./endowments":1652,"./utils":1657},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./utils"),r),i(e("./SnapController"),r),i(e("./endowments"),r)}}},{package:"@metamask/snap-controllers"}],[1657,{"./npm":1658,"./stream":1659},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./npm"),r),i(e("./stream"),r)}}},{package:"@metamask/snap-controllers"}],[1658,{"./stream":1659,"@metamask/snap-utils":1716,"@metamask/utils":1730,"gunzip-maybe":4753,pump:5932},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.fetchNpmSnap=r.DEFAULT_NPM_REGISTRY=void 0;const i=e("@metamask/utils"),s=n(e("pump")),a=n(e("gunzip-maybe")),o=e("@metamask/snap-utils"),c=e("./stream");r.DEFAULT_NPM_REGISTRY="https://registry.npmjs.org",r.fetchNpmSnap=async function(e,t,n=r.DEFAULT_NPM_REGISTRY,u=fetch){const[l,d]=await async function(e,t,n=r.DEFAULT_NPM_REGISTRY,s=fetch){var a,c,u,l;const d=await(await s(new URL(e,n).toString())).json();if(!(0,i.isObject)(d))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);const h=(0,o.getTargetVersion)(Object.keys(null!==(a=null==d?void 0:d.versions)&&void 0!==a?a:{}),t);if(null===h)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}"`);const f=null===(l=null===(u=null===(c=d.versions)||void 0===c?void 0:c[h])||void 0===u?void 0:u.dist)||void 0===l?void 0:l.tarball;if(!(0,o.isValidUrl)(f)||!f.endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in npm metadata for package "${e}".`);const p=new URL(n),m=new URL(f);m.hostname=p.hostname,m.protocol=p.protocol;const g=await s(m.toString());if(!g.ok)throw new Error(`Failed to fetch tarball for package "${e}".`);return[await g.blob().then((e=>e.stream())),h]}(e,t,n,u),h={};return await new Promise(((e,t)=>{(0,s.default)((0,c.getNodeStream)(l),(0,a.default)(),(0,c.createTarballExtractionStream)(h),(r=>{r?t(r):e()}))})),(0,o.validateNpmSnap)(h,`npm Snap "${e}@${d}" validation error: `)}}}},{package:"@metamask/snap-controllers"}],[1659,{"@metamask/snap-utils":1716,"@metamask/utils":1730,"concat-stream":1667,"readable-web-to-node-stream":6834,"tar-stream":7048},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.createTarballExtractionStream=r.getNodeStream=r.stripDotSlash=void 0;const i=e("readable-web-to-node-stream"),s=e("tar-stream"),a=n(e("concat-stream")),o=e("@metamask/utils"),c=e("@metamask/snap-utils"),u=/^package\//u;function l(e){return null==e?void 0:e.replace(/^\.\//u,"")}r.stripDotSlash=l,r.getNodeStream=function(e){return"function"!=typeof e.getReader?e:new i.ReadableWebToNodeStream(e)},r.createTarballExtractionStream=function(e){const t=(0,s.extract)(),r=new Map;return t.on("entry",((n,i,s)=>{const{name:o,type:l}=n;if("file"===l){const n=o.replace(u,"");if(n===c.NpmSnapFileNames.PackageJson)return i.pipe((0,a.default)((r=>{try{e.packageJson=JSON.parse(r.toString())}catch(e){return t.destroy(new Error(`Failed to parse "${c.NpmSnapFileNames.PackageJson}".`))}return s()})));if(n===c.NpmSnapFileNames.Manifest)return i.pipe((0,a.default)((r=>{try{e.manifest=JSON.parse(r.toString())}catch(e){return t.destroy(new Error(`Failed to parse "${c.NpmSnapFileNames.Manifest}".`))}return s()})));if(/\w+\.(?:js|svg)$/u.test(n))return i.pipe((0,a.default)((e=>(r.set(n,e),s()))))}return i.on("end",(()=>s())),i.resume()})),t.once("finish",(()=>{var t,n,i,s,a;if((0,o.isObject)(e.manifest)){const{filePath:o,iconPath:c}=null!==(i=null===(n=null===(t=e.manifest.source)||void 0===t?void 0:t.location)||void 0===n?void 0:n.npm)&&void 0!==i?i:{},u=l(o),d=l(c);u&&(e.sourceCode=null===(s=r.get(u))||void 0===s?void 0:s.toString("utf8")),"string"==typeof d&&d.endsWith(".svg")&&(e.svgIcon=null===(a=r.get(d))||void 0===a?void 0:a.toString("utf8"))}r.clear()})),t}}}},{package:"@metamask/snap-controllers"}],[1660,{"./snaps/Timer":1650},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.withTimeout=r.hasTimedOut=r.delayWithTimer=r.delay=r.setDiff=void 0;const n=e("./snaps/Timer");function i(e,t){let r;const n=new Promise(((n,i)=>{e.start((()=>{t===undefined?n():n(t)})),r=i}));return n.cancel=()=>{"finished"!==e.status&&(e.cancel(),r(new Error("The delay has been canceled.")))},n}r.setDiff=function(e,t){return Object.entries(e).reduce(((e,[r,n])=>(r in t||(e[r]=n),e)),{})},r.delay=function(e,t){return i(new n.Timer(e),t)},r.delayWithTimer=i,r.hasTimedOut=Symbol("Used to check if the requested promise has timeout (see withTimeout)"),r.withTimeout=async function(e,t){const s=i("number"==typeof t?new n.Timer(t):t,r.hasTimedOut);try{return await Promise.race([e,s])}finally{s.cancel()}}}}},{package:"@metamask/snap-controllers"}],[1661,{"readable-stream":1708},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.BasePostMessageStream=void 0;const n=e("readable-stream"),i=()=>undefined,s="ACK";class a extends n.Duplex{constructor(){super({objectMode:!0}),this._init=!1,this._haveSyn=!1}_handshake(){this._write("SYN",null,i),this.cork()}_onData(e){if(this._init)try{this.push(e)}catch(e){this.emit("error",e)}else"SYN"===e?(this._haveSyn=!0,this._write(s,null,i)):e===s&&(this._init=!0,this._haveSyn||this._write(s,null,i),this.uncork())}_read(){return undefined}_write(e,t,r){this._postMessage(e),r()}}r.BasePostMessageStream=a}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream"}],[1662,{"../BasePostMessageStream":1661,"../utils":1665},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.WebWorkerParentPostMessageStream=void 0;const n=e("../BasePostMessageStream"),i=e("../utils");class s extends n.BasePostMessageStream{constructor({worker:e}){super(),this._target=i.DEDICATED_WORKER_NAME,this._worker=e,this._worker.onmessage=this._onMessage.bind(this),this._handshake()}_postMessage(e){this._worker.postMessage({target:this._target,data:e})}_onMessage(e){const t=e.data;(0,i.isValidStreamMessage)(t)&&this._onData(t.data)}_destroy(){this._worker.onmessage=null,this._worker=null}}r.WebWorkerParentPostMessageStream=s}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream"}],[1663,{"../BasePostMessageStream":1661,"../utils":1665},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.WebWorkerPostMessageStream=void 0;const n=e("../BasePostMessageStream"),i=e("../utils");class s extends n.BasePostMessageStream{constructor(){if("undefined"==typeof self||"undefined"==typeof WorkerGlobalScope||!(self instanceof WorkerGlobalScope))throw new Error("WorkerGlobalScope not found. This class should only be instantiated in a WebWorker.");super(),this._name=i.DEDICATED_WORKER_NAME,self.onmessage=this._onMessage.bind(this),this._handshake()}_postMessage(e){self.postMessage({data:e})}_onMessage(e){const t=e.data;(0,i.isValidStreamMessage)(t)&&t.target===this._name&&this._onData(t.data)}_destroy(){return undefined}}r.WebWorkerPostMessageStream=s}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream"}],[1664,{"./BasePostMessageStream":1661,"./WebWorker/WebWorkerParentPostMessageStream":1662,"./WebWorker/WebWorkerPostMessageStream":1663,"./window/WindowPostMessageStream":1666},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./window/WindowPostMessageStream"),r),i(e("./WebWorker/WebWorkerPostMessageStream"),r),i(e("./WebWorker/WebWorkerParentPostMessageStream"),r),i(e("./BasePostMessageStream"),r)}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream"}],[1665,{"@metamask/utils":1730},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isValidStreamMessage=r.DEDICATED_WORKER_NAME=void 0;const n=e("@metamask/utils");r.DEDICATED_WORKER_NAME="dedicatedWorker",r.isValidStreamMessage=function(e){return(0,n.isObject)(e)&&Boolean(e.data)&&("number"==typeof e.data||"object"==typeof e.data||"string"==typeof e.data)}}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream"}],[1666,{"../BasePostMessageStream":1661,"../utils":1665},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.WindowPostMessageStream=void 0;const n=e("../BasePostMessageStream"),i=e("../utils");class s extends n.BasePostMessageStream{constructor({name:e,target:t,targetOrigin:r=location.origin,targetWindow:n=window}){if(super(),"undefined"==typeof window||"function"!=typeof window.postMessage)throw new Error("window.postMessage is not a function. This class should only be instantiated in a Window.");this._name=e,this._target=t,this._targetOrigin=r,this._targetWindow=n,this._onMessage=this._onMessage.bind(this),window.addEventListener("message",this._onMessage,!1),this._handshake()}_postMessage(e){this._targetWindow.postMessage({target:this._target,data:e},this._targetOrigin)}_onMessage(e){const t=e.data;"*"!==this._targetOrigin&&e.origin!==this._targetOrigin||e.source!==this._targetWindow||!(0,i.isValidStreamMessage)(t)||t.target!==this._name||this._onData(t.data)}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}r.WindowPostMessageStream=s}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream"}],[1667,{buffer:2434,inherits:4841,"readable-stream":1682},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("readable-stream").Writable,i=e("inherits"),s=Uint8Array;function a(e,t){if(!(this instanceof a))return new a(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var r=e.encoding,i=!1;r?"u8"!==(r=String(r).toLowerCase())&&"uint8"!==r||(r="uint8array"):i=!0,n.call(this,{objectMode:!0}),this.encoding=r,this.shouldInferEncoding=i,t&&this.on("finish",(function(){t(this.getBody())})),this.body=[]}function o(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}t.exports=a,i(a,n),a.prototype._write=function(e,t,r){this.body.push(e),r()},a.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return r.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},a.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],r=0;r<e.length;r++)t.push.apply(t,e[r]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];"string"==typeof i||r.isBuffer(i)?t.push(i):o(i)?t.push(r.from(i)):t.push(r.from(String(i)))}t=r.isBuffer(e[0])?(t=r.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];r.isBuffer(i)?t.push(i):o(i)?t.push(r.from(i)):t.push(r.from(String(i)))}return r.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]=r.from(e[n])),t+=e[n].length;for(var i=new s(t),a=(n=0,0);n<e.length;n++)for(var o=e[n],c=0;c<o.length;c++)i[a++]=o[c];return i}(this.body):this.body):[]}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snap-controllers>concat-stream"}],[1668,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n={};function i(e,t,r){r||(r=Error);var i=function(e){var r,n;function i(r,n,i){return e.call(this,function(e,r,n){return"string"==typeof t?t:t(e,r,n)}(r,n,i))||this}return n=e,(r=i).prototype=Object.create(n.prototype),r.prototype.constructor=r,r.__proto__=n,i}(r);i.prototype.name=r.name,i.prototype.code=e,n[e]=i}function s(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}i("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),i("ERR_INVALID_ARG_TYPE",(function(e,t,r){var n,i,a,o;if("string"==typeof t&&(i="not ",t.substr(!a||a<0?0:+a,i.length)===i)?(n="must not be",t=t.replace(/^not /,"")):n="must be",function(e,t,r){return(r===undefined||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))o="The ".concat(e," ").concat(n," ").concat(s(t,"type"));else{var c=function(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(c," ").concat(n," ").concat(s(t,"type"))}return o+=". Received type ".concat(typeof r)}),TypeError),i("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),i("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),i("ERR_STREAM_PREMATURE_CLOSE","Premature close"),i("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),i("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),i("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),i("ERR_STREAM_WRITE_AFTER_END","write after end"),i("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),i("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),i("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=n}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1669,{"./_stream_readable":1671,"./_stream_writable":1673,_process:5832,inherits:4841},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=u;var i=e("./_stream_readable"),s=e("./_stream_writable");e("inherits")(u,i);for(var a=n(s.prototype),o=0;o<a.length;o++){var c=a[o];u.prototype[c]||(u.prototype[c]=s.prototype[c])}function u(e){if(!(this instanceof u))return new u(e);i.call(this,e),s.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",l)))}function l(){this._writableState.ended||r.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[167,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){return new Promise((t=>setTimeout(t,e)))}async function i(e){const t=await window.fetch(`http://localhost:8889?key=${e}`),r=await t.text();return r.length?JSON.parse(r):null}t.exports=class{static openBox(e){return this.address=e,Promise.resolve({onSyncDone:e=>{setTimeout(e,200)},openSpace:async(e,t)=>{const{onSyncDone:r}=t;return this.spaceName=e,setTimeout(r,150),await n(50),{private:{get:async e=>{await n(50);return await i(`${this.address}-${this.spaceName}-${e}`)},set:async(e,t)=>(await async function(e,t){return(await window.fetch("http://localhost:8889",{method:"POST",body:JSON.stringify({key:e,data:t})})).text()}(`${this.address}-${this.spaceName}-${e}`,t),await n(50),null)}}},logout:()=>undefined})}static async getConfig(e){return await i(`${e}-metamask-metamaskBackup`)?{spaces:{metamask:{}}}:{}}}}}},{package:"$root$"}],[1670,{"./_stream_transform":1672,inherits:4841},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=i;var n=e("./_stream_transform");function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}e("inherits")(i,n),i.prototype._transform=function(e,t,r){r(null,e)}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1671,{"../errors":1668,"./_stream_duplex":1669,"./internal/streams/async_iterator":1674,"./internal/streams/buffer_list":1675,"./internal/streams/destroy":1676,"./internal/streams/from":1678,"./internal/streams/state":1680,"./internal/streams/stream":1681,_process:5832,buffer:2434,events:2435,inherits:4841,"string_decoder/":7039,util:2433},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n;t.exports=E,E.ReadableState=k;e("events").EventEmitter;var i=function(e,t){return e.listeners(t).length},s=e("./internal/streams/stream"),a=e("buffer").Buffer,o=global.Uint8Array||function(){};var c,u=e("util");c=u&&u.debuglog?u.debuglog("stream"):function(){};var l,d,h,f=e("./internal/streams/buffer_list"),p=e("./internal/streams/destroy"),m=e("./internal/streams/state").getHighWaterMark,g=e("../errors").codes,y=g.ERR_INVALID_ARG_TYPE,b=g.ERR_STREAM_PUSH_AFTER_EOF,v=g.ERR_METHOD_NOT_IMPLEMENTED,w=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(E,s);var _=p.errorOrDestroy,S=["error","close","destroy","pause","resume"];function k(t,r,i){n=n||e("./_stream_duplex"),t=t||{},"boolean"!=typeof i&&(i=r instanceof n),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=m(this,t,"readableHighWaterMark",i),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(l||(l=e("string_decoder/").StringDecoder),this.decoder=new l(t.encoding),this.encoding=t.encoding)}function E(t){if(n=n||e("./_stream_duplex"),!(this instanceof E))return new E(t);var r=this instanceof n;this._readableState=new k(t,this,r),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),s.call(this)}function P(e,t,r,n,i){c("readableAddChunk",t);var s,u=e._readableState;if(null===t)u.reading=!1,function(e,t){if(c("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?I(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,C(e)))}(e,u);else if(i||(s=function(e,t){var r;n=t,a.isBuffer(n)||n instanceof o||"string"==typeof t||t===undefined||e.objectMode||(r=new y("chunk",["string","Buffer","Uint8Array"],t));var n;return r}(u,t)),s)_(e,s);else if(u.objectMode||t&&t.length>0)if("string"==typeof t||u.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),n)u.endEmitted?_(e,new w):T(e,u,t,!0);else if(u.ended)_(e,new b);else{if(u.destroyed)return!1;u.reading=!1,u.decoder&&!r?(t=u.decoder.write(t),u.objectMode||0!==t.length?T(e,u,t,!1):x(e,u)):T(e,u,t,!1)}else n||(u.reading=!1,x(e,u));return!u.ended&&(u.length<u.highWaterMark||0===u.length)}function T(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&I(e)),x(e,t)}Object.defineProperty(E.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),E.prototype.destroy=p.destroy,E.prototype._undestroy=p.undestroy,E.prototype._destroy=function(e,t){t(e)},E.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=a.from(e,t),t=""),r=!0),P(this,e,t,!1,r)},E.prototype.unshift=function(e){return P(this,e,null,!0,!1)},E.prototype.isPaused=function(){return!1===this._readableState.flowing},E.prototype.setEncoding=function(t){l||(l=e("string_decoder/").StringDecoder);var r=new l(t);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,i="";null!==n;)i+=r.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var A=1073741824;function O(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function I(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,r.nextTick(C,e))}function C(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,B(e)}function x(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(N,e,t))}function N(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(c("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function M(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function j(e){c("readable nexttick read 0"),e.read(0)}function R(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),B(e),t.flowing&&!t.reading&&e.read(0)}function B(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function L(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function D(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(U,t,e))}function U(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function $(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}E.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?D(this):I(this),null;if(0===(e=O(e,t))&&t.ended)return 0===t.length&&D(this),null;var n,i=t.needReadable;return c("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",i=!0),t.ended||t.reading?c("reading or ended",i=!1):i&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=O(r,t))),null===(n=e>0?L(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&D(this)),null!==n&&this.emit("data",n),n},E.prototype._read=function(e){_(this,new v("_read()"))},E.prototype.pipe=function(e,t){var n=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,c("pipe count=%d opts=%j",s.pipesCount,t);var a=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?u:g;function o(t,r){c("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,c("cleanup"),e.removeListener("close",p),e.removeListener("finish",m),e.removeListener("drain",l),e.removeListener("error",f),e.removeListener("unpipe",o),n.removeListener("end",u),n.removeListener("end",g),n.removeListener("data",h),d=!0,!s.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function u(){c("onend"),e.end()}s.endEmitted?r.nextTick(a):n.once("end",a),e.on("unpipe",o);var l=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&i(e,"data")&&(t.flowing=!0,B(e))}}(n);e.on("drain",l);var d=!1;function h(t){c("ondata");var r=e.write(t);c("dest.write",r),!1===r&&((1===s.pipesCount&&s.pipes===e||s.pipesCount>1&&-1!==$(s.pipes,e))&&!d&&(c("false write response, pause",s.awaitDrain),s.awaitDrain++),n.pause())}function f(t){c("onerror",t),g(),e.removeListener("error",f),0===i(e,"error")&&_(e,t)}function p(){e.removeListener("finish",m),g()}function m(){c("onfinish"),e.removeListener("close",p),g()}function g(){c("unpipe"),n.unpipe(e)}return n.on("data",h),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",f),e.once("close",p),e.once("finish",m),e.emit("pipe",n),s.flowing||(c("pipe resume"),n.resume()),e},E.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var a=$(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},E.prototype.on=function(e,t){var n=s.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,c("on readable",i.length,i.reading),i.length?I(this):i.reading||r.nextTick(j,this))),n},E.prototype.addListener=E.prototype.on,E.prototype.removeListener=function(e,t){var n=s.prototype.removeListener.call(this,e,t);return"readable"===e&&r.nextTick(M,this),n},E.prototype.removeAllListeners=function(e){var t=s.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||r.nextTick(M,this),t},E.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(R,e,t))}(this,e)),e.paused=!1,this},E.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},E.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(c("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(c("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!==i&&i!==undefined)&&((r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause())))})),e)this[i]===undefined&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<S.length;s++)e.on(S[s],this.emit.bind(this,S[s]));return this._read=function(t){c("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(E.prototype[Symbol.asyncIterator]=function(){return d===undefined&&(d=e("./internal/streams/async_iterator")),d(this)}),Object.defineProperty(E.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(E.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(E.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),E._fromList=L,Object.defineProperty(E.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(E.from=function(t,r){return h===undefined&&(h=e("./internal/streams/from")),h(E,t,r)})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1672,{"../errors":1668,"./_stream_duplex":1669,inherits:4841},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=l;var n=e("../errors").codes,i=n.ERR_METHOD_NOT_IMPLEMENTED,s=n.ERR_MULTIPLE_CALLBACK,a=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=n.ERR_TRANSFORM_WITH_LENGTH_0,c=e("./_stream_duplex");function u(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new s);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function l(e){if(!(this instanceof l))return new l(e);c.call(this,e),this._transformState={afterTransform:u.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?h(this,null,null):this._flush((function(t,r){h(e,t,r)}))}function h(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new o;if(e._transformState.transforming)throw new a;return e.push(null)}e("inherits")(l,c),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,r){r(new i("_transform()"))},l.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,(function(e){t(e)}))}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1673,{"../errors":1668,"./_stream_duplex":1669,"./internal/streams/destroy":1676,"./internal/streams/state":1680,"./internal/streams/stream":1681,_process:5832,buffer:2434,inherits:4841,"util-deprecate":7147},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){function n(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var i;t.exports=E,E.WritableState=k;var s={deprecate:e("util-deprecate")},a=e("./internal/streams/stream"),o=e("buffer").Buffer,c=global.Uint8Array||function(){};var u,l=e("./internal/streams/destroy"),d=e("./internal/streams/state").getHighWaterMark,h=e("../errors").codes,f=h.ERR_INVALID_ARG_TYPE,p=h.ERR_METHOD_NOT_IMPLEMENTED,m=h.ERR_MULTIPLE_CALLBACK,g=h.ERR_STREAM_CANNOT_PIPE,y=h.ERR_STREAM_DESTROYED,b=h.ERR_STREAM_NULL_VALUES,v=h.ERR_STREAM_WRITE_AFTER_END,w=h.ERR_UNKNOWN_ENCODING,_=l.errorOrDestroy;function S(){}function k(t,s,a){i=i||e("./_stream_duplex"),t=t||{},"boolean"!=typeof a&&(a=s instanceof i),this.objectMode=!!t.objectMode,a&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=d(this,t,"writableHighWaterMark",a),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,s=n.writecb;if("function"!=typeof s)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,s){--t.pendingcb,n?(r.nextTick(s,i),r.nextTick(C,e,t),e._writableState.errorEmitted=!0,_(e,i)):(s(i),e._writableState.errorEmitted=!0,_(e,i),C(e,t))}(e,n,i,t,s);else{var a=O(n)||e.destroyed;a||n.corked||n.bufferProcessing||!n.bufferedRequest||A(e,n),i?r.nextTick(T,e,n,a,s):T(e,n,a,s)}}(s,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}function E(t){var r=this instanceof(i=i||e("./_stream_duplex"));if(!r&&!u.call(E,this))return new E(t);this._writableState=new k(t,this,r),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),a.call(this)}function P(e,t,r,n,i,s,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new y("write")):r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function T(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),C(e,t)}function A(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,s=new Array(i),a=t.corkedRequestsFree;a.entry=r;for(var o=0,c=!0;r;)s[o]=r,r.isBuf||(c=!1),r=r.next,o+=1;s.allBuffers=c,P(e,t,!0,t.length,s,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new n(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,l=r.encoding,d=r.callback;if(P(e,t,!1,t.objectMode?1:u.length,u,l,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function O(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function I(e,t){e._final((function(r){t.pendingcb--,r&&_(e,r),t.prefinished=!0,e.emit("prefinish"),C(e,t)}))}function C(e,t){var n=O(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,r.nextTick(I,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return n}e("inherits")(E,a),k.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(k.prototype,"buffer",{get:s.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(E,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===E&&(e&&e._writableState instanceof k)}})):u=function(e){return e instanceof this},E.prototype.pipe=function(){_(this,new g)},E.prototype.write=function(e,t,n){var i,s=this._writableState,a=!1,u=!s.objectMode&&(i=e,o.isBuffer(i)||i instanceof c);return u&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(n=t,t=null),u?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof n&&(n=S),s.ending?function(e,t){var n=new v;_(e,n),r.nextTick(t,n)}(this,n):(u||function(e,t,n,i){var s;return null===n?s=new b:"string"==typeof n||t.objectMode||(s=new f("chunk",["string","Buffer"],n)),!s||(_(e,s),r.nextTick(i,s),!1)}(this,s,e,n))&&(s.pendingcb++,a=function(e,t,r,n,i,s){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,r));return t}(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var c=t.objectMode?1:n.length;t.length+=c;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else P(e,t,!1,c,n,i,s);return u}(this,s,u,e,t,n)),a},E.prototype.cork=function(){this._writableState.corked++},E.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||A(this,e))},E.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new w(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(E.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(E.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),E.prototype._write=function(e,t,r){r(new p("_write()"))},E.prototype._writev=null,E.prototype.end=function(e,t,n){var i=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&e!==undefined&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,n){t.ending=!0,C(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n),this},Object.defineProperty(E.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(E.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),E.prototype.destroy=l.destroy,E.prototype._undestroy=l.undestroy,E.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1674,{"./end-of-stream":1677,_process:5832},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n;function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=e("./end-of-stream"),a=Symbol("lastResolve"),o=Symbol("lastReject"),c=Symbol("error"),u=Symbol("ended"),l=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function f(e,t){return{value:e,done:t}}function p(e){var t=e[a];if(null!==t){var r=e[h].read();null!==r&&(e[l]=null,e[a]=null,e[o]=null,t(f(r,!1)))}}function m(e){r.nextTick(p,e)}var g=Object.getPrototypeOf((function(){})),y=Object.setPrototypeOf((i(n={get stream(){return this[h]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[u])return Promise.resolve(f(undefined,!0));if(this[h].destroyed)return new Promise((function(t,n){r.nextTick((function(){e[c]?n(e[c]):t(f(undefined,!0))}))}));var n,i=this[l];if(i)n=new Promise(function(e,t){return function(r,n){e.then((function(){t[u]?r(f(undefined,!0)):t[d](r,n)}),n)}}(i,this));else{var s=this[h].read();if(null!==s)return Promise.resolve(f(s,!1));n=new Promise(this[d])}return this[l]=n,n}},Symbol.asyncIterator,(function(){return this})),i(n,"return",(function(){var e=this;return new Promise((function(t,r){e[h].destroy(null,(function(e){e?r(e):t(f(undefined,!0))}))}))})),n),g);t.exports=function(e){var t,r=Object.create(y,(i(t={},h,{value:e,writable:!0}),i(t,a,{value:null,writable:!0}),i(t,o,{value:null,writable:!0}),i(t,c,{value:null,writable:!0}),i(t,u,{value:e._readableState.endEmitted,writable:!0}),i(t,d,{value:function(e,t){var n=r[h].read();n?(r[l]=null,r[a]=null,r[o]=null,e(f(n,!1))):(r[a]=e,r[o]=t)},writable:!0}),t));return r[l]=null,s(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[o];return null!==t&&(r[l]=null,r[a]=null,r[o]=null,t(e)),void(r[c]=e)}var n=r[a];null!==n&&(r[l]=null,r[a]=null,r[o]=null,n(f(undefined,!0))),r[u]=!0})),e.on("readable",m.bind(null,r)),r}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1675,{buffer:2434,util:2433},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=e("buffer").Buffer,o=e("util").inspect,c=o&&o.custom||"inspect";t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,r,u;return t=e,r=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return a.alloc(0);for(var t,r,n,i=a.allocUnsafe(e>>>0),s=this.head,o=0;s;)t=s.data,r=i,n=o,a.prototype.copy.call(t,r,n),o+=s.data.length,s=s.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,s=e>i.length?i.length:e;if(s===i.length?n+=i:n+=i.slice(0,e),0==(e-=s)){s===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(s));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=a.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,s=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,s),0==(e-=s)){s===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(s));break}++n}return this.length-=n,t}},{key:c,value:function(e,t){return o(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],r&&s(t.prototype,r),u&&s(t,u),e}()}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1676,{_process:5832},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){function r(e,t){i(e,t),n(e)}function n(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function i(e,t){e.emit("error",t)}t.exports={destroy:function(t,s){var a=this,o=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return o||c?(s?s(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(i,this,t)):e.nextTick(i,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!s&&t?a._writableState?a._writableState.errorEmitted?e.nextTick(n,a):(a._writableState.errorEmitted=!0,e.nextTick(r,a,t)):e.nextTick(r,a,t):s?(e.nextTick(n,a),s(t)):e.nextTick(n,a)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1677,{"../../../errors":1668},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function i(){}t.exports=function e(t,r,s){if("function"==typeof r)return e(t,null,r);r||(r={}),s=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(s||i);var a=r.readable||!1!==r.readable&&t.readable,o=r.writable||!1!==r.writable&&t.writable,c=function(){t.writable||l()},u=t._writableState&&t._writableState.finished,l=function(){o=!1,u=!0,a||s.call(t)},d=t._readableState&&t._readableState.endEmitted,h=function(){a=!1,d=!0,o||s.call(t)},f=function(e){s.call(t,e)},p=function(){var e;return a&&!d?(t._readableState&&t._readableState.ended||(e=new n),s.call(t,e)):o&&!u?(t._writableState&&t._writableState.ended||(e=new n),s.call(t,e)):void 0},m=function(){t.req.on("finish",l)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",c),t.on("close",c)):(t.on("complete",l),t.on("abort",p),t.req?m():t.on("request",m)),t.on("end",h),t.on("finish",l),!1!==r.error&&t.on("error",f),t.on("close",p),function(){t.removeListener("complete",l),t.removeListener("abort",p),t.removeListener("request",m),t.req&&t.req.removeListener("finish",l),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",l),t.removeListener("end",h),t.removeListener("error",f),t.removeListener("close",p)}}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1678,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1679,{"../../../errors":1668,"./end-of-stream":1677},function(){with(this)return function(){"use strict";return function(e,t,r){var n;var i=e("../../../errors").codes,s=i.ERR_MISSING_ARGS,a=i.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function c(t,r,i,s){s=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(s);var o=!1;t.on("close",(function(){o=!0})),n===undefined&&(n=e("./end-of-stream")),n(t,{readable:r,writable:i},(function(e){if(e)return s(e);o=!0,s()}));var c=!1;return function(e){if(!o&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void s(e||new a("pipe"))}}function u(e){e()}function l(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}t.exports=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new s("streams");var a=t.map((function(e,r){var s=r<t.length-1;return c(e,s,r>0,(function(e){n||(n=e),e&&a.forEach(u),s||(a.forEach(u),i(n))}))}));return t.reduce(l)}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[168,{"./legacyIpfs3boxAccessController":169,"./moderatorAccessController":170,"./odbIdentityProvider":171,"./threadAccessController":172},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./odbIdentityProvider"),i=e("./moderatorAccessController"),s=e("./threadAccessController"),a=e("./legacyIpfs3boxAccessController");t.exports={OdbIdentityProvider:n,ModeratorAccessController:i,ThreadAccessController:s,LegacyIPFS3BoxAccessController:a}}}},{package:"3box>3box-orbitdb-plugins"}],[1680,{"../../../errors":1668},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,r,i){var s=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,i,r);if(null!=s){if(!isFinite(s)||Math.floor(s)!==s||s<0)throw new n(i?r:"highWaterMark",s);return Math.floor(s)}return e.objectMode?16:16384}}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1681,{events:2435},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("events").EventEmitter}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1682,{"./lib/_stream_duplex.js":1669,"./lib/_stream_passthrough.js":1670,"./lib/_stream_readable.js":1671,"./lib/_stream_transform.js":1672,"./lib/_stream_writable.js":1673,"./lib/internal/streams/end-of-stream.js":1677,"./lib/internal/streams/pipeline.js":1679},function(){with(this)return function(){"use strict";return function(e,t,r){(r=t.exports=e("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js"),r.finished=e("./lib/internal/streams/end-of-stream.js"),r.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1683,{"readable-stream":1695},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});const n=e("readable-stream");r.default=function(e){if(!e||!e.engine)throw new Error("Missing engine parameter!");const{engine:t}=e,r=new n.Duplex({objectMode:!0,read:function(){return undefined},write:function(e,n,i){t.handle(e,((e,t)=>{r.push(t)})),i()}});return t.on&&t.on("notification",(e=>{r.push(e)})),r}}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream"}],[1684,{"@metamask/safe-event-emitter":1629,"readable-stream":1695},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=n(e("@metamask/safe-event-emitter")),s=e("readable-stream");r.default=function(){const e={},t=new s.Duplex({objectMode:!0,read:function(){return!1},write:function(t,n,i){let s;try{!t.id?function(e){r.emit("notification",e)}(t):function(t){const r=e[t.id];if(!r)throw new Error(`StreamMiddleware - Unknown response id "${t.id}"`);delete e[t.id],Object.assign(r.res,t),setTimeout(r.end)}(t)}catch(e){s=e}i(s)}}),r=new i.default;return{events:r,middleware:(r,n,i,s)=>{t.push(r),e[r.id]={req:r,res:n,next:i,end:s}},stream:t}}}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream"}],[1685,{"./createEngineStream":1683,"./createStreamMiddleware":1684},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.createStreamMiddleware=r.createEngineStream=void 0;const i=n(e("./createEngineStream"));r.createEngineStream=i.default;const s=n(e("./createStreamMiddleware"));r.createStreamMiddleware=s.default}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream"}],[1686,{_process:5832},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){void 0===e||!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,r,n,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var s,a,o=arguments.length;switch(o){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick((function(){t.call(null,r)}));case 3:return e.nextTick((function(){t.call(null,r,n)}));case 4:return e.nextTick((function(){t.call(null,r,n,i)}));default:for(s=new Array(o-1),a=0;a<s.length;)s[a++]=arguments[a];return e.nextTick((function(){t.apply(null,s)}))}}}:t.exports=e}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream>process-nextick-args"}],[1687,{"./_stream_readable":1689,"./_stream_writable":1691,"core-util-is":2519,inherits:4841,"process-nextick-args":1686},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("process-nextick-args"),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=d;var s=Object.create(e("core-util-is"));s.inherits=e("inherits");var a=e("./_stream_readable"),o=e("./_stream_writable");s.inherits(d,a);for(var c=i(o.prototype),u=0;u<c.length;u++){var l=c[u];d.prototype[l]||(d.prototype[l]=o.prototype[l])}function d(e){if(!(this instanceof d))return new d(e);a.call(this,e),o.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||n.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream"}],[1688,{"./_stream_transform":1690,"core-util-is":2519,inherits:4841},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=s;var n=e("./_stream_transform"),i=Object.create(e("core-util-is"));function s(e){if(!(this instanceof s))return new s(e);n.call(this,e)}i.inherits=e("inherits"),i.inherits(s,n),s.prototype._transform=function(e,t,r){r(null,e)}}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream"}],[1689,{"./_stream_duplex":1687,"./internal/streams/BufferList":1692,"./internal/streams/destroy":1693,"./internal/streams/stream":1694,_process:5832,"core-util-is":2519,events:2435,inherits:4841,isarray:5147,"process-nextick-args":1686,"safe-buffer":1709,"string_decoder/":1696,util:2433},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("process-nextick-args");t.exports=b;var i,s=e("isarray");b.ReadableState=y;e("events").EventEmitter;var a=function(e,t){return e.listeners(t).length},o=e("./internal/streams/stream"),c=e("safe-buffer").Buffer,u=global.Uint8Array||function(){};var l=Object.create(e("core-util-is"));l.inherits=e("inherits");var d=e("util"),h=void 0;h=d&&d.debuglog?d.debuglog("stream"):function(){};var f,p=e("./internal/streams/BufferList"),m=e("./internal/streams/destroy");l.inherits(b,o);var g=["error","close","destroy","pause","resume"];function y(t,r){t=t||{};var n=r instanceof(i=i||e("./_stream_duplex"));this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var s=t.highWaterMark,a=t.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=s||0===s?s:n&&(a||0===a)?a:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(f||(f=e("string_decoder/").StringDecoder),this.decoder=new f(t.encoding),this.encoding=t.encoding)}function b(t){if(i=i||e("./_stream_duplex"),!(this instanceof b))return new b(t);this._readableState=new y(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),o.call(this)}function v(e,t,r,n,i){var s,a=e._readableState;null===t?(a.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,k(e)}(e,a)):(i||(s=function(e,t){var r;n=t,c.isBuffer(n)||n instanceof u||"string"==typeof t||t===undefined||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(a,t)),s?e.emit("error",s):a.objectMode||t&&t.length>0?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),n?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?w(e,a,t,!1):P(e,a)):w(e,a,t,!1))):n||(a.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(a)}function w(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&k(e)),P(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=m.destroy,b.prototype._undestroy=m.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=c.from(e,t),t=""),r=!0),v(this,e,t,!1,r)},b.prototype.unshift=function(e){return v(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(t){return f||(f=e("string_decoder/").StringDecoder),this._readableState.decoder=new f(t),this._readableState.encoding=t,this};var _=8388608;function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=_?e=_:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function k(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(h("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?n.nextTick(E,e):E(e))}function E(e){h("emit readable"),e.emit("readable"),I(e)}function P(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(T,e,t))}function T(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(h("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function A(e){h("readable nexttick read 0"),e.read(0)}function O(e,t){t.reading||(h("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),I(e),t.flowing&&!t.reading&&e.read(0)}function I(e){var t=e._readableState;for(h("flow",t.flowing);t.flowing&&null!==e.read(););}function C(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var s=r.data,a=e>s.length?s.length:e;if(a===s.length?i+=s:i+=s.slice(0,e),0===(e-=a)){a===s.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=s.slice(a));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=c.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var s=n.data,a=e>s.length?s.length:e;if(s.copy(r,r.length-e,0,a),0===(e-=a)){a===s.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(a));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function x(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,n.nextTick(N,t,e))}function N(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function M(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}b.prototype.read=function(e){h("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):k(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&x(this),null;var n,i=t.needReadable;return h("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&h("length less than watermark",i=!0),t.ended||t.reading?h("reading or ended",i=!1):i&&(h("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(r,t))),null===(n=e>0?C(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&x(this)),null!==n&&this.emit("data",n),n},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var i=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,h("pipe count=%d opts=%j",o.pipesCount,t);var c=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?l:v;function u(t,r){h("onunpipe"),t===i&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,h("cleanup"),e.removeListener("close",y),e.removeListener("finish",b),e.removeListener("drain",d),e.removeListener("error",g),e.removeListener("unpipe",u),i.removeListener("end",l),i.removeListener("end",v),i.removeListener("data",m),f=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||d())}function l(){h("onend"),e.end()}o.endEmitted?n.nextTick(c):i.once("end",c),e.on("unpipe",u);var d=function(e){return function(){var t=e._readableState;h("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,I(e))}}(i);e.on("drain",d);var f=!1;var p=!1;function m(t){h("ondata"),p=!1,!1!==e.write(t)||p||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==M(o.pipes,e))&&!f&&(h("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,p=!0),i.pause())}function g(t){h("onerror",t),v(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",b),v()}function b(){h("onfinish"),e.removeListener("close",y),v()}function v(){h("unpipe"),i.unpipe(e)}return i.on("data",m),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",g),e.once("close",y),e.once("finish",b),e.emit("pipe",i),o.flowing||(h("pipe resume"),i.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,r);return this}var a=M(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},b.prototype.on=function(e,t){var r=o.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&k(this):n.nextTick(A,this))}return r},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(h("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(O,e,t))}(this,e)),this},b.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(h("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(h("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!==i&&i!==undefined)&&((r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause())))})),e)this[i]===undefined&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<g.length;s++)e.on(g[s],this.emit.bind(this,g[s]));return this._read=function(t){h("wrapped _read",t),n&&(n=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=C}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream"}],[169,{"did-resolver":2639,"orbit-db-io":5755,"safe-buffer":6870},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("orbit-db-io"),i=e("safe-buffer").Buffer,s=e("did-resolver").default;class a{constructor(e,t){this._ipfs=e,this._write=Array.from(t.write||[])}static get type(){return"legacy-ipfs-3box"}get write(){return this._write}async canAppend(e,t){const r=0===e.v?e.key:await(async e=>{const t=await s(e);return t.publicKey.find((e=>{const r=e.id.split("#");return r[0]===t.id&&("subSigningKey"===r[1]||"signingKey"===r[1])})).publicKeyHex})(e.identity.id);return!(!this.write.includes(r)&&!this.write.includes("*"))&&(0===e.v||await t.verifyIdentity(e.identity))}async load(e){0===e.indexOf("/ipfs")&&(e=e.split("/")[2]);try{const t=await n.read(this._ipfs,e);this._write=t.write}catch(e){console.log("LegacyIPFS3BoxAccessController.load ERROR:",e)}}async save(e){let t;const r={admin:[],write:this.write,read:[]};try{t=await n.write(this._ipfs,"raw",i.from(JSON.stringify(r,null,2)),{format:"dag-pb"})}catch(e){console.log("LegacyIPFS3BoxAccessController.save ERROR:",e)}return{address:t,skipManifest:!0}}static async create(e,t={}){return t={...t,write:t.write||[e.identity.publicKey]},new a(e._ipfs,t)}}t.exports=a}}},{package:"3box>3box-orbitdb-plugins"}],[1690,{"./_stream_duplex":1687,"core-util-is":2519,inherits:4841},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=a;var n=e("./_stream_duplex"),i=Object.create(e("core-util-is"));function s(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function a(e){if(!(this instanceof a))return new a(e);n.call(this,e),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,r){c(e,t,r)})):c(this,null,null)}function c(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(a,n),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,(function(e){t(e),r.emit("close")}))}}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream"}],[1691,{"./_stream_duplex":1687,"./internal/streams/destroy":1693,"./internal/streams/stream":1694,_process:5832,"core-util-is":2519,inherits:4841,"process-nextick-args":1686,"safe-buffer":1709,timers:7070,"util-deprecate":7147},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r,n){(function(){var i=e("process-nextick-args");function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}t.exports=y;var a,o=!r.browser&&["v0.10","v0.9."].indexOf(r.version.slice(0,5))>-1?n:i.nextTick;y.WritableState=g;var c=Object.create(e("core-util-is"));c.inherits=e("inherits");var u={deprecate:e("util-deprecate")},l=e("./internal/streams/stream"),d=e("safe-buffer").Buffer,h=global.Uint8Array||function(){};var f,p=e("./internal/streams/destroy");function m(){}function g(t,r){a=a||e("./_stream_duplex"),t=t||{};var n=r instanceof a;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var c=t.highWaterMark,u=t.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=c||0===c?c:n&&(u||0===u)?u:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var d=!1===t.decodeStrings;this.decodeStrings=!d,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,s=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,s){--t.pendingcb,r?(i.nextTick(s,n),i.nextTick(k,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(s(n),e._writableState.errorEmitted=!0,e.emit("error",n),k(e,t))}(e,r,n,t,s);else{var a=_(r);a||r.corked||r.bufferProcessing||!r.bufferedRequest||w(e,r),n?o(v,e,r,a,s):v(e,r,a,s)}}(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function y(t){if(a=a||e("./_stream_duplex"),!(f.call(y,this)||this instanceof a))return new y(t);this._writableState=new g(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),l.call(this)}function b(e,t,r,n,i,s,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function v(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),k(e,t)}function w(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),a=t.corkedRequestsFree;a.entry=r;for(var o=0,c=!0;r;)i[o]=r,r.isBuf||(c=!1),r=r.next,o+=1;i.allBuffers=c,b(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,l=r.encoding,d=r.callback;if(b(e,t,!1,t.objectMode?1:u.length,u,l,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function _(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(e,t){e._final((function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),k(e,t)}))}function k(e,t){var r=_(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,i.nextTick(S,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}c.inherits(y,l),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:u.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===y&&(e&&e._writableState instanceof g)}})):f=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,r){var n,s=this._writableState,a=!1,o=!s.objectMode&&(n=e,d.isBuffer(n)||n instanceof h);return o&&!d.isBuffer(e)&&(e=function(e){return d.from(e)}(e)),"function"==typeof t&&(r=t,t=null),o?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof r&&(r=m),s.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),i.nextTick(t,r)}(this,r):(o||function(e,t,r,n){var s=!0,a=!1;return null===r?a=new TypeError("May not write null values to stream"):"string"==typeof r||r===undefined||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),i.nextTick(n,a),s=!1),s}(this,s,e,r))&&(s.pendingcb++,a=function(e,t,r,n,i,s){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=d.from(t,r));return t}(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var o=t.objectMode?1:n.length;t.length+=o;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,o,n,i,s);return c}(this,s,o,e,t,r)),a},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&e!==undefined&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,k(e,t),r&&(t.finished?i.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=p.destroy,y.prototype._undestroy=p.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this)}).call(this,e("_process"),e("timers").setImmediate)}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream"}],[1692,{"safe-buffer":1709,util:2433},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("safe-buffer").Buffer,i=e("util");t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,s=n.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=a.data,r=s,i=o,t.copy(r,i),o+=a.data.length,a=a.next;return s},e}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream"}],[1693,{"process-nextick-args":1686},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("process-nextick-args");function i(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var r=this,s=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return s||a?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream"}],[1694,{events:2435},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("events").EventEmitter}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream"}],[1695,{"./lib/_stream_duplex.js":1687,"./lib/_stream_passthrough.js":1688,"./lib/_stream_readable.js":1689,"./lib/_stream_transform.js":1690,"./lib/_stream_writable.js":1691},function(){with(this)return function(){"use strict";return function(e,t,r){(r=t.exports=e("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream"}],[1696,{"safe-buffer":1709},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("safe-buffer").Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=l,this.end=d,t=3;break;default:return this.write=h,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return r!==undefined?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function l(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}r.StringDecoder=s,s.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if((t=this.fillLast(e))===undefined)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},s.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=a(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=a(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=a(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream>string_decoder"}],[1697,{"./url-alphabet/index.cjs":1698},function(){with(this)return function(){"use strict";return function(e,t,r){let{urlAlphabet:n}=e("./url-alphabet/index.cjs"),i=e=>crypto.getRandomValues(new Uint8Array(e)),s=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,i=-~(1.6*n*t/e.length);return(s=t)=>{let a="";for(;;){let t=r(i),o=i;for(;o--;)if(a+=e[t[o]&n]||"",a.length===s)return a}}};t.exports={nanoid:(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),""),customAlphabet:(e,t=21)=>s(e,t,i),customRandom:s,urlAlphabet:n,random:i}}}},{package:"@metamask/snap-controllers>nanoid"}],[1698,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"}}}},{package:"@metamask/snap-controllers>nanoid"}],[1699,{"./_stream_readable":1701,"./_stream_writable":1703,"core-util-is":2519,inherits:4841,"process-nextick-args":5831},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("process-nextick-args"),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=d;var s=e("core-util-is");s.inherits=e("inherits");var a=e("./_stream_readable"),o=e("./_stream_writable");s.inherits(d,a);for(var c=i(o.prototype),u=0;u<c.length;u++){var l=c[u];d.prototype[l]||(d.prototype[l]=o.prototype[l])}function d(e){if(!(this instanceof d))return new d(e);a.call(this,e),o.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||n(f,this)}function f(e){e.end()}Object.defineProperty(d.prototype,"destroyed",{get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),n(t,e)}}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream>readable-stream"}],[17,{"../../../../shared/constants/time":7327,"eth-block-tracker":2733,"eth-json-rpc-middleware":2771,"json-rpc-engine":5166},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({rpcUrl:e,chainId:t}){const r=(0,i.createFetchMiddleware)({rpcUrl:e}),c=(0,i.providerFromMiddleware)(r),u=new s.PollingBlockTracker({...a,provider:c});return{networkMiddleware:(0,n.mergeMiddleware)([o(t),(0,i.createBlockRefRewriteMiddleware)({blockTracker:u}),(0,i.createBlockCacheMiddleware)({blockTracker:u}),(0,i.createInflightCacheMiddleware)(),(0,i.createBlockTrackerInspectorMiddleware)({blockTracker:u}),r]),blockTracker:u}};var n=e("json-rpc-engine"),i=e("eth-json-rpc-middleware"),s=e("eth-block-tracker");e("../../../../shared/constants/time");const a={};function o(e){return(t,r,n,i)=>"eth_chainId"===t.method?(r.result=e,i()):n()}}}},{package:"$root$"}],[170,{},function(){with(this)return function(){"use strict";return function(e,t,r){const n="moderator-access",i="MODERATOR";class s{constructor(e,t){this._capabilityTypes=[i],this._write=[],this._firstModerator=e,this._write.push(this._firstModerator),this._members=Boolean(t.members),this._members&&this._capabilityTypes.push("MEMBER")}static get type(){return n}isMod(e){return this._write.includes(e)}isValidCapability(e){return this._capabilityTypes.includes(e)}get firstModerator(){return this._firstModerator}async canAppend(e,t){const r=e.identity.id,n=e.payload.value.capability,s=e.payload.value.id,a=this.isMod(r),o=this.isValidCapability(n);return!!(a&&o&&await(async()=>t.verifyIdentity(e.identity))())&&(n===i&&this._write.push(s),!0)}async load(e){const t=e.split("/"),r=t.pop();this._members="members"===r;const n=r.includes("mod")?r:t.pop();this._firstModerator=n.split("_")[1]}async save(){let e=`${n}/mod_${this._firstModerator}`;return e+=this._members?"/members":"",{address:e}}static async create(e,t={}){if(!t.firstModerator)throw new Error("Moderator AC: firstModerator required");return new s(t.firstModerator,t)}}t.exports=s}}},{package:"3box>3box-orbitdb-plugins"}],[1700,{"./_stream_transform":1702,"core-util-is":2519,inherits:4841},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=s;var n=e("./_stream_transform"),i=e("core-util-is");function s(e){if(!(this instanceof s))return new s(e);n.call(this,e)}i.inherits=e("inherits"),i.inherits(s,n),s.prototype._transform=function(e,t,r){r(null,e)}}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream>readable-stream"}],[1701,{"./_stream_duplex":1699,"./internal/streams/BufferList":1704,"./internal/streams/destroy":1705,"./internal/streams/stream":1706,_process:5832,"core-util-is":2519,events:2435,inherits:4841,isarray:5147,"process-nextick-args":5831,"safe-buffer":1709,"string_decoder/":1707,util:2433},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("process-nextick-args");t.exports=b;var i,s=e("isarray");b.ReadableState=y;e("events").EventEmitter;var a=function(e,t){return e.listeners(t).length},o=e("./internal/streams/stream"),c=e("safe-buffer").Buffer,u=global.Uint8Array||function(){};var l=e("core-util-is");l.inherits=e("inherits");var d=e("util"),h=void 0;h=d&&d.debuglog?d.debuglog("stream"):function(){};var f,p=e("./internal/streams/BufferList"),m=e("./internal/streams/destroy");l.inherits(b,o);var g=["error","close","destroy","pause","resume"];function y(t,r){i=i||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof i&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,s=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(f||(f=e("string_decoder/").StringDecoder),this.decoder=new f(t.encoding),this.encoding=t.encoding)}function b(t){if(i=i||e("./_stream_duplex"),!(this instanceof b))return new b(t);this._readableState=new y(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),o.call(this)}function v(e,t,r,n,i){var s,a=e._readableState;null===t?(a.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,k(e)}(e,a)):(i||(s=function(e,t){var r;n=t,c.isBuffer(n)||n instanceof u||"string"==typeof t||t===undefined||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(a,t)),s?e.emit("error",s):a.objectMode||t&&t.length>0?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),n?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?w(e,a,t,!1):P(e,a)):w(e,a,t,!1))):n||(a.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(a)}function w(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&k(e)),P(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=m.destroy,b.prototype._undestroy=m.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=c.from(e,t),t=""),r=!0),v(this,e,t,!1,r)},b.prototype.unshift=function(e){return v(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(t){return f||(f=e("string_decoder/").StringDecoder),this._readableState.decoder=new f(t),this._readableState.encoding=t,this};var _=8388608;function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=_?e=_:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function k(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(h("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?n(E,e):E(e))}function E(e){h("emit readable"),e.emit("readable"),I(e)}function P(e,t){t.readingMore||(t.readingMore=!0,n(T,e,t))}function T(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(h("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function A(e){h("readable nexttick read 0"),e.read(0)}function O(e,t){t.reading||(h("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),I(e),t.flowing&&!t.reading&&e.read(0)}function I(e){var t=e._readableState;for(h("flow",t.flowing);t.flowing&&null!==e.read(););}function C(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var s=r.data,a=e>s.length?s.length:e;if(a===s.length?i+=s:i+=s.slice(0,e),0===(e-=a)){a===s.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=s.slice(a));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=c.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var s=n.data,a=e>s.length?s.length:e;if(s.copy(r,r.length-e,0,a),0===(e-=a)){a===s.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(a));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function x(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,n(N,t,e))}function N(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function M(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}b.prototype.read=function(e){h("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):k(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&x(this),null;var n,i=t.needReadable;return h("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&h("length less than watermark",i=!0),t.ended||t.reading?h("reading or ended",i=!1):i&&(h("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(r,t))),null===(n=e>0?C(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&x(this)),null!==n&&this.emit("data",n),n},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var i=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,h("pipe count=%d opts=%j",o.pipesCount,t);var c=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?l:v;function u(t,r){h("onunpipe"),t===i&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,h("cleanup"),e.removeListener("close",y),e.removeListener("finish",b),e.removeListener("drain",d),e.removeListener("error",g),e.removeListener("unpipe",u),i.removeListener("end",l),i.removeListener("end",v),i.removeListener("data",m),f=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||d())}function l(){h("onend"),e.end()}o.endEmitted?n(c):i.once("end",c),e.on("unpipe",u);var d=function(e){return function(){var t=e._readableState;h("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,I(e))}}(i);e.on("drain",d);var f=!1;var p=!1;function m(t){h("ondata"),p=!1,!1!==e.write(t)||p||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==M(o.pipes,e))&&!f&&(h("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,p=!0),i.pause())}function g(t){h("onerror",t),v(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",b),v()}function b(){h("onfinish"),e.removeListener("close",y),v()}function v(){h("unpipe"),i.unpipe(e)}return i.on("data",m),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",g),e.once("close",y),e.once("finish",b),e.emit("pipe",i),o.flowing||(h("pipe resume"),i.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,r);return this}var a=M(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},b.prototype.on=function(e,t){var r=o.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&k(this):n(A,this))}return r},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(h("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n(O,e,t))}(this,e)),this},b.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;for(var i in e.on("end",(function(){if(h("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)})),e.on("data",(function(i){(h("wrapped data"),t.decoder&&(i=t.decoder.write(i)),!t.objectMode||null!==i&&i!==undefined)&&((t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause())))})),e)this[i]===undefined&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<g.length;s++)e.on(g[s],n.emit.bind(n,g[s]));return n._read=function(t){h("wrapped _read",t),r&&(r=!1,e.resume())},n},b._fromList=C}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream>readable-stream"}],[1702,{"./_stream_duplex":1699,"core-util-is":2519,inherits:4841},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=a;var n=e("./_stream_duplex"),i=e("core-util-is");function s(e){this.afterTransform=function(t,r){return function(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!==r&&r!==undefined&&e.push(r);i(t);var s=e._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&e._read(s.highWaterMark)}(e,t,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function a(e){if(!(this instanceof a))return new a(e);n.call(this,e),this._transformState=new s(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e,r){o(t,e,r)})):o(t)}))}function o(e,t,r){if(t)return e.emit("error",t);null!==r&&r!==undefined&&e.push(r);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(a,n),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,(function(e){t(e),r.emit("close")}))}}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream>readable-stream"}],[1703,{"./_stream_duplex":1699,"./internal/streams/destroy":1705,"./internal/streams/stream":1706,_process:5832,"core-util-is":2519,inherits:4841,"process-nextick-args":5831,"safe-buffer":1709,timers:7070,"util-deprecate":7147},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r,n){(function(){var i=e("process-nextick-args");function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}t.exports=y;var a,o=!r.browser&&["v0.10","v0.9."].indexOf(r.version.slice(0,5))>-1?n:i;y.WritableState=g;var c=e("core-util-is");c.inherits=e("inherits");var u={deprecate:e("util-deprecate")},l=e("./internal/streams/stream"),d=e("safe-buffer").Buffer,h=global.Uint8Array||function(){};var f,p=e("./internal/streams/destroy");function m(){}function g(t,r){a=a||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof a&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,c=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===t.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,s=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,s){--t.pendingcb,r?(i(s,n),i(k,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(s(n),e._writableState.errorEmitted=!0,e.emit("error",n),k(e,t))}(e,r,n,t,s);else{var a=_(r);a||r.corked||r.bufferProcessing||!r.bufferedRequest||w(e,r),n?o(v,e,r,a,s):v(e,r,a,s)}}(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function y(t){if(a=a||e("./_stream_duplex"),!(f.call(y,this)||this instanceof a))return new y(t);this._writableState=new g(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),l.call(this)}function b(e,t,r,n,i,s,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function v(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),k(e,t)}function w(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),a=t.corkedRequestsFree;a.entry=r;for(var o=0,c=!0;r;)i[o]=r,r.isBuf||(c=!1),r=r.next,o+=1;i.allBuffers=c,b(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new s(t)}else{for(;r;){var u=r.chunk,l=r.encoding,d=r.callback;if(b(e,t,!1,t.objectMode?1:u.length,u,l,d),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function _(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(e,t){e._final((function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),k(e,t)}))}function k(e,t){var r=_(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,i(S,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}c.inherits(y,l),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:u.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||e&&e._writableState instanceof g}})):f=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,r){var n,s=this._writableState,a=!1,o=(n=e,(d.isBuffer(n)||n instanceof h)&&!s.objectMode);return o&&!d.isBuffer(e)&&(e=function(e){return d.from(e)}(e)),"function"==typeof t&&(r=t,t=null),o?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof r&&(r=m),s.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),i(t,r)}(this,r):(o||function(e,t,r,n){var s=!0,a=!1;return null===r?a=new TypeError("May not write null values to stream"):"string"==typeof r||r===undefined||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),i(n,a),s=!1),s}(this,s,e,r))&&(s.pendingcb++,a=function(e,t,r,n,i,s){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=d.from(t,r));return t}(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var o=t.objectMode?1:n.length;t.length+=o;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,o,n,i,s);return c}(this,s,o,e,t,r)),a},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},y.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&e!==undefined&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,k(e,t),r&&(t.finished?i(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=p.destroy,y.prototype._undestroy=p.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this)}).call(this,e("_process"),e("timers").setImmediate)}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream>readable-stream"}],[1704,{"safe-buffer":1709},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("safe-buffer").Buffer;t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,s=n.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=a.data,r=s,i=o,t.copy(r,i),o+=a.data.length,a=a.next;return s},e}()}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream>readable-stream"}],[1705,{"process-nextick-args":5831},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("process-nextick-args");function i(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var r=this,s=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;s||a?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n(i,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(n(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream>readable-stream"}],[1706,{events:2435},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("events").EventEmitter}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream>readable-stream"}],[1707,{"safe-buffer":1709},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("safe-buffer").Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=l,this.end=d,t=3;break;default:return this.write=h,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function o(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"".repeat(r);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"".repeat(r+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"".repeat(r+2)}}(this,e,t);return r!==undefined?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function l(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}r.StringDecoder=s,s.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if((t=this.fillLast(e))===undefined)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"".repeat(this.lastTotal-this.lastNeed):t},s.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=a(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r)return 0;if((i=a(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r)return 0;if((i=a(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream>readable-stream>string_decoder"}],[1708,{"./lib/_stream_duplex.js":1699,"./lib/_stream_passthrough.js":1700,"./lib/_stream_readable.js":1701,"./lib/_stream_transform.js":1702,"./lib/_stream_writable.js":1703},function(){with(this)return function(){"use strict";return function(e,t,r){(r=t.exports=e("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")}}},{package:"@metamask/snap-controllers>@metamask/post-message-stream>readable-stream"}],[1709,{buffer:2434},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("buffer"),i=n.Buffer;function s(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(s(n,r),r.Buffer=a),s(i,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return t!==undefined?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream>readable-stream>safe-buffer"}],[171,{base64url:2276,"did-jwt":2638},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("base64url"),{verifyJWT:i}=e("did-jwt"),s=e=>n.encode(JSON.stringify(e)),a=s({typ:"JWT",alg:"ES256K"});t.exports=class{constructor({threeId:e}){this.threeId=e}static get type(){return"3ID"}async getId({space:e}){return e?this.threeId.getSubDID(e):this.threeId.DID}async signIdentity(e,{space:t}){const r={data:e,iat:null},n=t?{space:t}:{use3ID:!0};return(await this.threeId.signJWT(r,n)).split(".")[2]}static async verifyIdentity(e){const t=s({iat:null,data:e.publicKey+e.signatures.id,iss:e.id}),r=`${a}.${t}.${e.signatures.publicKey}`;try{await i(r,{auth:!0})}catch(e){return!1}return!0}}}}},{package:"3box>3box-orbitdb-plugins"}],[1710,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.assertExhaustive=r.assert=r.AssertionError=void 0;class n extends Error{constructor(e){super(e.message),this.code="ERR_ASSERTION"}}r.AssertionError=n,r.assert=function(e,t){if(!e){if(t instanceof Error)throw t;throw new n({message:null!=t?t:"Assertion failed"})}},r.assertExhaustive=function(e){throw new Error("Invalid branch reached. Should be detected during compilation")}}}},{package:"@metamask/snap-utils"}],[1711,{rfdc:6866},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.deepClone=void 0;const i=n(e("rfdc"));r.deepClone=(0,i.default)({proto:!1,circles:!1})}}},{package:"@metamask/snap-utils"}],[1712,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_ENDOWMENTS=void 0,r.DEFAULT_ENDOWMENTS=Object.freeze(["atob","btoa","BigInt","Buffer","console","crypto","Date","Math","setTimeout","clearTimeout","SubtleCrypto","TextDecoder","TextEncoder","URL","WebAssembly","setInterval","clearInterval","AbortController","AbortSignal"])}}},{package:"@metamask/snap-utils"}],[1713,{"./fs":1715,child_process:2432,path:5808},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.evalBundle=void 0;const n=e("path"),i=e("child_process"),s=e("./fs"),a=(0,n.join)(t,"eval-worker.js");r.evalBundle=async function(e){return await(0,s.validateFilePath)(e),new Promise(((t,r)=>{(0,i.fork)(a,[e]).on("exit",(e=>0===e?t(null):r(new Error(`Process exited with non-zero exit code: ${e}`))))}))}}).call(this)}).call(this,"/node_modules/@metamask/snap-utils/dist")}}},{package:"@metamask/snap-utils"}],[1714,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.flatMap=void 0;r.flatMap=(e,t)=>(e=>e.reduce(((e,t)=>Array.isArray(t)?[...e,...t]:[...e,t]),[]))(e.map(t))}}},{package:"@metamask/snap-utils"}],[1715,{fs:2432,path:5808},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.validateDirPath=r.validateFilePath=r.validateOutfileName=r.getOutfilePath=r.readSnapJsonFile=r.readJsonFile=r.isFile=r.isDirectory=void 0;const i=e("fs"),s=n(e("path"));async function a(e,t){try{return(await i.promises.stat(e)).isDirectory()}catch(r){return"ENOENT"===r.code&&(!!t&&(await i.promises.mkdir(e,{recursive:!0}),!0))}}async function o(e){try{return(await i.promises.stat(e)).isFile()}catch(e){return!1}}async function c(e){if(!e.endsWith(".json"))throw new Error('The specified file must be a ".json" file.');return JSON.parse(await i.promises.readFile(e,"utf8"))}r.isDirectory=a,r.isFile=o,r.readJsonFile=c,r.readSnapJsonFile=async function(e,t){const r=s.default.join(e,t);try{return await c(r)}catch(e){if("ENOENT"===e.code)throw new Error(`Could not find '${r}'. Please ensure that the file exists.`);throw e}},r.getOutfilePath=function(e,t){return s.default.join(e,t||"bundle.js")},r.validateOutfileName=function(e){if(!e.endsWith(".js")||".js"===e||s.default.basename(e)!==e)throw new Error(`Invalid outfile name: ${e}. Must be a .js file`);return!0},r.validateFilePath=async function(e){if(!await o(e))throw new Error(`Invalid params: '${e}' is not a file or does not exist.`);return!0},r.validateDirPath=async function(e,t){if(!await a(e,t))throw new Error(`Invalid params: '${e}' is not a directory or could not be created.`);return!0}}}},{package:"@metamask/snap-utils"}],[1716,{"./assert":1710,"./deep-clone":1711,"./default-endowments":1712,"./eval":1713,"./flatMap":1714,"./fs":1715,"./json-schemas":1717,"./manifest":1720,"./mock":1721,"./npm":1722,"./object":1723,"./post-process":1724,"./snaps":1725,"./types":1726,"./url":1727,"./versions":1728},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./assert"),r),i(e("./deep-clone"),r),i(e("./default-endowments"),r),i(e("./eval"),r),i(e("./fs"),r),i(e("./json-schemas"),r),i(e("./manifest"),r),i(e("./mock"),r),i(e("./npm"),r),i(e("./object"),r),i(e("./post-process"),r),i(e("./snaps"),r),i(e("./types"),r),i(e("./url"),r),i(e("./versions"),r),i(e("./flatMap"),r)}}},{package:"@metamask/snap-utils"}],[1717,{"../types":1726,"./validateNpmSnapPackageJson.js":1718,"./validateSnapManifest.js":1719},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.validateSnapJsonFile=void 0;const i=e("../types"),s=n(e("./validateNpmSnapPackageJson.js")),a=n(e("./validateSnapManifest.js"));r.validateSnapJsonFile=function(e,t){let r;switch(e){case i.NpmSnapFileNames.Manifest:t&&"object"==typeof t&&!Array.isArray(t)&&t.repository===undefined&&(t.repository=null),r=(0,a.default)(t);break;case i.NpmSnapFileNames.PackageJson:r=(0,s.default)(t);break;default:throw new Error(`Unrecognized file name "${e}".`)}if(r&&0!==r.length)throw new Error(`${r.reduce(((e,t={})=>{const{instancePath:r,message:n="unknown error"}=t;return`${e}${r?`\t${r}\n\t${n}\n\n`:`\t${n}\n\n`}`}),"").replace(/\n$/u,"")}`)}}}},{package:"@metamask/snap-utils"}],[1718,{"ajv/dist/runtime/ucs2length":1729},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=o,t.exports.default=o;const n={title:"npm Snap package.json",type:"object",required:["version","name"],properties:{version:{type:"string",title:"Version",pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},name:{type:"string",title:"Package Name",minLength:1,maxLength:214,pattern:"^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$"},private:{type:"boolean",title:"Private"},main:{type:"string",title:"Main",minLength:1},publishConfig:{type:"object",title:"Publish Config",required:["registry"],properties:{access:{type:"string",minLength:1},registry:{type:"string",enum:["https://registry.npmjs.org","https://registry.npmjs.org/"]}}},repository:{type:"object",title:"Repository",additionalProperties:!1,required:["type","url"],properties:{type:{type:"string",minLength:1},url:{type:"string",minLength:1}}}}},i=new RegExp("^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$","u"),s=new RegExp("^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$","u"),a=e("ajv/dist/runtime/ucs2length").default;function o(e,{instancePath:t="",parentData:r,parentDataProperty:c,rootData:u=e}={}){let l=null;if(e&&"object"==typeof e&&!Array.isArray(e)){if(e.version===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"version"},message:"must have required property '"+"version"+"'"};null===l?l=[e]:l.push(e)}if(e.name===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"name"},message:"must have required property '"+"name"+"'"};null===l?l=[e]:l.push(e)}if(e.version!==undefined){let r=e.version;if("string"==typeof r){if(!i.test(r)){const e={instancePath:t+"/version",schemaPath:"#/properties/version/pattern",keyword:"pattern",params:{pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},message:'must match pattern "'+"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"+'"'};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/version",schemaPath:"#/properties/version/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(e.name!==undefined){let r=e.name;if("string"==typeof r){if(a(r)>214){const e={instancePath:t+"/name",schemaPath:"#/properties/name/maxLength",keyword:"maxLength",params:{limit:214},message:"must NOT have more than 214 characters"};null===l?l=[e]:l.push(e)}if(a(r)<1){const e={instancePath:t+"/name",schemaPath:"#/properties/name/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}if(!s.test(r)){const e={instancePath:t+"/name",schemaPath:"#/properties/name/pattern",keyword:"pattern",params:{pattern:"^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$"},message:'must match pattern "'+"^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$"+'"'};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/name",schemaPath:"#/properties/name/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(e.private!==undefined&&"boolean"!=typeof e.private){const e={instancePath:t+"/private",schemaPath:"#/properties/private/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};null===l?l=[e]:l.push(e)}if(e.main!==undefined){let r=e.main;if("string"==typeof r){if(a(r)<1){const e={instancePath:t+"/main",schemaPath:"#/properties/main/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/main",schemaPath:"#/properties/main/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(e.publishConfig!==undefined){let r=e.publishConfig;if(r&&"object"==typeof r&&!Array.isArray(r)){if(r.registry===undefined){const e={instancePath:t+"/publishConfig",schemaPath:"#/properties/publishConfig/required",keyword:"required",params:{missingProperty:"registry"},message:"must have required property '"+"registry"+"'"};null===l?l=[e]:l.push(e)}if(r.access!==undefined){let e=r.access;if("string"==typeof e){if(a(e)<1){const e={instancePath:t+"/publishConfig/access",schemaPath:"#/properties/publishConfig/properties/access/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/publishConfig/access",schemaPath:"#/properties/publishConfig/properties/access/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(r.registry!==undefined){let e=r.registry;if("string"!=typeof e){const e={instancePath:t+"/publishConfig/registry",schemaPath:"#/properties/publishConfig/properties/registry/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}if("https://registry.npmjs.org"!==e&&"https://registry.npmjs.org/"!==e){const e={instancePath:t+"/publishConfig/registry",schemaPath:"#/properties/publishConfig/properties/registry/enum",keyword:"enum",params:{allowedValues:n.properties.publishConfig.properties.registry.enum},message:"must be equal to one of the allowed values"};null===l?l=[e]:l.push(e)}}}else{const e={instancePath:t+"/publishConfig",schemaPath:"#/properties/publishConfig/type",keyword:"type",params:{type:"object"},message:"must be object"};null===l?l=[e]:l.push(e)}}if(e.repository!==undefined){let r=e.repository;if(r&&"object"==typeof r&&!Array.isArray(r)){if(r.type===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/required",keyword:"required",params:{missingProperty:"type"},message:"must have required property '"+"type"+"'"};null===l?l=[e]:l.push(e)}if(r.url===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/required",keyword:"required",params:{missingProperty:"url"},message:"must have required property '"+"url"+"'"};null===l?l=[e]:l.push(e)}for(const e in r)if("type"!==e&&"url"!==e){const r={instancePath:t+"/repository",schemaPath:"#/properties/repository/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===l?l=[r]:l.push(r)}if(r.type!==undefined){let e=r.type;if("string"==typeof e){if(a(e)<1){const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/properties/type/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/properties/type/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(r.url!==undefined){let e=r.url;if("string"==typeof e){if(a(e)<1){const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/properties/url/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}}else{const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/type",keyword:"type",params:{type:"object"},message:"must be object"};null===l?l=[e]:l.push(e)}}}else{const e={instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"};null===l?l=[e]:l.push(e)}return o.errors=l,l}}}},{package:"@metamask/snap-utils"}],[1719,{"ajv/dist/runtime/ucs2length":1729},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=u,t.exports.default=u;const n={title:"Snap Manifest",description:"The Snap manifest file MUST be named `snap.manifest.json` and located in the package root directory.",type:"object",additionalProperties:!1,required:["version","description","proposedName","source","initialPermissions","manifestVersion"],properties:{version:{type:"string",title:"Version",description:"MUST be a valid SemVer version string and equal to the corresponding `package.json` field.",pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},description:{type:"string",title:"Description",description:"MUST be a non-empty string less than or equal to 280 characters. A short description of the Snap.",minLength:1,maxLength:280},proposedName:{type:"string",title:"Proposed Name",description:"MUST be a string less than or equal to 214 characters. The Snap author's proposed name for the Snap. The Snap host application may display this name unmodified in its user interface. The proposed name SHOULD be human-readable.",minLength:1,maxLength:214,pattern:"^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$"},repository:{title:"Repository",description:"MAY be omitted. If present, MUST be equal to the corresponding package.json field.",oneOf:[{type:"null"},{type:"object",additionalProperties:!1,required:["type","url"],properties:{type:{type:"string",minLength:1},url:{type:"string",minLength:1}}}]},source:{type:"object",title:"Source",description:"Specifies some Snap metadata and where to fetch the Snap during installation.",additionalProperties:!1,required:["shasum","location"],properties:{shasum:{type:"string",description:"MUST be the Base64-encoded string representation of the SHA-256 hash of the Snap source file.",minLength:44,maxLength:44,pattern:"^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$"},location:{title:"Source Location",type:"object",additionalProperties:!1,required:["npm"],properties:{npm:{title:"npm",type:"object",additionalProperties:!1,required:["filePath","packageName","registry"],properties:{filePath:{type:"string",title:"File Path",description:"The path to the Snap bundle file from the project root directory.",minLength:1},iconPath:{type:"string",title:"Icon Path",description:"The path to an .svg file from the project root directory.",pattern:"\\w+\\.svg$"},packageName:{type:"string",title:"Package Name",description:"The Snap's npm package name.",minLength:1},registry:{type:"string",title:"npm Registry",description:"The npm registry URL.",enum:["https://registry.npmjs.org","https://registry.npmjs.org/"]}}}}}}},initialPermissions:{type:"object",title:"Initial Permissions",description:"MUST be a valid EIP-2255 wallet_requestPermissions parameter object, specifying the initial permissions that will be requested when the Snap is added to the host application."},manifestVersion:{type:"string",title:"Manifest Version",description:"The Snap manifest specification version targeted by the manifest.",enum:["0.1"]}}},i=new RegExp("^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$","u"),s=new RegExp("^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$","u"),a=new RegExp("^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$","u"),o=new RegExp("\\w+\\.svg$","u"),c=e("ajv/dist/runtime/ucs2length").default;function u(e,{instancePath:t="",parentData:r,parentDataProperty:l,rootData:d=e}={}){let h=null,f=0;if(e&&"object"==typeof e&&!Array.isArray(e)){if(e.version===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"version"},message:"must have required property '"+"version"+"'"};null===h?h=[e]:h.push(e),f++}if(e.description===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"description"},message:"must have required property '"+"description"+"'"};null===h?h=[e]:h.push(e),f++}if(e.proposedName===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"proposedName"},message:"must have required property '"+"proposedName"+"'"};null===h?h=[e]:h.push(e),f++}if(e.source===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"source"},message:"must have required property '"+"source"+"'"};null===h?h=[e]:h.push(e),f++}if(e.initialPermissions===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"initialPermissions"},message:"must have required property '"+"initialPermissions"+"'"};null===h?h=[e]:h.push(e),f++}if(e.manifestVersion===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"manifestVersion"},message:"must have required property '"+"manifestVersion"+"'"};null===h?h=[e]:h.push(e),f++}for(const r in e)if("version"!==r&&"description"!==r&&"proposedName"!==r&&"repository"!==r&&"source"!==r&&"initialPermissions"!==r&&"manifestVersion"!==r){const e={instancePath:t,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:r},message:"must NOT have additional properties"};null===h?h=[e]:h.push(e),f++}if(e.version!==undefined){let r=e.version;if("string"==typeof r){if(!i.test(r)){const e={instancePath:t+"/version",schemaPath:"#/properties/version/pattern",keyword:"pattern",params:{pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},message:'must match pattern "'+"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"+'"'};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/version",schemaPath:"#/properties/version/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(e.description!==undefined){let r=e.description;if("string"==typeof r){if(c(r)>280){const e={instancePath:t+"/description",schemaPath:"#/properties/description/maxLength",keyword:"maxLength",params:{limit:280},message:"must NOT have more than 280 characters"};null===h?h=[e]:h.push(e),f++}if(c(r)<1){const e={instancePath:t+"/description",schemaPath:"#/properties/description/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(e.proposedName!==undefined){let r=e.proposedName;if("string"==typeof r){if(c(r)>214){const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/maxLength",keyword:"maxLength",params:{limit:214},message:"must NOT have more than 214 characters"};null===h?h=[e]:h.push(e),f++}if(c(r)<1){const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}if(!s.test(r)){const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/pattern",keyword:"pattern",params:{pattern:"^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$"},message:'must match pattern "'+"^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$"+'"'};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(e.repository!==undefined){let r=e.repository;const n=f;let i=!1,s=null;const a=f;if(null!==r){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/0/type",keyword:"type",params:{type:"null"},message:"must be null"};null===h?h=[e]:h.push(e),f++}(p=a===f)&&(i=!0,s=0);const o=f;if(r&&"object"==typeof r&&!Array.isArray(r)){if(r.type===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/required",keyword:"required",params:{missingProperty:"type"},message:"must have required property '"+"type"+"'"};null===h?h=[e]:h.push(e),f++}if(r.url===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/required",keyword:"required",params:{missingProperty:"url"},message:"must have required property '"+"url"+"'"};null===h?h=[e]:h.push(e),f++}for(const e in r)if("type"!==e&&"url"!==e){const r={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===h?h=[r]:h.push(r),f++}if(r.type!==undefined){let e=r.type;if("string"==typeof e){if(c(e)<1){const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/oneOf/1/properties/type/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/oneOf/1/properties/type/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(r.url!==undefined){let e=r.url;if("string"==typeof e){if(c(e)<1){const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/oneOf/1/properties/url/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/oneOf/1/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}}else{const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}var p;if((p=o===f)&&i?(i=!1,s=[s,1]):p&&(i=!0,s=1),i)f=n,null!==h&&(n?h.length=n:h=null);else{const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf",keyword:"oneOf",params:{passingSchemas:s},message:"must match exactly one schema in oneOf"};null===h?h=[e]:h.push(e),f++}}if(e.source!==undefined){let r=e.source;if(r&&"object"==typeof r&&!Array.isArray(r)){if(r.shasum===undefined){const e={instancePath:t+"/source",schemaPath:"#/properties/source/required",keyword:"required",params:{missingProperty:"shasum"},message:"must have required property '"+"shasum"+"'"};null===h?h=[e]:h.push(e),f++}if(r.location===undefined){const e={instancePath:t+"/source",schemaPath:"#/properties/source/required",keyword:"required",params:{missingProperty:"location"},message:"must have required property '"+"location"+"'"};null===h?h=[e]:h.push(e),f++}for(const e in r)if("shasum"!==e&&"location"!==e){const r={instancePath:t+"/source",schemaPath:"#/properties/source/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===h?h=[r]:h.push(r),f++}if(r.shasum!==undefined){let e=r.shasum;if("string"==typeof e){if(c(e)>44){const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/maxLength",keyword:"maxLength",params:{limit:44},message:"must NOT have more than 44 characters"};null===h?h=[e]:h.push(e),f++}if(c(e)<44){const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/minLength",keyword:"minLength",params:{limit:44},message:"must NOT have fewer than 44 characters"};null===h?h=[e]:h.push(e),f++}if(!a.test(e)){const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/pattern",keyword:"pattern",params:{pattern:"^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$"},message:'must match pattern "'+"^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$"+'"'};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(r.location!==undefined){let e=r.location;if(e&&"object"==typeof e&&!Array.isArray(e)){if(e.npm===undefined){const e={instancePath:t+"/source/location",schemaPath:"#/properties/source/properties/location/required",keyword:"required",params:{missingProperty:"npm"},message:"must have required property '"+"npm"+"'"};null===h?h=[e]:h.push(e),f++}for(const r in e)if("npm"!==r){const e={instancePath:t+"/source/location",schemaPath:"#/properties/source/properties/location/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:r},message:"must NOT have additional properties"};null===h?h=[e]:h.push(e),f++}if(e.npm!==undefined){let r=e.npm;if(r&&"object"==typeof r&&!Array.isArray(r)){if(r.filePath===undefined){const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/required",keyword:"required",params:{missingProperty:"filePath"},message:"must have required property '"+"filePath"+"'"};null===h?h=[e]:h.push(e),f++}if(r.packageName===undefined){const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/required",keyword:"required",params:{missingProperty:"packageName"},message:"must have required property '"+"packageName"+"'"};null===h?h=[e]:h.push(e),f++}if(r.registry===undefined){const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/required",keyword:"required",params:{missingProperty:"registry"},message:"must have required property '"+"registry"+"'"};null===h?h=[e]:h.push(e),f++}for(const e in r)if("filePath"!==e&&"iconPath"!==e&&"packageName"!==e&&"registry"!==e){const r={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===h?h=[r]:h.push(r),f++}if(r.filePath!==undefined){let e=r.filePath;if("string"==typeof e){if(c(e)<1){const e={instancePath:t+"/source/location/npm/filePath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/filePath/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/source/location/npm/filePath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/filePath/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(r.iconPath!==undefined){let e=r.iconPath;if("string"==typeof e){if(!o.test(e)){const e={instancePath:t+"/source/location/npm/iconPath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/iconPath/pattern",keyword:"pattern",params:{pattern:"\\w+\\.svg$"},message:'must match pattern "'+"\\w+\\.svg$"+'"'};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/source/location/npm/iconPath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/iconPath/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(r.packageName!==undefined){let e=r.packageName;if("string"==typeof e){if(c(e)<1){const e={instancePath:t+"/source/location/npm/packageName",schemaPath:"#/properties/source/properties/location/properties/npm/properties/packageName/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/source/location/npm/packageName",schemaPath:"#/properties/source/properties/location/properties/npm/properties/packageName/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(r.registry!==undefined){let e=r.registry;if("string"!=typeof e){const e={instancePath:t+"/source/location/npm/registry",schemaPath:"#/properties/source/properties/location/properties/npm/properties/registry/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}if("https://registry.npmjs.org"!==e&&"https://registry.npmjs.org/"!==e){const e={instancePath:t+"/source/location/npm/registry",schemaPath:"#/properties/source/properties/location/properties/npm/properties/registry/enum",keyword:"enum",params:{allowedValues:n.properties.source.properties.location.properties.npm.properties.registry.enum},message:"must be equal to one of the allowed values"};null===h?h=[e]:h.push(e),f++}}}else{const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}}}else{const e={instancePath:t+"/source/location",schemaPath:"#/properties/source/properties/location/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}}}else{const e={instancePath:t+"/source",schemaPath:"#/properties/source/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}}if(e.initialPermissions!==undefined){let r=e.initialPermissions;if(!r||"object"!=typeof r||Array.isArray(r)){const e={instancePath:t+"/initialPermissions",schemaPath:"#/properties/initialPermissions/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}}if(e.manifestVersion!==undefined){let r=e.manifestVersion;if("string"!=typeof r){const e={instancePath:t+"/manifestVersion",schemaPath:"#/properties/manifestVersion/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}if("0.1"!==r){const e={instancePath:t+"/manifestVersion",schemaPath:"#/properties/manifestVersion/enum",keyword:"enum",params:{allowedValues:n.properties.manifestVersion.enum},message:"must be equal to one of the allowed values"};null===h?h=[e]:h.push(e),f++}}}else{const e={instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}return u.errors=h,h}}}},{package:"@metamask/snap-utils"}],[172,{events:2435,"ipfs-log/src/entry":4885,"is-ipfs":5135,"orbit-db-access-controllers/src/utils/ensure-ac-address":5734},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("orbit-db-access-controllers/src/utils/ensure-ac-address"),i=e("events").EventEmitter,s=e("ipfs-log/src/entry"),a=(e("is-ipfs"),"MODERATOR"),o="MEMBER";class c extends i{constructor(e,t,r,n,i){super(),this._orbitdb=e,this._db=null,this._options=i||{},this._ipfs=t,this._members=Boolean(i.members),this._firstModerator=n,this._threadName=i.threadName,this._identity=r}static get type(){return"thread-access"}get address(){return this._db.address}async canAppend(e,t){const r=async()=>await t.verifyIdentity(e.identity),n=e.payload.op,i=this.capabilities.moderators,a=this.capabilities.members,o=i.includes(e.identity.id),c=a.includes(e.identity.id);if("ADD"===n){if(!this._members)return await r();if(c||o)return await r()}if("DEL"===n){const t=e.payload.value;if((await s.fromMultihash(this._ipfs,t)).identity.id===e.identity.id)return await r();if(o)return await r()}return!1}get capabilities(){return this._capabilities||this._updateCapabilites(),this._capabilities}_updateCapabilites(){let e=[],t=[];return this._db&&(e.push(this._db.access._firstModerator),Object.entries(this._db.index).forEach((r=>{const n=r[1].payload.value.capability,i=r[1].payload.value.id;n===a&&e.push(i),n===o&&t.push(i)}))),this._capabilities={moderators:e,members:t},this._capabilities}get(e){return this.capabilities[e]||[]}async close(){await this._db.close()}async load(e){this._db&&await this._db.close(),this._db=await this._orbitdb.feed(n(e),{identity:this._identity,accessController:{type:"moderator-access",firstModerator:this._firstModerator,members:this._members},sync:!0}),this._db.events.on("ready",this._onUpdate.bind(this)),this._db.events.on("write",this._onUpdate.bind(this)),this._db.events.on("replicated",this._onUpdate.bind(this)),await this._db.load()}async save(){return{address:this._db.address.toString(),firstModerator:this._firstModerator,members:this._members}}async grant(e,t){if(!this._db.access.isValidCapability(e))throw new Error("grant: Invalid capability to grant");if(e===o&&this.capabilities.members.includes(t))throw new Error(`grant: capability ${e} has already been granted to ${t}`);if(e===a&&this.capabilities.moderators.includes(t))throw new Error(`grant: capability ${e} has already been granted to ${t}`);try{await this._db.add({capability:e,id:t})}catch(r){if(r.toString().includes("not append entry"))throw new Error(`grant: Capability ${e} can not be granted to ${t}`);throw r}}_onUpdate(){this._updateCapabilites(),this.emit("updated")}static async create(e,t={}){if(!t.firstModerator)throw new Error("Thread AC: firstModerator required");const r=new c(e,e._ipfs,t.identity,t.firstModerator,t);return await r.load(t.address||t.threadName),r}}t.exports=c}}},{package:"3box>3box-orbitdb-plugins"}],[1720,{"./deep-clone":1711,"./fs":1715,"./npm":1722,"./snaps":1725,"./types":1726,fs:2432,path:5808},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.getWritableManifest=r.getSnapSourceCode=r.fixManifest=r.checkManifest=void 0;const s=e("fs"),a=i(e("path")),o=e("./npm"),c=e("./types"),u=e("./fs"),l=e("./snaps"),d=e("./deep-clone"),h={version:1,description:2,proposedName:3,repository:4,source:5,initialPermissions:6,manifestVersion:7};function f(e,t){const{manifest:r,packageJson:n,sourceCode:i}=e,s=(0,d.deepClone)(r);switch(t.reason){case c.SnapValidationFailureReason.NameMismatch:s.source.location.npm.packageName=n.name;break;case c.SnapValidationFailureReason.VersionMismatch:s.version=n.version;break;case c.SnapValidationFailureReason.RepositoryMismatch:s.repository=n.repository?(0,d.deepClone)(n.repository):null;break;case c.SnapValidationFailureReason.ShasumMismatch:s.source.shasum=(0,l.getSnapSourceShasum)(i);break;default:{const e=t.reason;throw new Error(`Unrecognized validation failure reason: '${e}'`)}}return s}async function p(e,t){var r,n,i;if(t&&"object"==typeof t&&!Array.isArray(t)){const o=null===(i=null===(n=null===(r=t.source)||void 0===r?void 0:r.location)||void 0===n?void 0:n.npm)||void 0===i?void 0:i.filePath;try{return o?await s.promises.readFile(a.default.join(e,o),"utf8"):undefined}catch(e){throw new Error(`Failed to read Snap bundle file: ${e.message}`)}}return undefined}function m(e){const{repository:t}=e,r=n(e,["repository"]);return Object.keys(t?Object.assign(Object.assign({},r),{repository:t}):r).sort(((e,t)=>h[e]-h[t])).reduce(((t,r)=>Object.assign(Object.assign({},t),{[r]:e[r]})),{})}r.checkManifest=async function(e,t=!0){var r,n,i;const d=[],h=[];let g=!1;const y=await(0,u.readSnapJsonFile)(e,c.NpmSnapFileNames.Manifest),b=y&&"object"==typeof y?null===(i=null===(n=null===(r=y.source)||void 0===r?void 0:r.location)||void 0===n?void 0:n.npm)||void 0===i?void 0:i.iconPath:undefined,v={manifest:y,packageJson:await(0,u.readSnapJsonFile)(e,c.NpmSnapFileNames.PackageJson),sourceCode:await p(e,y),svgIcon:b&&await s.promises.readFile(a.default.join(e,b),"utf8")};let w;try{({manifest:w}=(0,o.validateNpmSnap)(v))}catch(e){if(!(e instanceof l.ProgrammaticallyFixableSnapError))throw e;{h.push(e.message);const t=v;let r=!0,n=e;const i=Object.keys(c.SnapValidationFailureReason).length;for(let s=1;r&&s<=i;s++){w=f(w?Object.assign(Object.assign({},t),{manifest:w}):t,n);try{(0,o.validateNpmSnapManifest)(Object.assign(Object.assign({},t),{manifest:w})),r=!1}catch(t){if(n=t,!(t instanceof l.ProgrammaticallyFixableSnapError)||s===i&&!r)throw new Error(`Internal error: Failed to fix manifest. This is a bug, please report it. Reason:\n${e.message}`);h.push(n.message)}}g=!0}}const _=w,S=["repository"].filter((e=>!_[e]));if(S.length>0&&d.push(`Missing recommended package.json properties:\n${S.reduce(((e,t)=>`${e}\t${t}\n`),"")}`),t)try{await s.promises.writeFile(a.default.join(e,c.NpmSnapFileNames.Manifest),`${JSON.stringify(m(_),null,2)}\n`)}catch(e){throw new Error(`Failed to update snap.manifest.json: ${e.message}`)}return{manifest:_,updated:g,warnings:d,errors:h}},r.fixManifest=f,r.getSnapSourceCode=p,r.getWritableManifest=m}}},{package:"@metamask/snap-utils"}],[1721,{"./default-endowments":1712,crypto:2556,events:2435},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.generateMockEndowments=r.isConstructor=r.ALL_APIS=void 0;const i=n(e("events")),s=n(e("crypto")),a=e("./default-endowments");function o(){const e=new i.default;return e.request=async()=>!0,e}r.ALL_APIS=[...a.DEFAULT_ENDOWMENTS,"fetch","WebSocket"];r.isConstructor=e=>{var t,r;return Boolean("string"==typeof(null===(r=null===(t=null==e?void 0:e.prototype)||void 0===t?void 0:t.constructor)||void 0===r?void 0:r.name))};const c=()=>!0;class u{}const l={construct:(e,t)=>new Proxy(new e(...t),l),get:(e,t)=>c},d={WebSocket:u,crypto:s.default,SubtleCrypto:u},h=e=>{const t=globalThis[e];if(t&&a.DEFAULT_ENDOWMENTS.includes(e))return t;const n=null!=t?t:d[e],i="function"===typeof n;return i&&(0,r.isConstructor)(n)?new Proxy(n,l):i||!n?c:n};r.generateMockEndowments=()=>r.ALL_APIS.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:h(t)})),{wallet:o()})}}},{package:"@metamask/snap-utils"}],[1722,{"./json-schemas":1717,"./snaps":1725,"./types":1726,buffer:2434,"fast-deep-equal":4688},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.validateNpmSnapManifest=r.validateNpmSnap=r.SnapFileNameFromKey=r.EXPECTED_SNAP_FILES=r.SVG_MAX_BYTE_SIZE_TEXT=r.SVG_MAX_BYTE_SIZE=void 0;const i=n(e("fast-deep-equal")),s=e("./types"),a=e("./json-schemas"),o=e("./snaps");function c({manifest:e,packageJson:t,sourceCode:r}){const n=t.name,a=t.version,c=t.repository,u=e.source.location.npm.packageName,l=e.version,d=e.repository;if(n!==u)throw new o.ProgrammaticallyFixableSnapError(`"${s.NpmSnapFileNames.Manifest}" npm package name ("${u}") does not match the "${s.NpmSnapFileNames.PackageJson}" "name" field ("${n}").`,s.SnapValidationFailureReason.NameMismatch);if(a!==l)throw new o.ProgrammaticallyFixableSnapError(`"${s.NpmSnapFileNames.Manifest}" npm package version ("${l}") does not match the "${s.NpmSnapFileNames.PackageJson}" "version" field ("${a}").`,s.SnapValidationFailureReason.VersionMismatch);if((c||d)&&!(0,i.default)(c,d))throw new o.ProgrammaticallyFixableSnapError(`"${s.NpmSnapFileNames.Manifest}" "repository" field does not match the "${s.NpmSnapFileNames.PackageJson}" "repository" field.`,s.SnapValidationFailureReason.RepositoryMismatch);return(0,o.validateSnapShasum)(e,r,`"${s.NpmSnapFileNames.Manifest}" "shasum" field does not match computed shasum.`),[e,r,t]}r.SVG_MAX_BYTE_SIZE=1e5,r.SVG_MAX_BYTE_SIZE_TEXT=`${Math.floor(r.SVG_MAX_BYTE_SIZE/1e3)}kb`,r.EXPECTED_SNAP_FILES=["manifest","packageJson","sourceCode"],r.SnapFileNameFromKey={manifest:s.NpmSnapFileNames.Manifest,packageJson:s.NpmSnapFileNames.PackageJson,sourceCode:"source code bundle"},r.validateNpmSnap=function(e,n){r.EXPECTED_SNAP_FILES.forEach((t=>{if(!e[t])throw new Error(`${null!=n?n:""}Missing file "${r.SnapFileNameFromKey[t]}".`)}));const{manifest:i,packageJson:o,sourceCode:u,svgIcon:l}=e;try{(0,a.validateSnapJsonFile)(s.NpmSnapFileNames.Manifest,i)}catch(e){throw new Error(`${null!=n?n:""}"${s.NpmSnapFileNames.Manifest}" is invalid:\n${e.message}`)}const d=i,{iconPath:h}=d.source.location.npm;if(h&&!l)throw new Error(`Missing file "${h}".`);try{(0,a.validateSnapJsonFile)(s.NpmSnapFileNames.PackageJson,o)}catch(e){throw new Error(`${null!=n?n:""}"${s.NpmSnapFileNames.PackageJson}" is invalid:\n${e.message}`)}const f=o;if(c({manifest:d,packageJson:f,sourceCode:u}),l&&t.byteLength(l,"utf8")>r.SVG_MAX_BYTE_SIZE)throw new Error(`${null!=n?n:""}The specified SVG icon exceeds the maximum size of ${r.SVG_MAX_BYTE_SIZE_TEXT}.`);return{manifest:d,packageJson:f,sourceCode:u,svgIcon:l}},r.validateNpmSnapManifest=c}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snap-utils"}],[1723,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.fromEntries=void 0;r.fromEntries=e=>e.reduce(((e,[t,r])=>Object.assign(Object.assign({},e),{[t]:r})),{})}}},{package:"@metamask/snap-utils"}],[1724,{"@babel/core":220,"@babel/types":414},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.postProcessBundle=void 0;const n=e("@babel/types"),i=e("@babel/core"),s=/(<!)(--)|(--)(>)|(import)(\(.*?\))/gu,a=(0,n.templateElement)({raw:"",cooked:""}),o=i.template.statement("\n  (1, REF)(ARGS)\n"),c=i.template.statement("\n  (1, OBJECT.REF)\n"),u=i.template.statement("\n  var regeneratorRuntime;\n");function l(e){return e.replace(/\\|`|\$\{/gu,"\\$&")}r.postProcessBundle=function(e,{stripComments:t=!0,sourceMap:r,inputSourceMap:d}={}){if("string"!=typeof e)return null;const h=({ast:e})=>{var t;null===(t=e.comments)||void 0===t||t.forEach((e=>{e.value=e.value.replace(new RegExp("\x3c!--","gu"),"< !--").replace(new RegExp("--\x3e","gu"),"-- >").replace(/__import__(\(.*\))/gu,"import\\$1")}))},f={FunctionExpression(e){var t;const{node:r}=e;"FunctionExpression"===r.type&&(null===(t=r.extra)||void 0===t?void 0:t.parenthesized)&&(r.params=r.params.filter((e=>!("Identifier"===e.type&&"Buffer"===e.name))))},CallExpression(e){const{node:t}=e;"Identifier"===t.callee.type&&"eval"===t.callee.name&&e.replaceWith(o({REF:t.callee,ARGS:t.arguments}))},MemberExpression(e){const{node:t}=e;"Identifier"===t.property.type&&"eval"===t.property.name&&"SequenceExpression"!==e.parent.type&&e.replaceWith(c({OBJECT:t.object,REF:t.property}))},Identifier(e){const{node:t}=e;if("regeneratorRuntime"===t.name){const t=e.findParent((e=>"Program"===e.node.type));if("Program"===(null==t?void 0:t.node.type)){const e=t.node.body[0];if("VariableDeclaration"===e.type&&"regeneratorRuntime"===e.declarations[0].id.name)return;null==t||t.node.body.unshift(u())}}},TemplateLiteral(e){const{node:t}=e;if(e.getData("visited"))return;const[r,i]=t.quasis.reduce((([e,r],i,o)=>{const c=function(e){const t=Array.from(e.matchAll(s));if(t.length>0){const r=t.reduce((([t,r],i,s,o)=>{const[,c,u]=i.filter((e=>e!==undefined)),d=e.slice(0===s?0:o[s-1].index+o[s-1][0].length,i.index);return[[...t,(0,n.templateElement)({raw:l(d),cooked:d}),a],[...r,(0,n.stringLiteral)(c),(0,n.stringLiteral)(u)]]}),[[],[]]),i=t[t.length-1],s=e.slice(i.index+i[0].length);return[[...r[0],(0,n.templateElement)({raw:l(s),cooked:s})],r[1]]}return[[(0,n.templateElement)({raw:l(e),cooked:e})],[]]}(i.value.cooked);return c[0].length<=1?[[...e,i],[...r,t.expressions[o]]]:[[...e,...c[0]],[...r,...c[1],t.expressions[o]]]}),[[],[]]);e.replaceWith((0,n.templateLiteral)(r,i.filter((e=>e!==undefined)))),e.setData("visited",!0)},StringLiteral(e){const{node:t}=e,r=t.value.split(s).filter((e=>""!==e&&e!==undefined));if(r.length<=1)return;const i=r.slice(1).reduce(((e,t)=>(0,n.binaryExpression)("+",e,(0,n.stringLiteral)(t))),(0,n.stringLiteral)(r[0]));e.replaceWith(i),e.skip()},BinaryExpression(e){const t=e.getSource();if(t.includes("< ! --")||t.includes("-- >"))throw new Error("Using HTML comments (`< ! --` and `-- >`) as operators is not allowed. The behaviour of "+"these comments is ambiguous, and differs per browser and environment. If you want "+"to use them as operators, break them up into separate characters, i.e., `a-- > b` "+"and `a < ! --b`.")}};try{const n=(0,i.transformSync)(e,{configFile:!1,parserOpts:{strictMode:!0,attachComment:!t},compact:!1,inputSourceMap:d,sourceMaps:r,plugins:[()=>({pre:h,visitor:f})]});if(!(null==n?void 0:n.code))throw new Error("Bundled code is empty.");return{code:n.code,sourceMap:n.map}}catch(e){throw new Error(`Failed to post process code:\n${e.message}`)}}}}},{package:"@metamask/snap-utils"}],[1725,{"./types":1726,crypto:2556},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isCaipChainId=r.validateSnapId=r.getSnapPermissionName=r.getSnapPrefix=r.validateSnapShasum=r.getSnapSourceShasum=r.ProgrammaticallyFixableSnapError=r.PROPOSED_NAME_REGEX=r.SNAP_PREFIX_REGEX=r.SNAP_PREFIX=r.LOCALHOST_HOSTNAMES=void 0;const n=e("crypto"),i=e("./types");r.LOCALHOST_HOSTNAMES=new Set(["localhost","127.0.0.1","::1"]),r.SNAP_PREFIX="wallet_snap_",r.SNAP_PREFIX_REGEX=new RegExp(`^${r.SNAP_PREFIX}`,"u"),r.PROPOSED_NAME_REGEX=/^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*\/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$/u;class s extends Error{constructor(e,t){super(e),this.reason=t}}function a(e){return(0,n.createHash)("sha256").update(e,"utf8").digest("base64")}r.ProgrammaticallyFixableSnapError=s,r.getSnapSourceShasum=a,r.validateSnapShasum=function(e,t,r="Invalid Snap manifest: manifest shasum does not match computed shasum."){if(e.source.shasum!==a(t))throw new s(r,i.SnapValidationFailureReason.ShasumMismatch)},r.getSnapPrefix=function(e){const t=Object.values(i.SnapIdPrefixes).find((t=>e.startsWith(t)));if(t!==undefined)return t;throw new Error(`Invalid or no prefix found for "${e}"`)},r.getSnapPermissionName=function(e){return r.SNAP_PREFIX+e},r.validateSnapId=function(e){if(!e||"string"!=typeof e)throw new Error(`Invalid snap id. Not a string. Received "${e}"`);for(const t of Object.values(i.SnapIdPrefixes))if(e.startsWith(t)&&e.replace(t,"").length>0)return;throw new Error(`Invalid snap id. Unknown prefix. Received: "${e}"`)},r.isCaipChainId=function(e){return"string"==typeof e&&/^(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-a-zA-Z0-9]{1,32})$/u.test(e)}}}},{package:"@metamask/snap-utils"}],[1726,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.HandlerType=r.SNAP_STREAM_NAMES=r.SnapValidationFailureReason=r.NpmSnapFileNames=r.SnapIdPrefixes=void 0,function(e){e.npm="npm:",e.local="local:"}(r.SnapIdPrefixes||(r.SnapIdPrefixes={})),function(e){e.PackageJson="package.json",e.Manifest="snap.manifest.json"}(r.NpmSnapFileNames||(r.NpmSnapFileNames={})),function(e){e.NameMismatch='"name" field mismatch',e.VersionMismatch='"version" field mismatch',e.RepositoryMismatch='"repository" field mismatch',e.ShasumMismatch='"shasum" field mismatch'}(r.SnapValidationFailureReason||(r.SnapValidationFailureReason={})),function(e){e.JSON_RPC="jsonRpc",e.COMMAND="command"}(r.SNAP_STREAM_NAMES||(r.SNAP_STREAM_NAMES={})),function(e){e.OnRpcRequest="onRpcRequest",e.OnTransaction="onTransaction"}(r.HandlerType||(r.HandlerType={}))}}},{package:"@metamask/snap-utils"}],[1727,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isValidUrl=void 0,r.isValidUrl=function(e){try{return Boolean(new URL(e))}catch(e){return!1}}}}},{package:"@metamask/snap-utils"}],[1728,{semver:6922},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isValidSnapVersionRange=r.resolveVersion=r.getTargetVersion=r.satisfiesVersionRange=r.gtVersion=r.DEFAULT_REQUESTED_SNAP_VERSION=void 0;const n=e("semver");r.DEFAULT_REQUESTED_SNAP_VERSION="*",r.gtVersion=function(e,t){return(0,n.gt)(e,t,{includePrerelease:!0})},r.satisfiesVersionRange=function(e,t){return(0,n.satisfies)(e,t,{includePrerelease:!0})},r.getTargetVersion=function(e,t){const r=(0,n.maxSatisfying)(e,t);return r||(0,n.maxSatisfying)(e,t,{includePrerelease:!0})},r.resolveVersion=function(e){return e===undefined||"latest"===e?r.DEFAULT_REQUESTED_SNAP_VERSION:e},r.isValidSnapVersionRange=function(e){return Boolean("string"==typeof e&&null!==(0,n.validRange)(e,{includePrerelease:!0}))}}}},{package:"@metamask/snap-utils"}],[1729,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){const t=e.length;let r,n=0,i=0;for(;i<t;)n++,r=e.charCodeAt(i++),r>=55296&&r<=56319&&i<t&&(r=e.charCodeAt(i),56320==(64512&r)&&i++);return n}Object.defineProperty(r,"__esModule",{value:!0}),r.default=n,n.code='require("ajv/dist/runtime/ucs2length").default'}}},{package:"@metamask/snap-utils>ajv"}]],[],{});